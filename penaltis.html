<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>FutPro - Juego de Penaltis</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body{font-family:Segoe UI, Tahoma, Verdana;background:#0f0f0f;color:#fff;padding:20px;margin:0;overflow-x:hidden}
        .container{max-width:1000px;margin:0 auto}
        .game-area{background:#1a1a1a;border-radius:12px;padding:20px;margin-bottom:20px;border:2px solid #333}
        .field{width:100%;height:400px;background:linear-gradient(45deg, #228b22 25%, #32cd32 25%, #32cd32 50%, #228b22 50%, #228b22 75%, #32cd32 75%);background-size:40px 40px;position:relative;border-radius:12px;overflow:hidden}
        .goal{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);width:200px;height:100px;border:3px solid #fff;background:rgba(255,255,255,0.1)}
        .goalkeeper{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);width:40px;height:60px;background:#ff4444;border-radius:50% 50% 0 0;transition:all 0.3s ease;cursor:pointer}
        .goalkeeper:before{content:'ü•Ö';font-size:30px;position:absolute;top:-10px;left:50%;transform:translateX(-50%)}
        .ball{position:absolute;width:20px;height:20px;background:#fff;border-radius:50%;transition:all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)}
        .penalty-spot{position:absolute;bottom:150px;left:50%;transform:translateX(-50%);width:8px;height:8px;background:#fff;border-radius:50%}
        .shoot-zones{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);width:200px;height:100px;display:grid;grid-template-columns:1fr 1fr 1fr;grid-template-rows:1fr 1fr 1fr;gap:2px}
        .zone{background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);cursor:pointer;transition:all 0.2s}
        .zone:hover{background:rgba(255,215,0,0.3)}
        .zone.selected{background:rgba(255,215,0,0.6);border-color:#FFD700}
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:20px}
        .stat-card{background:#181818;padding:16px;border-radius:8px;border:1px solid #333;text-align:center}
        .fifa-card{width:200px;background:linear-gradient(135deg,#1a1a1a,#2d2d2d);border:2px solid #FFD700;border-radius:12px;padding:16px;color:#fff;position:relative;overflow:hidden}
        .fifa-card:before{content:'';position:absolute;top:0;left:0;right:0;height:40px;background:linear-gradient(90deg,#FFD700,#FFA500);opacity:0.8}
        .card-level{position:absolute;top:8px;right:12px;background:#000;color:#FFD700;padding:2px 8px;border-radius:4px;font-weight:bold;font-size:12px}
        .card-rating{font-size:36px;font-weight:bold;color:#FFD700;margin:10px 0}
        .card-stats{display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:11px;margin-top:8px}
        .card-stat{display:flex;justify-content:space-between}
        .btn{padding:12px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;margin:4px;transition:all 0.3s}
        .btn-primary{background:#FFD700;color:#181818}
        .btn-secondary{background:#333;color:#fff}
        .btn-danger{background:#c00;color:#fff}
        .btn:hover{transform:scale(1.05)}
        .ranking-table{background:#181818;border-radius:8px;overflow:hidden}
        .ranking-table th,.ranking-table td{padding:12px;text-align:left;border-bottom:1px solid #333}
        .ranking-table th{background:#2d2d2d;color:#FFD700}
        .modal{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center}
        .modal-content{background:#181818;padding:24px;border-radius:12px;max-width:500px;width:90%}
        .level-colors{
            --bronze: #cd7f32;
            --silver: #c0c0c0;
            --gold: #ffd700;
            --platinum: #e5e4e2;
            --diamond: #b9f2ff;
            --master: #ff6b6b;
            --grandmaster: #8b008b;
            --challenger: #ff1493;
            --legend: #ff4500;
            --godlike: #9400d3;
        }
        .difficulty-indicator{font-size:12px;color:#888;margin-top:4px}
    </style>
</head>
<body>
    <div class="container">
        <h1 style="color:#FFD700;text-align:center">‚öΩ Juego de Penaltis FIFA</h1>
        
        <div class="stats">
            <div class="stat-card">
                <h3 style="color:#FFD700">Mi Card FIFA</h3>
                <div class="fifa-card" id="playerCard">
                    <div class="card-level" id="cardLevel">LVL 1</div>
                    <h4 style="margin:0;color:#FFD700" id="playerName">Tu Jugador</h4>
                    <div class="card-rating" id="playerRating">65</div>
                    <div style="font-size:12px;color:#aaa">Penalty Specialist</div>
                    <div class="card-stats">
                        <div class="card-stat"><span>SHT</span><span id="shooting">45</span></div>
                        <div class="card-stat"><span>ACC</span><span id="accuracy">40</span></div>
                        <div class="card-stat"><span>PWR</span><span id="power">50</span></div>
                        <div class="card-stat"><span>MEN</span><span id="mental">35</span></div>
                    </div>
                    <div class="difficulty-indicator">Pr√≥ximo nivel: <span id="nextLevelExp">0/500</span> EXP</div>
                </div>
            </div>
            
            <div class="stat-card">
                <h3 style="color:#FFD700">Estad√≠sticas</h3>
                <div><strong>Penaltis anotados:</strong> <span id="goalsScored">0</span></div>
                <div><strong>Penaltis lanzados:</strong> <span id="totalShots">0</span></div>
                <div><strong>Efectividad:</strong> <span id="accuracy">0%</span></div>
                <div><strong>Experiencia:</strong> <span id="experience">0</span></div>
                <div><strong>Racha actual:</strong> <span id="currentStreak">0</span></div>
                <div><strong>Mejor racha:</strong> <span id="bestStreak">0</span></div>
            </div>
            
            <div class="stat-card">
                <h3 style="color:#FFD700">Dificultad</h3>
                <div>Probabilidad de gol: <strong style="color:#c00">15%</strong></div>
                <div>Arquero: <strong>Nivel Profesional</strong></div>
                <div>Experiencia por gol: <strong>+25 EXP</strong></div>
                <div>Experiencia por fallo: <strong>+5 EXP</strong></div>
                <div style="color:#FFD700;margin-top:8px">¬°El nivel aumenta cada 500 EXP!</div>
            </div>
        </div>

        <div class="game-area">
            <h3 style="color:#FFD700;text-align:center">Campo de Juego</h3>
            <div class="field" id="field">
                <div class="penalty-spot"></div>
                <div class="goal">
                    <div class="goalkeeper" id="goalkeeper"></div>
                </div>
                <div class="shoot-zones" id="shootZones">
                    <div class="zone" data-zone="0"></div>
                    <div class="zone" data-zone="1"></div>
                    <div class="zone" data-zone="2"></div>
                    <div class="zone" data-zone="3"></div>
                    <div class="zone" data-zone="4"></div>
                    <div class="zone" data-zone="5"></div>
                    <div class="zone" data-zone="6"></div>
                    <div class="zone" data-zone="7"></div>
                    <div class="zone" data-zone="8"></div>
                </div>
                <div class="ball" id="ball" style="bottom:150px;left:50%;transform:translateX(-50%)"></div>
            </div>
            
            <div style="text-align:center;margin-top:16px">
                <button class="btn btn-primary" onclick="selectZoneAndShoot()" id="shootBtn">‚öΩ Seleccionar Zona y Disparar</button>
                <button class="btn btn-secondary" onclick="resetGame()">üîÑ Nuevo Intento</button>
                <button class="btn btn-secondary" onclick="showRanking()">üèÜ Ver Ranking</button>
                <button class="btn btn-secondary" onclick="showLevelSystem()">üìä Sistema de Niveles</button>
                <button class="btn btn-secondary" onclick="changeGoalkeeper()">ü•Ö Cambiar Portero</button>
            </div>
            
            <!-- Selector de Potencia -->
            <div style="text-align:center;margin-top:12px;">
                <label style="color:#FFD700;font-weight:bold;">Potencia: </label>
                <input type="range" id="powerSlider" min="1" max="10" value="5" style="width:150px;">
                <span id="powerValue" style="color:#FFD700;font-weight:bold;">5</span>
            </div>
            
            <div id="gameMessage" style="text-align:center;margin-top:12px;font-size:18px;min-height:24px;color:#FFD700;"></div>
        </div>

        <!-- Modal Ranking -->
        <div class="modal" id="rankingModal">
            <div class="modal-content">
                <h3 style="color:#FFD700;margin-bottom:16px">üèÜ Ranking Global de Penaltis</h3>
                <table class="ranking-table" style="width:100%">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Jugador</th>
                            <th>Nivel</th>
                            <th>Goles</th>
                            <th>Efectividad</th>
                        </tr>
                    </thead>
                    <tbody id="rankingBody"></tbody>
                </table>
                <button class="btn btn-secondary" onclick="closeModal('rankingModal')" style="margin-top:16px">Cerrar</button>
            </div>
        </div>

        <!-- Modal Sistema de Niveles -->
        <div class="modal" id="levelModal">
            <div class="modal-content">
                <h3 style="color:#FFD700;margin-bottom:16px">üìä Sistema de Niveles FIFA</h3>
                <div id="levelSystem"></div>
                <button class="btn btn-secondary" onclick="closeModal('levelModal')" style="margin-top:16px">Cerrar</button>
            </div>
        </div>

        <br>
        <a href="./homepage-instagram.html" class="btn btn-primary">‚Üê Volver al Inicio</a>
    </div>

    <script>
        // Sistema de juego
        let selectedZone = null;
        let gameStats = getGameStats();
        let isGameInProgress = false;

        function getGameStats() {
            return JSON.parse(localStorage.getItem('futpro_penalty_stats') || JSON.stringify({
                goalsScored: 0,
                totalShots: 0,
                experience: 0,
                level: 1,
                currentStreak: 0,
                bestStreak: 0,
                playerName: localStorage.getItem('futpro_usuario_nombre') || 'Tu Jugador'
            }));
        }

        function saveGameStats() {
            localStorage.setItem('futpro_penalty_stats', JSON.stringify(gameStats));
        }

        function getRanking() {
            return JSON.parse(localStorage.getItem('futpro_penalty_ranking') || '[]');
        }

        function saveRanking(ranking) {
            localStorage.setItem('futpro_penalty_ranking', JSON.stringify(ranking));
        }

        function calculateLevel(exp) {
            return Math.floor(exp / 500) + 1;
        }

        function getExpForNextLevel(exp) {
            const currentLevelExp = (calculateLevel(exp) - 1) * 500;
            return exp - currentLevelExp;
        }

        function getPlayerRating(level) {
            const baseRating = 65;
            const increase = Math.min(level - 1, 9) * 3; // M√°ximo 92
            return Math.min(baseRating + increase, 99);
        }

        function getCardColor(level) {
            if (level >= 10) return 'var(--godlike)';
            if (level >= 9) return 'var(--legend)';
            if (level >= 8) return 'var(--challenger)';
            if (level >= 7) return 'var(--grandmaster)';
            if (level >= 6) return 'var(--master)';
            if (level >= 5) return 'var(--diamond)';
            if (level >= 4) return 'var(--platinum)';
            if (level >= 3) return 'var(--gold)';
            if (level >= 2) return 'var(--silver)';
            return 'var(--bronze)';
        }

        function updateUI() {
            const level = calculateLevel(gameStats.experience);
            const rating = getPlayerRating(level);
            const expProgress = getExpForNextLevel(gameStats.experience);
            const accuracy = gameStats.totalShots > 0 ? Math.round((gameStats.goalsScored / gameStats.totalShots) * 100) : 0;

            // Actualizar estad√≠sticas
            document.getElementById('goalsScored').textContent = gameStats.goalsScored;
            document.getElementById('totalShots').textContent = gameStats.totalShots;
            document.getElementById('accuracy').textContent = accuracy + '%';
            document.getElementById('experience').textContent = gameStats.experience;
            document.getElementById('currentStreak').textContent = gameStats.currentStreak;
            document.getElementById('bestStreak').textContent = gameStats.bestStreak;

            // Actualizar card FIFA
            document.getElementById('cardLevel').textContent = `LVL ${level}`;
            document.getElementById('playerName').textContent = gameStats.playerName;
            document.getElementById('playerRating').textContent = rating;
            document.getElementById('nextLevelExp').textContent = `${expProgress}/500`;

            // Actualizar stats de la card
            document.getElementById('shooting').textContent = Math.min(45 + level * 2, 99);
            document.getElementById('power').textContent = Math.min(50 + level * 2, 99);
            document.getElementById('mental').textContent = Math.min(35 + level * 3, 99);

            // Cambiar color de la card seg√∫n nivel
            const card = document.getElementById('playerCard');
            card.style.borderColor = getCardColor(level);
            card.querySelector('.card-level').style.background = getCardColor(level);
        }

        function selectZone(zoneIndex) {
            selectedZone = zoneIndex;
            document.querySelectorAll('.zone').forEach((zone, index) => {
                zone.classList.toggle('selected', index === zoneIndex);
            });
            document.getElementById('shootBtn').disabled = false;
        }

        function shootPenalty() {
            if (selectedZone === null || isGameInProgress) return;
            
            isGameInProgress = true;
            document.getElementById('shootBtn').disabled = true;
            document.getElementById('gameMessage').textContent = '‚öΩ Lanzando penalti...';

            // Animaci√≥n del arquero (movimiento aleatorio)
            const goalkeeper = document.getElementById('goalkeeper');
            const goalkeeperZone = Math.floor(Math.random() * 9);
            const positions = [
                'left: 10px', 'left: 50%; transform: translateX(-50%)', 'right: 10px',
                'left: 10px; bottom: 50px', 'left: 50%; transform: translateX(-50%); bottom: 50px', 'right: 10px; bottom: 50px',
                'left: 10px; bottom: 70px', 'left: 50%; transform: translateX(-50%); bottom: 70px', 'right: 10px; bottom: 70px'
            ];
            goalkeeper.style.cssText = positions[goalkeeperZone] + '; transition: all 0.5s ease;';

            // Animaci√≥n del bal√≥n
            const ball = document.getElementById('ball');
            const ballPositions = [
                'left: 25px; bottom: 80px',
                'left: 50%; transform: translateX(-50%); bottom: 80px',
                'right: 25px; bottom: 80px',
                'left: 25px; bottom: 50px',
                'left: 50%; transform: translateX(-50%); bottom: 50px',
                'right: 25px; bottom: 50px',
                'left: 25px; bottom: 20px',
                'left: 50%; transform: translateX(-50%); bottom: 20px',
                'right: 25px; bottom: 20px'
            ];
            ball.style.cssText = ballPositions[selectedZone] + '; transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);';

            setTimeout(() => {
                const isGoal = Math.random() < 0.15; // 15% probabilidad
                const goalkeeperSaved = selectedZone === goalkeeperZone;
                
                gameStats.totalShots++;
                
                if (isGoal && !goalkeeperSaved) {
                    gameStats.goalsScored++;
                    gameStats.experience += 25;
                    gameStats.currentStreak++;
                    gameStats.bestStreak = Math.max(gameStats.bestStreak, gameStats.currentStreak);
                    document.getElementById('gameMessage').innerHTML = 'üéâ <span style="color:#4CAF50">¬°GOOOOOL!</span> +25 EXP';
                    
                    // Efectos de gol
                    ball.style.background = '#4CAF50';
                    setTimeout(() => ball.style.background = '#fff', 1000);
                } else {
                    gameStats.experience += 5;
                    gameStats.currentStreak = 0;
                    if (goalkeeperSaved) {
                        document.getElementById('gameMessage').innerHTML = 'ü•Ö <span style="color:#f44336">¬°Atajado por el arquero!</span> +5 EXP';
                    } else {
                        document.getElementById('gameMessage').innerHTML = '‚ùå <span style="color:#f44336">¬°Fall√≥!</span> +5 EXP';
                    }
                    
                    // Efectos de fallo
                    ball.style.background = '#f44336';
                    setTimeout(() => ball.style.background = '#fff', 1000);
                }

                saveGameStats();
                updateUI();
                updateRanking();
                checkLevelUp();
                
                setTimeout(() => {
                    resetGame();
                    isGameInProgress = false;
                }, 2000);
                
            }, 800);
        }

        function checkLevelUp() {
            const newLevel = calculateLevel(gameStats.experience);
            const oldLevel = calculateLevel(gameStats.experience - (gameStats.goalsScored > 0 ? 25 : 5));
            
            if (newLevel > oldLevel) {
                setTimeout(() => {
                    alert(`üéâ ¬°SUBISTE DE NIVEL!\n\nNivel ${newLevel}\nRating: ${getPlayerRating(newLevel)}\n\n¬°Tus habilidades han mejorado!`);
                }, 2500);
            }
        }

        function resetGame() {
            selectedZone = null;
            document.querySelectorAll('.zone').forEach(zone => zone.classList.remove('selected'));
            document.getElementById('shootBtn').disabled = true;
            document.getElementById('gameMessage').textContent = 'Selecciona una zona para disparar';
            
            // Reset posiciones
            const ball = document.getElementById('ball');
            const goalkeeper = document.getElementById('goalkeeper');
            ball.style.cssText = 'bottom:150px;left:50%;transform:translateX(-50%);background:#fff';
            goalkeeper.style.cssText = 'bottom:30px;left:50%;transform:translateX(-50%)';
        }

        function updateRanking() {
            let ranking = getRanking();
            const playerIndex = ranking.findIndex(p => p.name === gameStats.playerName);
            
            const playerData = {
                name: gameStats.playerName,
                level: calculateLevel(gameStats.experience),
                goalsScored: gameStats.goalsScored,
                totalShots: gameStats.totalShots,
                accuracy: gameStats.totalShots > 0 ? Math.round((gameStats.goalsScored / gameStats.totalShots) * 100) : 0,
                experience: gameStats.experience
            };
            
            if (playerIndex >= 0) {
                ranking[playerIndex] = playerData;
            } else {
                ranking.push(playerData);
            }
            
            localStorage.setItem('futpro_ranking', JSON.stringify(ranking));
        }

        function updateStats() {
            document.getElementById('goalsScored').textContent = gameStats.goalsScored;
            document.getElementById('totalShots').textContent = gameStats.totalShots;
            document.getElementById('accuracy').textContent = gameStats.totalShots > 0 ? 
                Math.round((gameStats.goalsScored / gameStats.totalShots) * 100) + '%' : '0%';
            document.getElementById('experience').textContent = gameStats.experience;
            document.getElementById('currentStreak').textContent = gameStats.currentStreak;
            document.getElementById('bestStreak').textContent = gameStats.bestStreak;
    
            // Actualizar card
            const rating = Math.min(99, 65 + Math.floor(gameStats.experience / 100));
            document.getElementById('playerRating').textContent = rating;
            document.getElementById('cardLevel').textContent = 'LVL ' + Math.floor(gameStats.experience / 500 + 1);
    
            const shooting = Math.min(99, 45 + Math.floor(gameStats.experience / 200));
            const accuracy = Math.min(99, 40 + Math.floor(gameStats.goalsScored / 10));
            const power = Math.min(99, 50 + Math.floor(gameStats.totalShots / 20));
            const mental = Math.min(99, 35 + Math.floor(gameStats.currentStreak / 2));
    
            document.getElementById('shooting').textContent = shooting;
            document.getElementById('accuracy').textContent = accuracy;
            document.getElementById('power').textContent = power;
            document.getElementById('mental').textContent = mental;
    
            const nextLevel = (Math.floor(gameStats.experience / 500) + 1) * 500;
            document.getElementById('nextLevelExp').textContent = (nextLevel - gameStats.experience) + '/' + nextLevel + ' EXP';
        }

        function selectZoneAndShoot() {
            // Highlight zonas para seleccionar
            const zones = document.querySelectorAll('.zone');
            zones.forEach(zone => {
                zone.style.border = '2px solid #FFD700';
                zone.style.cursor = 'pointer';
                zone.onclick = () => selectZone(parseInt(zone.dataset.zone));
            });
    
            document.getElementById('gameMessage').textContent = 'üéØ Selecciona una zona para disparar';
            document.getElementById('shootBtn').disabled = true;
        }

        function selectZone(zoneNumber) {
            selectedZone = zoneNumber;
    
            // Limpiar highlight
            document.querySelectorAll('.zone').forEach(zone => {
                zone.style.border = '1px solid rgba(255,215,0,0.3)';
                zone.style.cursor = 'default';
                zone.onclick = null;
            });
    
            // Highlight zona seleccionada
            document.querySelector(`[data-zone="${zoneNumber}"]`).style.backgroundColor = 'rgba(255,215,0,0.6)';
    
            document.getElementById('gameMessage').textContent = `Zona ${zoneNumber} seleccionada. ¬°Prepar√°ndose para disparar!`;
    
            // Disparar autom√°ticamente despu√©s de 1 segundo
            setTimeout(() => {
                shootPenalty();
            }, 1000);
        }

        function shootPenalty() {
            if (selectedZone === null) {
                alert('¬°Primero selecciona una zona!');
                return;
            }

            const power = parseInt(document.getElementById('powerSlider').value);
            const ball = document.getElementById('ball');
            const goalkeeper = document.getElementById('goalkeeper');
    
            // Animaci√≥n del bal√≥n
            animateBall(selectedZone, power);
    
            // IA del portero
            const goalKeeperChoice = getGoalkeeperMove();
            animateGoalkeeper(goalKeeperChoice);
    
            // Evaluar resultado
            setTimeout(() => {
                evaluateShot(selectedZone, goalKeeperChoice, power);
            }, 800);
        }

        function animateBall(zone, power) {
            const ball = document.getElementById('ball');
            const positions = [
                {x: -80, y: 80}, {x: 0, y: 80}, {x: 80, y: 80},    // Fila superior
                {x: -80, y: 40}, {x: 0, y: 40}, {x: 80, y: 40},    // Fila media
                {x: -80, y: 0},  {x: 0, y: 0},  {x: 80, y: 0}     // Fila inferior
            ];
    
            const pos = positions[zone];
            ball.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            ball.style.transform = `translate(${pos.x}px, -${pos.y}px)`;
    
            // Efecto de potencia en el tama√±o
            const size = Math.max(12, 20 - power);
            ball.style.width = size + 'px';
            ball.style.height = size + 'px';
        }

        function animateGoalkeeper(direction) {
            const goalkeeper = document.getElementById('goalkeeper');
            const moves = [-60, -30, 0, 30, 60]; // Izquierda a derecha
    
            goalkeeper.style.transition = 'all 0.6s ease';
            goalkeeper.style.transform = `translateX(${moves[direction]}px)`;
        }

        function getGoalkeeperMove() {
            const difficulty = {
                'principiante': 0.3,
                        'profesional': 0.6,
                        'experto': 0.8,
                        'leyenda': 0.9
                    };
            
                    const difficultyLevel = difficulty[currentGoalkeeper] || 0.6;
            
                    // El portero tiene cierta probabilidad de ir en la direcci√≥n correcta
                    if (Math.random() < difficultyLevel) {
                        // Movimiento inteligente basado en estad√≠sticas
                        if (selectedZone <= 2) return 0; // Zona izquierda
                        if (selectedZone <= 5) return 2; // Zona centro
                        return 4; // Zona derecha
                    } else {
                        // Movimiento aleatorio
                        return Math.floor(Math.random() * 5);
                    }
                }

                function evaluateShot(ballZone, keeperZone, power) {
                    const ball = document.getElementById('ball');
                    const zones = [
                        [0, 1], [1, 2], [2, 3],  // Correspondencia zona-portero
                        [0, 1], [1, 2], [2, 3],
                        [0, 1], [1, 2], [2, 3]
                    ];
            
                    const ballDirection = zones[ballZone];
                    let isGoal = false;
            
                    // Evaluar si es gol
                    if (!ballDirection.includes(keeperZone)) {
                        isGoal = true;
                    } else {
                        // Hay posibilidad de gol a√∫n si el portero va en la direcci√≥n correcta
                        const powerBonus = power / 20; // Potencia puede superar al portero
                        const skillBonus = gameStats.experience / 10000; // Experiencia ayuda
                
                        if (Math.random() < (0.2 + powerBonus + skillBonus)) {
                            isGoal = true;
                        }
                    }
            
                    // Actualizar estad√≠sticas
                    gameStats.totalShots++;
            
                    if (isGoal) {
                        gameStats.goalsScored++;
                        gameStats.currentStreak++;
                        gameStats.bestStreak = Math.max(gameStats.bestStreak, gameStats.currentStreak);
                        gameStats.experience += 25 + (power * 2);
                        gameStats.zoneStats[ballZone]++;
                
                        showGoal();
                
                        // Actualizar card con nuevo gol
                        updatePlayerCard();
                    } else {
                        gameStats.currentStreak = 0;
                        gameStats.experience += 5;
                
                        showMiss();
                    }
            
                    // Guardar estad√≠sticas
                    localStorage.setItem('futpro_penalty_stats', JSON.stringify(gameStats));
                    updateStats();
            
                    // Reset despu√©s de 3 segundos
                    setTimeout(() => {
                        resetField();
                    }, 3000);
                }

                function showGoal() {
                    document.getElementById('gameMessage').innerHTML = '‚öΩ <span style="color:#4CAF50;">¬°GOOOOOL!</span> üéâ';
            
                    // Efecto visual de celebraci√≥n
                    const field = document.getElementById('field');
                    field.style.backgroundColor = '#4CAF50';
                    setTimeout(() => {
                        field.style.backgroundColor = '';
                    }, 1000);
                }

                function showMiss() {
                    document.getElementById('gameMessage').innerHTML = '‚ùå <span style="color:#f44336;">¬°Atajada!</span> üò¢';
            
                    // Efecto visual de fallo
                    const field = document.getElementById('field');
                    field.style.backgroundColor = '#f44336';
                    setTimeout(() => {
                        field.style.backgroundColor = '';
                    }, 1000);
                }

                function resetField() {
                    const ball = document.getElementById('ball');
                    const goalkeeper = document.getElementById('goalkeeper');
            
                    // Resetear posiciones
                    ball.style.transition = 'all 0.5s ease';
                    ball.style.transform = 'translateX(-50%)';
                    ball.style.width = '20px';
                    ball.style.height = '20px';
            
                    goalkeeper.style.transition = 'all 0.5s ease';
                    goalkeeper.style.transform = 'translateX(-50%)';
            
                    // Limpiar zona seleccionada
                    document.querySelectorAll('.zone').forEach(zone => {
                        zone.style.backgroundColor = 'rgba(255,215,0,0.1)';
                    });
            
                    selectedZone = null;
                    document.getElementById('shootBtn').disabled = false;
                    document.getElementById('gameMessage').textContent = '';
                }

                function updatePlayerCard() {
                    // Simular mejora en el card FIFA
                    const newStats = JSON.parse(localStorage.getItem('futpro_player_card') || '{}');
            
                    // Guardar estad√≠sticas en el card
                    newStats.penaltyGoals = gameStats.goalsScored;
                    newStats.penaltyAccuracy = gameStats.totalShots > 0 ? 
                        Math.round((gameStats.goalsScored / gameStats.totalShots) * 100) : 0;
                    newStats.experience = gameStats.experience;
            
                    localStorage.setItem('futpro_player_card', JSON.stringify(newStats));
                }

                function changeGoalkeeper() {
                    const keepers = ['principiante', 'profesional', 'experto', 'leyenda'];
                    const currentIndex = keepers.indexOf(currentGoalkeeper);
                    currentGoalkeeper = keepers[(currentIndex + 1) % keepers.length];
            
                    alert(`Portero cambiado a: ${currentGoalkeeper.toUpperCase()}`);
            
                    // Actualizar dificultad visual
                    const difficulty = document.querySelector('.stat-card p:first-of-type');
                    if (difficulty) {
                        const probabilities = {
                            'principiante': '70%',
                            'profesional': '40%', 
                            'experto': '20%',
                            'leyenda': '10%'
                        };
                        difficulty.innerHTML = `Probabilidad de gol: <strong style="color:#c00">${probabilities[currentGoalkeeper]}</strong>`;
                    }
                }

                function resetGame() {
                    if (confirm('¬øReiniciar todas las estad√≠sticas de penaltis?')) {
                        localStorage.removeItem('futpro_penalty_stats');
                        gameStats = {
                            goalsScored: 0,
                            totalShots: 0,
                            currentStreak: 0,
                            bestStreak: 0,
                            experience: 0,
                            level: 1,
                            zoneStats: {0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}
                        };
                        updateStats();
                        resetField();
                    }
                }

                function showRanking() {
                    const modal = document.getElementById('rankingModal');
                    const tbody = document.getElementById('rankingBody');
            
                    // Datos simulados del ranking global
                    const ranking = [
                        {name: 'Cristiano Ronaldo', level: 'LEY', goals: 127, efficiency: 94},
                        {name: 'Lionel Messi', level: 'LEY', goals: 118, efficiency: 89},
                        {name: 'Neymar Jr', level: 'EXP', goals: 89, efficiency: 87},
                        {name: 'Tu Jugador', level: Math.floor(gameStats.experience/500)+1, goals: gameStats.goalsScored, efficiency: gameStats.totalShots > 0 ? Math.round((gameStats.goalsScored/gameStats.totalShots)*100) : 0},
                        {name: 'Kylian Mbapp√©', level: 'EXP', goals: 76, efficiency: 85},
                        {name: 'Robert Lewandowski', level: 'PRO', goals: 92, efficiency: 83}
                    ];
            
                    // Ordenar por eficiencia
                    ranking.sort((a, b) => b.efficiency - a.efficiency);
            
                    tbody.innerHTML = '';
                    ranking.forEach((player, index) => {
                        const row = tbody.insertRow();
                        const isPlayer = player.name === 'Tu Jugador';
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td style="${isPlayer ? 'color:#FFD700;font-weight:bold;' : ''}">${player.name}</td>
                            <td>${player.level}</td>
                            <td>${player.goals}</td>
                            <td>${player.efficiency}%</td>
                        `;
                    });
            
                    modal.style.display = 'flex';
                }

                function showLevelSystem() {
                    document.getElementById('levelModal').style.display = 'flex';
                }

                function closeModal(modalId) {
                    document.getElementById(modalId).style.display = 'none';
                }

                // Event listener para el slider de potencia
                document.getElementById('powerSlider').addEventListener('input', function() {
                    document.getElementById('powerValue').textContent = this.value;
                });

                // Inicializar el juego
                updateStats();
        
                // Agregar efectos de hover a las zonas
                document.querySelectorAll('.zone').forEach((zone, index) => {
                    zone.addEventListener('mouseenter', function() {
                        if (selectedZone === null) {
                            this.style.backgroundColor = 'rgba(255,215,0,0.3)';
                        }
                    });
            
                    zone.addEventListener('mouseleave', function() {
                        if (selectedZone === null) {
                            this.style.backgroundColor = 'rgba(255,215,0,0.1)';
                        }
                    });
                });