<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico React - FutPro 2.0</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            line-height: 1.6;
        }
        
        .diagnostic-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .status-good { border-left: 5px solid #10B981; }
        .status-warning { border-left: 5px solid #F59E0B; }
        .status-error { border-left: 5px solid #EF4444; }
        
        .code-block {
            background: rgba(0, 0, 0, 0.4);
            padding: 1.5rem;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
            overflow-x: auto;
            font-size: 0.9rem;
        }
        
        .success { color: #10B981; }
        .warning { color: #F59E0B; }
        .error { color: #EF4444; }
        .info { color: #3B82F6; }
        
        button {
            background: linear-gradient(45deg, #10B981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .log-entry {
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.85rem;
        }
        
        .log-error { background: rgba(239, 68, 68, 0.2); border-left: 3px solid #EF4444; }
        .log-warning { background: rgba(245, 158, 11, 0.2); border-left: 3px solid #F59E0B; }
        .log-info { background: rgba(59, 130, 246, 0.2); border-left: 3px solid #3B82F6; }
        .log-success { background: rgba(16, 185, 129, 0.2); border-left: 3px solid #10B981; }
        
        .test-section {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 10px;
        }
        
        .spinner {
            display: inline-block;
            margin-left: 10px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="diagnostic-card">
        <h1>🔍 Diagnóstico React - FutPro 2.0</h1>
        <p><strong>Problema:</strong> Pantalla negra en futpro.vip</p>
        <p><strong>Objetivo:</strong> Identificar el error que impide que React se renderice</p>
        <p><strong>Timestamp:</strong> <span id="timestamp"></span></p>
    </div>

    <div class="diagnostic-card status-warning">
        <h2>🏥 Estado del Sistema</h2>
        <div id="systemStatus">
            <p class="warning">🔄 Inicializando diagnóstico...</p>
        </div>
    </div>

    <div class="diagnostic-card">
        <h2>📊 Tests Automáticos</h2>
        <div class="test-section">
            <button onclick="runAllTests()">🚀 Ejecutar Todos los Tests</button>
            <button onclick="testReactBundle()">📦 Test Bundle React</button>
            <button onclick="testSupabaseConnection()">🔗 Test Supabase</button>
            <button onclick="testEnvironmentVars()">🌍 Test Variables de Entorno</button>
        </div>
        
        <div id="testResults"></div>
    </div>

    <div class="diagnostic-card">
        <h2>📝 Console Logs</h2>
        <div id="consoleLogs" class="code-block" style="max-height: 400px; overflow-y: auto;">
            <p class="info">📋 Los logs aparecerán aquí...</p>
        </div>
        <button onclick="clearLogs()">🗑️ Limpiar Logs</button>
        <button onclick="exportLogs()">💾 Exportar Logs</button>
    </div>

    <div class="diagnostic-card">
        <h2>🔧 Acciones de Reparación</h2>
        <div class="test-section">
            <h3>💊 Fixes Rápidos:</h3>
            <button onclick="clearCaches()">🧹 Limpiar Caches</button>
            <button onclick="resetLocalStorage()">🔄 Reset LocalStorage</button>
            <button onclick="forceReload()">⚡ Reload Forzado</button>
        </div>
        
        <div class="test-section">
            <h3>🔥 Fixes Avanzados:</h3>
            <button onclick="testNetlifyBuild()">🏗️ Test Build Netlify</button>
            <button onclick="testEnvironmentConfig()">⚙️ Test Config Entorno</button>
            <button onclick="recreateApp()">🔄 Recrear App</button>
        </div>
    </div>

    <div class="diagnostic-card">
        <h2>📈 Métricas en Tiempo Real</h2>
        <div id="metrics" class="code-block">
            <p>🔄 Cargando métricas...</p>
        </div>
    </div>

    <script>
        // Variables globales
        let logs = [];
        let testResults = {};
        
        // Actualizar timestamp
        document.getElementById('timestamp').textContent = new Date().toLocaleString('es-ES');

        // Interceptar console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addLog(level, message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push({ level, message, timestamp });
            updateLogDisplay();
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('info', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('error', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog('warning', args.join(' '));
        };

        function updateLogDisplay() {
            const container = document.getElementById('consoleLogs');
            container.innerHTML = logs.map(log => `
                <div class="log-entry log-${log.level}">
                    <strong>[${log.timestamp}]</strong> ${log.message}
                </div>
            `).join('');
            container.scrollTop = container.scrollHeight;
        }

        function clearLogs() {
            logs = [];
            updateLogDisplay();
        }

        function exportLogs() {
            const dataStr = JSON.stringify(logs, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `futpro-diagnostic-${Date.now()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Tests específicos
        async function testReactBundle() {
            console.log('🧪 [TEST] Testing React Bundle...');
            
            try {
                // Test 1: Verificar si React está disponible
                if (typeof React !== 'undefined') {
                    console.log('✅ React está disponible globalmente');
                } else {
                    console.error('❌ React no está disponible globalmente');
                }
                
                // Test 2: Verificar elemento root
                const rootElement = document.getElementById('root');
                if (rootElement) {
                    console.log('✅ Elemento #root encontrado');
                    console.log(`📦 Contenido del root: "${rootElement.innerHTML.substring(0, 100)}..."`);
                } else {
                    console.error('❌ Elemento #root NO encontrado');
                }
                
                // Test 3: Verificar scripts de React en DOM
                const scripts = Array.from(document.querySelectorAll('script[src*="index"]'));
                console.log(`📜 Scripts React encontrados: ${scripts.length}`);
                scripts.forEach((script, i) => {
                    console.log(`  Script ${i+1}: ${script.src}`);
                });
                
                return true;
            } catch (error) {
                console.error('❌ Error en test React Bundle:', error);
                return false;
            }
        }

        async function testSupabaseConnection() {
            console.log('🧪 [TEST] Testing Supabase Connection...');
            
            try {
                // Test variables de entorno
                const supabaseUrl = 'https://qqrxetxcglwrejtblwut.supabase.co';
                console.log(`🔗 Supabase URL: ${supabaseUrl}`);
                
                // Test conectividad
                const response = await fetch(`${supabaseUrl}/rest/v1/`, {
                    method: 'GET',
                    headers: {
                        'apikey': 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFxcnhldHhjZ2x3cmVqdGJsd3V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjU5MTMyMTAsImV4cCI6MjA0MTQ4OTIxMH0.QG9rDBd7s7LgCUzNHVJEsqsXZPJNUhgUTW3zzC2o2ko',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    console.log('✅ Supabase conectividad OK');
                } else {
                    console.error(`❌ Supabase error: ${response.status}`);
                }
                
                return response.ok;
            } catch (error) {
                console.error('❌ Error en test Supabase:', error);
                return false;
            }
        }

        async function testEnvironmentVars() {
            console.log('🧪 [TEST] Testing Environment Variables...');
            
            const requiredVars = [
                'VITE_SUPABASE_URL',
                'VITE_SUPABASE_ANON_KEY',
                'VITE_GOOGLE_CLIENT_ID'
            ];
            
            let allGood = true;
            
            // En el navegador, las variables VITE_ no están disponibles directamente
            // Pero podemos verificar si la app está configurada correctamente
            console.log('🌍 Verificando configuración de entorno...');
            console.log(`🏠 Location: ${window.location.origin}`);
            console.log(`🔧 User Agent: ${navigator.userAgent}`);
            
            // Verificar si estamos en producción
            const isProduction = window.location.hostname === 'futpro.vip';
            console.log(`🏭 Es producción: ${isProduction}`);
            
            return allGood;
        }

        async function testNetlifyBuild() {
            console.log('🧪 [TEST] Testing Netlify Build Status...');
            
            try {
                // Verificar headers de Netlify
                const response = await fetch(window.location.href, { method: 'HEAD' });
                const headers = {};
                for (let [key, value] of response.headers.entries()) {
                    headers[key] = value;
                }
                
                console.log('📋 Headers de Netlify:');
                console.log(`  Server: ${headers.server || 'N/A'}`);
                console.log(`  X-Nf-Request-Id: ${headers['x-nf-request-id'] || 'N/A'}`);
                console.log(`  Content-Type: ${headers['content-type'] || 'N/A'}`);
                
                // Verificar si hay CSP que bloquee
                const csp = headers['content-security-policy'];
                if (csp) {
                    console.log(`🛡️ CSP detectado: ${csp.substring(0, 100)}...`);
                }
                
                return true;
            } catch (error) {
                console.error('❌ Error en test Netlify:', error);
                return false;
            }
        }

        // Acciones de reparación
        function clearCaches() {
            console.log('🧹 Limpiando caches...');
            
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                        console.log(`🗑️ Cache eliminado: ${name}`);
                    });
                });
            }
            
            // Limpiar localStorage parcialmente
            const keysToKeep = ['theme', 'language'];
            const toRemove = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (!keysToKeep.includes(key)) {
                    toRemove.push(key);
                }
            }
            
            toRemove.forEach(key => {
                localStorage.removeItem(key);
                console.log(`🗑️ LocalStorage eliminado: ${key}`);
            });
            
            console.log('✅ Caches limpiados');
        }

        function resetLocalStorage() {
            console.log('🔄 Reseteando LocalStorage...');
            localStorage.clear();
            console.log('✅ LocalStorage reseteado');
        }

        function forceReload() {
            console.log('⚡ Forzando reload...');
            window.location.reload(true);
        }

        async function runAllTests() {
            console.log('🚀 Ejecutando todos los tests...');
            
            const tests = [
                { name: 'React Bundle', fn: testReactBundle },
                { name: 'Supabase Connection', fn: testSupabaseConnection },
                { name: 'Environment Variables', fn: testEnvironmentVars },
                { name: 'Netlify Build', fn: testNetlifyBuild }
            ];
            
            const results = {};
            
            for (const test of tests) {
                console.log(`🧪 Ejecutando ${test.name}...`);
                try {
                    results[test.name] = await test.fn();
                    console.log(`${results[test.name] ? '✅' : '❌'} ${test.name}: ${results[test.name] ? 'PASS' : 'FAIL'}`);
                } catch (error) {
                    results[test.name] = false;
                    console.error(`❌ ${test.name}: ERROR - ${error.message}`);
                }
            }
            
            // Mostrar resumen
            const passed = Object.values(results).filter(Boolean).length;
            const total = Object.keys(results).length;
            
            console.log(`📊 Resumen: ${passed}/${total} tests pasaron`);
            
            testResults = results;
            updateTestResults();
        }

        function updateTestResults() {
            const container = document.getElementById('testResults');
            const html = Object.entries(testResults).map(([name, passed]) => `
                <div class="log-entry log-${passed ? 'success' : 'error'}">
                    ${passed ? '✅' : '❌'} ${name}: ${passed ? 'PASS' : 'FAIL'}
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // Métricas en tiempo real
        function updateMetrics() {
            const metrics = {
                'Memoria usada': `${(performance.memory?.usedJSHeapSize / 1024 / 1024).toFixed(1)} MB` || 'N/A',
                'Conexiones': navigator.onLine ? 'Online' : 'Offline',
                'Cookies habilitadas': navigator.cookieEnabled ? 'Sí' : 'No',
                'Service Worker': 'serviceWorker' in navigator ? 'Disponible' : 'No disponible',
                'LocalStorage': typeof(Storage) !== 'undefined' ? 'Disponible' : 'No disponible'
            };
            
            const html = Object.entries(metrics).map(([key, value]) => `
                <strong>${key}:</strong> ${value}<br>
            `).join('');
            
            document.getElementById('metrics').innerHTML = html;
        }

        // Inicialización
        setTimeout(() => {
            console.log('🔥 Diagnóstico React inicializado');
            updateMetrics();
            
            // Ejecutar test inicial
            runAllTests();
        }, 1000);

        // Actualizar métricas cada 5 segundos
        setInterval(updateMetrics, 5000);
    </script>
</body>
</html>