<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Diagn√≥stico FutPro - Problemas de Navegaci√≥n</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-card {
            background: #2a2a2a;
            border: 2px solid #FFD700;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .success { background: #22c55e; color: white; }
        .error { background: #ef4444; color: white; }
        .warning { background: #f59e0b; color: white; }
        .info { background: #3b82f6; color: white; }
        button {
            background: #FFD700;
            color: #1a1a1a;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #fbbf24;
        }
        #console {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            height: 300px;
            overflow-y: scroll;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Diagn√≥stico FutPro</h1>
            <h2>Resolver problemas de navegaci√≥n "Crear Usuario"</h2>
        </div>

        <div class="test-card">
            <h3>üöÄ Tests Autom√°ticos</h3>
            <button onclick="runAllTests()">Ejecutar Todos los Tests</button>
            <button onclick="clearConsole()">Limpiar Consola</button>
            <button onclick="testNavigation()">Test Navegaci√≥n</button>
            <button onclick="testRegistroForm()">Test Formulario</button>
            <div id="testResults"></div>
        </div>

        <div class="test-card">
            <h3>üìä Consola de Debug</h3>
            <div id="console"></div>
        </div>

        <div class="test-card">
            <h3>üîç Tests Manuales</h3>
            <button onclick="testCreateUserButton()">Test Bot√≥n "Crear Usuario"</button>
            <button onclick="simulateRegistration()">Simular Registro Completo</button>
            <button onclick="checkRoutes()">Verificar Rutas</button>
            <button onclick="testRedirection()">Test Redirecci√≥n a Home</button>
        </div>

        <div class="test-card">
            <h3>üõ†Ô∏è Acciones de Reparaci√≥n</h3>
            <button onclick="clearBrowserData()">Limpiar Datos del Navegador</button>
            <button onclick="resetAppState()">Reset Estado de App</button>
            <button onclick="forceReload()">Recargar Forzado</button>
        </div>
    </div>

    <script>
        let console_div = document.getElementById('console');
        let results_div = document.getElementById('testResults');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#0ff',
                success: '#0f0', 
                error: '#f00',
                warning: '#ff0'
            };
            
            console_div.innerHTML += `<span style="color: ${colors[type]}">[${timestamp}] ${message}</span><br>`;
            console_div.scrollTop = console_div.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function addResult(test, status, message) {
            const resultClass = status === 'success' ? 'success' : status === 'error' ? 'error' : 'warning';
            results_div.innerHTML += `<div class="test-result ${resultClass}"><strong>${test}:</strong> ${message}</div>`;
        }

        function clearConsole() {
            console_div.innerHTML = '';
            results_div.innerHTML = '';
        }

        // Test 1: Verificar que React Router est√© funcionando
        function testReactRouter() {
            log('üîç Verificando React Router...', 'info');
            
            if (typeof window.React !== 'undefined') {
                log('‚úÖ React detectado', 'success');
                addResult('React', 'success', 'React est√° cargado correctamente');
            } else {
                log('‚ùå React no detectado', 'error');
                addResult('React', 'error', 'React no est√° cargado');
            }

            // Verificar si hay errores de JavaScript
            if (window.lastJSError) {
                log(`‚ùå Error JS detectado: ${window.lastJSError}`, 'error');
                addResult('JavaScript', 'error', window.lastJSError);
            } else {
                log('‚úÖ No hay errores JS cr√≠ticos', 'success');
                addResult('JavaScript', 'success', 'Sin errores cr√≠ticos detectados');
            }
        }

        // Test 2: Verificar navegaci√≥n program√°tica
        function testNavigation() {
            log('üöÄ Probando navegaci√≥n program√°tica...', 'info');
            
            try {
                // Simular click en crear usuario
                const currentUrl = window.location.href;
                log(`üìç URL actual: ${currentUrl}`, 'info');
                
                // Intentar navegar a registro-nuevo
                if (currentUrl.includes('futpro.vip')) {
                    window.location.href = 'https://futpro.vip/registro-nuevo';
                    log('üîÑ Navegando a registro-nuevo...', 'info');
                    addResult('Navegaci√≥n', 'success', 'Navegaci√≥n iniciada');
                } else {
                    log('‚ö†Ô∏è No estamos en futpro.vip', 'warning');
                    addResult('Navegaci√≥n', 'warning', 'URL no es de producci√≥n');
                }
            } catch (error) {
                log(`‚ùå Error en navegaci√≥n: ${error.message}`, 'error');
                addResult('Navegaci√≥n', 'error', error.message);
            }
        }

        // Test 3: Verificar formulario de registro
        function testRegistroForm() {
            log('üìù Verificando formulario de registro...', 'info');
            
            // Crear iframe para cargar la p√°gina de registro
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = window.location.origin + '/registro-nuevo';
            
            iframe.onload = function() {
                try {
                    log('‚úÖ P√°gina de registro cargada', 'success');
                    addResult('Formulario Registro', 'success', 'P√°gina accesible');
                } catch (error) {
                    log(`‚ùå Error cargando registro: ${error.message}`, 'error');
                    addResult('Formulario Registro', 'error', error.message);
                }
            };
            
            iframe.onerror = function() {
                log('‚ùå Error cargando p√°gina de registro', 'error');
                addResult('Formulario Registro', 'error', 'No se pudo cargar la p√°gina');
            };
            
            document.body.appendChild(iframe);
            
            // Limpiar despu√©s de 5 segundos
            setTimeout(() => {
                document.body.removeChild(iframe);
            }, 5000);
        }

        // Test 4: Simular bot√≥n crear usuario
        function testCreateUserButton() {
            log('üë§ Simulando click en "Crear Usuario"...', 'info');
            
            // Verificar localStorage
            const authData = {
                authCompleted: localStorage.getItem('authCompleted'),
                loginSuccess: localStorage.getItem('loginSuccess'),
                session: localStorage.getItem('session')
            };
            
            log(`üíæ Datos localStorage: ${JSON.stringify(authData)}`, 'info');
            
            // Simular click
            setTimeout(() => {
                try {
                    window.location.href = window.location.origin + '/registro-nuevo';
                    log('üîÑ Redirigiendo a registro-nuevo...', 'success');
                    addResult('Bot√≥n Crear Usuario', 'success', 'Redirecci√≥n iniciada');
                } catch (error) {
                    log(`‚ùå Error en redirecci√≥n: ${error.message}`, 'error');
                    addResult('Bot√≥n Crear Usuario', 'error', error.message);
                }
            }, 1000);
        }

        // Test 5: Simular registro completo
        function simulateRegistration() {
            log('üìã Simulando registro completo...', 'info');
            
            const testUser = {
                email: 'test@futpro.com',
                nombre: 'Test User',
                apellido: 'FutPro',
                edad: 25,
                posicion: 'Delantero'
            };
            
            // Simular datos en localStorage
            localStorage.setItem('futpro_registro_progreso', JSON.stringify(testUser));
            localStorage.setItem('registroCompleto', 'true');
            localStorage.setItem('authCompleted', 'true');
            
            log('‚úÖ Datos de registro simulados guardados', 'success');
            addResult('Registro Simulado', 'success', 'Datos guardados en localStorage');
            
            // Intentar navegar a home
            setTimeout(() => {
                window.location.href = window.location.origin + '/home';
                log('üè† Navegando a home...', 'info');
            }, 2000);
        }

        // Test 6: Verificar rutas
        function checkRoutes() {
            log('üó∫Ô∏è Verificando rutas disponibles...', 'info');
            
            const routes = [
                '/login',
                '/registro-nuevo', 
                '/home',
                '/perfil-card',
                '/auth/callback'
            ];
            
            routes.forEach(route => {
                const url = window.location.origin + route;
                log(`üîç Verificando: ${url}`, 'info');
                
                fetch(url, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            log(`‚úÖ ${route} - OK`, 'success');
                            addResult(`Ruta ${route}`, 'success', 'Disponible');
                        } else {
                            log(`‚ö†Ô∏è ${route} - ${response.status}`, 'warning');
                            addResult(`Ruta ${route}`, 'warning', `Status: ${response.status}`);
                        }
                    })
                    .catch(error => {
                        log(`‚ùå ${route} - Error: ${error.message}`, 'error');
                        addResult(`Ruta ${route}`, 'error', error.message);
                    });
            });
        }

        // Test 7: Test redirecci√≥n a home
        function testRedirection() {
            log('üè† Probando redirecci√≥n a home...', 'info');
            
            // Simular usuario autenticado
            const mockUser = {
                id: 'test-user-id',
                email: 'test@futpro.com',
                authenticated: true
            };
            
            localStorage.setItem('session', JSON.stringify(mockUser));
            localStorage.setItem('userLoggedIn', JSON.stringify(mockUser));
            localStorage.setItem('authCompleted', 'true');
            
            log('‚úÖ Usuario mock creado', 'success');
            addResult('Usuario Mock', 'success', 'Datos de sesi√≥n simulados');
            
            setTimeout(() => {
                window.location.href = window.location.origin + '/home';
                log('üîÑ Redirigiendo a home...', 'info');
            }, 1000);
        }

        // Acciones de reparaci√≥n
        function clearBrowserData() {
            log('üßπ Limpiando datos del navegador...', 'info');
            
            localStorage.clear();
            sessionStorage.clear();
            
            // Limpiar cookies
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            
            log('‚úÖ Datos limpiados', 'success');
            addResult('Limpieza', 'success', 'LocalStorage y cookies limpiados');
        }

        function resetAppState() {
            log('üîÑ Reseteando estado de la aplicaci√≥n...', 'info');
            
            // Limpiar datos espec√≠ficos de FutPro
            const futproKeys = Object.keys(localStorage).filter(key => 
                key.includes('futpro') || 
                key.includes('auth') || 
                key.includes('user') ||
                key.includes('registro')
            );
            
            futproKeys.forEach(key => {
                localStorage.removeItem(key);
                log(`üóëÔ∏è Removido: ${key}`, 'info');
            });
            
            log('‚úÖ Estado reseteado', 'success');
            addResult('Reset Estado', 'success', `${futproKeys.length} claves removidas`);
        }

        function forceReload() {
            log('üîÑ Recargando p√°gina forzadamente...', 'info');
            window.location.reload(true);
        }

        // Ejecutar todos los tests
        function runAllTests() {
            clearConsole();
            log('üöÄ Iniciando diagn√≥stico completo de FutPro...', 'info');
            
            testReactRouter();
            
            setTimeout(() => testNavigation(), 1000);
            setTimeout(() => testRegistroForm(), 2000);
            setTimeout(() => checkRoutes(), 3000);
            
            log('üìä Tests programados para ejecuci√≥n', 'success');
        }

        // Capturar errores JavaScript
        window.addEventListener('error', function(e) {
            window.lastJSError = e.message;
            log(`üí• Error JS capturado: ${e.message}`, 'error');
        });

        // Auto-ejecutar tests b√°sicos al cargar
        window.addEventListener('load', function() {
            log('üîç P√°gina cargada, ejecutando tests b√°sicos...', 'info');
            runAllTests();
        });
    </script>
</body>
</html>