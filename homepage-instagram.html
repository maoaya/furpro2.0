<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FutPro - Home</title>
    <script>
    // Validaci√≥n de sesi√≥n y redirecci√≥n post-login
    document.addEventListener('DOMContentLoaded', function() {
        const user = JSON.parse(localStorage.getItem('futpro_user') || '{}');
        if (!user || !user.id) {
            window.location.href = './index.html';
            return;
        }
        // Mostrar datos del usuario en el header
        const header = document.querySelector('.header');
        if (header) {
            let userInfo = document.createElement('div');
            userInfo.style = 'color:#FFD700;font-weight:bold;font-size:1.1em;margin-left:18px;display:flex;align-items:center;gap:8px;';
            userInfo.innerHTML = `<img src='${user.foto || 'https://via.placeholder.com/40x40.png?text=Avatar'}' style='width:32px;height:32px;border-radius:50%;border:2px solid #FFD700;'> <span>${user.nombre || 'Usuario'}</span> <span style='font-size:0.9em;color:#ccc;'>${user.email || ''}</span>`;
            header.appendChild(userInfo);
        }
    });
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ANIMACIONES PARA ALERTAS Y NOTIFICACIONES */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes badgeJump {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .filtro-alertas.active, .filtro-chat.active {
            animation: badgeJump 0.3s ease;
        }

        #alertasBadge, #chatBadge {
            animation: badgeJump 0.5s ease infinite;
        }

        .mensaje-enviado {
            animation: slideInRight 0.3s ease;
        }

        /* MEN√ö HAMBURGUESA MEJORADO */
        .dropdown-menu {
            background: #111 !important;
            border: 3px solid #FFD700 !important;
            border-radius: 28px !important;
            box-shadow: 0 12px 48px #000a !important;
            color: #FFD700 !important;
            min-width: 350px !important;
            max-width: 420px !important;
            max-height: 85vh !important;
            padding: 32px 0 20px 0 !important;
        }
        .dropdown-menu .menu-section-title {
            color: #FFD700 !important;
            font-size: 1.05rem;
            font-weight: bold;
            margin: 18px 0 8px 28px;
            padding: 0;
            letter-spacing: 1px;
        }
        .dropdown-menu .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #FFD700 !important;
            background: none !important;
            border: none !important;
            font-size: 1.08rem;
            font-weight: 500;
            text-decoration: none !important;
            margin: 0 0 6px 0;
            padding: 10px 32px 10px 32px;
            border-radius: 12px;
            transition: background 0.2s, color 0.2s;
        }
        .dropdown-menu .dropdown-item:hover {
            background: rgba(255,215,0,0.08) !important;
            color: #181818 !important;
        }
        .dropdown-menu .dropdown-item i {
            color: #FFD700 !important;
            font-size: 1.25rem;
            min-width: 24px;
        }
        .dropdown-menu .menu-separator {
            background: linear-gradient(90deg, transparent, #FFD700 60%, transparent);
            height: 2px;
            margin: 10px 18px;
            border: none;
        }
        .dropdown-menu a {
            color: #FFD700 !important;
            text-decoration: none !important;
            outline: none !important;
        }
        .dropdown-menu a:visited, .dropdown-menu a:active {
            color: #FFD700 !important;
        }
        .dropdown-menu a:focus {
            background: rgba(255,215,0,0.12) !important;
        }
        /* Fondo negro para todo el body y bloques principales */
        body, .main-content, .stories-container, .post {
            background: #111 !important;
        }
        /* Eliminar subrayado y azul de todos los links */
        a, a:visited, a:active {
            color: #FFD700 !important;
            text-decoration: none !important;
        }
        /* Mejorar separaci√≥n visual en men√∫ */
        .dropdown-menu .dropdown-item:not(:last-child) {
            margin-bottom: 8px;
        }
        /* Mejorar t√≠tulos de secci√≥n */
        .dropdown-menu .menu-section-title {
            margin-top: 18px;
            margin-bottom: 6px;
        }
        /* Quitar bordes blancos de stories y posts */
        .stories-container, .post {
            border: 3px solid #FFD700 !important;
        }
        /* Mejorar visual de avatar en stories */
        .story-avatar {
            border: 3px solid #FFD700 !important;
            background: #181818 !important;
        }
        .avatar-circular {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #FFD700;
            margin-right: 8px;
            box-shadow: 0 2px 8px #0004;
            background: #222;
        }
        .badge-rol {
            background: #FFD700;
            color: #181818;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }

        .dropdown-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05));
            transition: width 0.3s ease;
            z-index: -1;
        }

        .dropdown-item:hover::before {
            width: 100%;
        }

        .dropdown-item:hover {
            background: rgba(255, 215, 0, 0.1);
            color: #FFD700;
            transform: translateX(5px);
            border-left: 3px solid #FFD700;
        }

        .dropdown-item i {
            width: 24px;
            text-align: center;
            color: #FFD700;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .dropdown-item:hover i {
            transform: scale(1.2);
            color: #FFA500;
        }

        .dropdown-item span {
            font-weight: 500;
            font-size: 15px;
        }

        /* ANIMACI√ìN ENTRADA ITEMS */
        .dropdown-item {
            opacity: 0;
            transform: translateX(-20px);
            animation: slideInItems 0.4s ease forwards;
        }

        @keyframes slideInItems {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* SEPARADORES DE MEN√ö */
        .menu-separator {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            margin: 8px 20px;
        }

        .menu-section-title {
            padding: 10px 25px 5px;
            font-size: 12px;
            font-weight: bold;
            color: #FFD700;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        /* CONTENIDO PRINCIPAL */
        .main-content {
            max-width: 600px;
            margin: 0 auto;
            padding: 80px 20px 20px;
        }

        /* STORIES CONTAINER */
        .stories-container {
            display: flex;
            gap: 15px;
            padding: 20px 15px;
            overflow-x: auto;
            margin-bottom: 10px;
            background: rgba(30, 30, 30, 0.7);
            border-radius: 12px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .stories-container::-webkit-scrollbar {
            display: none;
        }

        .story {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
            cursor: pointer;
        }

        .story-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            padding: 3px;
        }

        .story-username {
            font-size: 12px;
            text-align: center;
            color: #ccc;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* MURO DE PUBLICACIONES ESTILO INSTAGRAM */
        .post {
            background: rgba(30, 30, 30, 0.9);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .post-header {
            display: flex;
            align-items: center;
            padding: 15px;
            gap: 12px;
        }

        .post-user-info {
            flex: 1;
        }

        .post-username {
            font-weight: bold;
            color: #fff;
            font-size: 14px;
        }

        .post-location {
            font-size: 12px;
            color: #888;
        }

        .post-options {
            color: #ccc;
            cursor: pointer;
        }

        .post-image {
            width: 100%;
            height: 400px;
            overflow: hidden;
        }

        .post-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px 8px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
        }

        .action-buttons i {
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .like-btn:hover { color: #ff3040; }
        .comment-btn:hover { color: #FFD700; }
        .share-btn:hover { color: #FFD700; }
        .save-btn:hover { color: #FFD700; }

        .liked { color: #ff3040; }

        .post-info {
            padding: 0 15px 15px;
        }

        .likes {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
            display: block;
        }

        .post-description {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .post-time {
            font-size: 12px;
            color: #888;
        }

        .action-button {
            background: #FFD700;
            border: none;
            border-radius: 15px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #000;
        }

        .post-info h4 {
            color: #FFD700;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .post-info p {
            color: #999;
            font-size: 12px;
        }

        .post-image {
            width: 100%;
            height: 300px;
            background: linear-gradient(45deg, #2d2d2d, #1a1a1a);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 48px;
        }

        .post-content {
            padding: 15px;
        }

        .post-actions {
            display: flex;
            gap: 20px;
            padding: 0 15px 15px;
        }

        .action-btn {
            background: none;
            border: none;
            color: #FFD700;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            color: #FFA500;
            transform: scale(1.1);
        }

        .action-btn span {
            font-size: 14px;
        }

        /* BARRA DE NAVEGACI√ìN INFERIOR */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(20, 20, 20, 0.98);
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(255, 215, 0, 0.3);
            padding: 12px 0;
            z-index: 1000;
        }

        .nav-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            color: #666;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 8px;
        }

        .nav-item.active,
        .nav-item:hover {
            color: #FFD700;
            background: rgba(255, 215, 0, 0.1);
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item span {
            font-size: 10px;
            font-weight: 500;
        }

        /* ANIMACIONES */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .post {
            animation: fadeInUp 0.6s ease forwards;
        }

        /* PERFIL CARD EN DROPDOWN */
        .profile-card {
            padding: 20px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.2);
            text-align: center;
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #000;
            font-size: 24px;
            margin: 0 auto 10px;
        }

        .profile-name {
            color: #FFD700;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-position {
            color: #999;
            font-size: 12px;
        }

        /* RESPONSIVE */
        @media (max-width: 480px) {
            .main-content {
                padding: 80px 10px 20px;
            }
            
            .dropdown-menu {
                min-width: 220px;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER MODERNO CON MEN√ö HAMBURGUESA Y B√öSQUEDA -->
    <div class="header" style="position:relative;background:#181818;border-bottom:3px solid #FFD700;min-height:74px;z-index:10001;">
        <div style="display:flex;align-items:center;justify-content:space-between;padding:0 40px;">
            <div class="logo" style="font-size:2.2rem;font-weight:bold;color:#FFD700;letter-spacing:1px;">‚öΩ FutPro</div>
            <div style="display:flex;align-items:center;gap:28px;">
                <div class="search-bar" style="position:relative;">
                    <input id="searchInput" type="text" placeholder="Buscar equipo o usuario..." style="background:#222;border:2px solid #FFD700;color:#FFD700;padding:12px 40px 12px 18px;border-radius:24px;font-size:1.15rem;outline:none;width:240px;transition:box-shadow 0.2s;">
                    <i class="fas fa-search" style="position:absolute;right:16px;top:50%;transform:translateY(-50%);color:#FFD700;font-size:1.3rem;"></i>
                </div>
                <button class="hamburger-btn" onclick="toggleMenu()" style="background:rgba(24,24,24,0.98);border:none;border-radius:50%;padding:16px 18px;box-shadow:0 2px 16px #000a;cursor:pointer;z-index:10001;transition:background 0.2s;">
                    <i class="fas fa-bars" style="font-size:1.8rem;color:#FFD700;"></i>
                </button>
            </div>
        </div>
        <div class="dropdown-menu" id="dropdownMenu" style="display:none;top:74px;right:48px;position:absolute;z-index:10000;overflow-y:auto;overflow-x:hidden;">
                    <!-- SECCI√ìN PRINCIPAL -->
                    <div class="menu-section-title">Principal</div>
                    <a href="#" class="dropdown-item" onclick="irAInicio(); return false;"><i class="fas fa-home"></i><span>Inicio</span></a>
                    <a href="#" class="dropdown-item" onclick="irAPerfil(); return false;"><i class="fas fa-user-circle"></i><span>Mi Perfil</span></a>
                    <a href="#" class="dropdown-item" onclick="editarPerfil(); return false;"><i class="fas fa-edit"></i><span>Editar Perfil</span></a>
                    <a href="#" class="dropdown-item" onclick="verEstadisticas(); return false;"><i class="fas fa-chart-bar"></i><span>Mis Estad√≠sticas</span></a>
                    <a href="#" class="dropdown-item" onclick="verPartidos(); return false;"><i class="fas fa-calendar-alt"></i><span>Mis Partidos</span></a>
                    <a href="#" class="dropdown-item" onclick="verLogros(); return false;"><i class="fas fa-medal"></i><span>Mis Logros</span></a>
                    <a href="#" class="dropdown-item" onclick="verTarjetas(); return false;"><i class="fas fa-id-badge"></i><span>Mis Tarjetas</span></a>
                    <div class="menu-separator"></div>
                    <!-- SECCI√ìN EQUIPOS Y TORNEOS -->
                    <div class="menu-section-title">Equipos & Torneos</div>
                    <a href="#" class="dropdown-item" onclick="verEquipos(); return false;"><i class="fas fa-users"></i><span>Ver Equipos</span></a>
                    <a href="#" class="dropdown-item" onclick="crearEquipo(); return false;"><i class="fas fa-plus-square"></i><span>Crear Equipo</span></a>
                    <a href="#" class="dropdown-item" onclick="verTorneos(); return false;"><i class="fas fa-trophy"></i><span>Ver Torneos</span></a>
                    <a href="#" class="dropdown-item" onclick="crearTorneo(); return false;"><i class="fas fa-plus-circle"></i><span>Crear Torneo</span></a>
                    <a href="#" class="dropdown-item" onclick="crearAmistoso(); return false;"><i class="fas fa-handshake"></i><span>Crear Amistoso</span></a>
                    <div class="menu-separator"></div>
                    <!-- SECCI√ìN JUEGOS Y CARDS -->
                    <div class="menu-section-title">Juegos & Cards</div>
                    <a href="#" class="dropdown-item" onclick="jugarPenaltis(); return false;"><i class="fas fa-futbol"></i><span>Juego de Penaltis</span></a>
                    <a href="#" class="dropdown-item" onclick="centroJuegos(); return false;"><i class="fas fa-gamepad"></i><span>Centro de Juegos</span></a>
                    <a href="#" class="dropdown-item" onclick="verCardFIFA(); return false;"><i class="fas fa-id-card"></i><span>Card FIFA</span></a>
                    <a href="#" class="dropdown-item" onclick="sugerenciasCard(); return false;"><i class="fas fa-lightbulb"></i><span>Sugerencias Card</span></a>
                    <div class="menu-separator"></div>
                    <!-- SECCI√ìN SOCIAL -->
                    <div class="menu-section-title">Social</div>
                    <a href="#" class="dropdown-item" onclick="verNotificaciones(); return false;"><i class="fas fa-bell"></i><span>Notificaciones</span></a>
                    <a href="#" class="dropdown-item" onclick="abrirChat(); return false;"><i class="fas fa-comments"></i><span>Chat</span></a>
                    <a href="#" class="dropdown-item" onclick="verVideos(); return false;"><i class="fas fa-video"></i><span>Videos</span></a>
                    <a href="#" class="dropdown-item" onclick="abrirMarketplace(); return false;"><i class="fas fa-store"></i><span>Marketplace</span></a>
                    <a href="#" class="dropdown-item" onclick="verEstados(); return false;"><i class="fas fa-clipboard-list"></i><span>Estados</span></a>
                    <a href="#" class="dropdown-item" onclick="verAmigos(); return false;"><i class="fas fa-user-friends"></i><span>Amigos</span></a>
                    <a href="#" class="dropdown-item" onclick="abrirTransmisionEnVivo(); return false;"><i class="fas fa-broadcast-tower"></i><span style="color:#FF1744">Transmitir en Vivo</span></a>
                    <div class="menu-separator"></div>
                    <!-- SECCI√ìN RANKINGS -->
                    <div class="menu-section-title">Rankings</div>
                    <a href="#" class="dropdown-item" onclick="rankingJugadores(); return false;"><i class="fas fa-list-ol"></i><span>Ranking Jugadores</span></a>
                    <a href="#" class="dropdown-item" onclick="rankingPartidos(); return false;"><i class="fas fa-chart-line"></i><span>Ranking Partidos</span></a>
                    <a href="#" class="dropdown-item" onclick="buscarRanking(); return false;"><i class="fas fa-search"></i><span>Buscar Ranking</span></a>
                    <div class="menu-separator"></div>
                    <!-- SECCI√ìN ADMIN -->
                    <div class="menu-section-title">Administraci√≥n</div>
                    <a href="#" class="dropdown-item" onclick="abrirConfiguracion(); return false;"><i class="fas fa-cog"></i><span>Configuraci√≥n</span></a>
                    <a href="#" class="dropdown-item" onclick="sugerenciasCard(); return false;"><i class="fas fa-lightbulb"></i><span>Sugerencias Card</span></a>
                    <a href="#" class="dropdown-item" onclick="contactarSoporte(); return false;"><i class="fas fa-life-ring"></i><span>Soporte</span></a>
                    <a href="#" class="dropdown-item" onclick="verPrivacidad(); return false;"><i class="fas fa-shield-alt"></i><span>Privacidad</span></a>
                    <a href="#" class="dropdown-item" onclick="cerrarSesion(); return false;"><i class="fas fa-sign-out-alt"></i><span>Cerrar Sesi√≥n</span></a>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ===== SISTEMA DE AUTO-GUARDADO GLOBAL =====
    class FutProAutoSave {
        constructor() {
            this.userId = this.getCurrentUserId();
            this.initializeUser();
        }

        getCurrentUserId() {
            let user = JSON.parse(localStorage.getItem('futpro_user') || '{}');
            if (!user.id) {
                user.id = 'user_' + Date.now();
                localStorage.setItem('futpro_user', JSON.stringify(user));
            }
            return user.id;
        }

        initializeUser() {
            const defaultData = {
                user: { id: this.userId, nombre: '', email: '', avatar: '', telefono: '', fechaRegistro: new Date().toISOString() },
                stats: { partidos: 0, goles: 0, asistencias: 0, tarjetas: 0, posicion: '', equipo: '' },
                
                // INTERACCIONES SOCIALES
                partidos: [], equipos: [], torneos: [], amigos: [], logros: [], tarjetas: [],
                likes_dados: [], likes_recibidos: [], comentarios_hechos: [], comentarios_recibidos: [],
                mensajes_enviados: [], mensajes_recibidos: [], notificaciones: [],
                
                // HISTORIAL
                historial_completo: [], publicaciones: [], fotos: [], videos: [], transmisiones: [],
                
                // META
                version: '2.0', 
                ultima_actividad: new Date().toISOString(),
                configuracion: { notificaciones: true, privacidad: 'publico', idioma: 'es' }
            };

            Object.keys(defaultData).forEach(key => {
                if (!localStorage.getItem(`futpro_${key}`)) {
                    localStorage.setItem(`futpro_${key}`, JSON.stringify(defaultData[key]));
                }
            });
        }

        // ===== M√âTODOS DE AUTO-GUARDADO =====
        save(categoria, data, accion = 'agregar') {
            try {
                const timestamp = new Date().toISOString();
                const dataConTimestamp = { ...data, timestamp, userId: this.userId, accion };
                
                let existingData = JSON.parse(localStorage.getItem(`futpro_${categoria}`) || '[]');
                existingData.push(dataConTimestamp);
                
                localStorage.setItem(`futpro_${categoria}`, JSON.stringify(existingData));
                console.log(`Auto-guardado: ${categoria}`, dataConTimestamp);
                
                return true;
            } catch (error) {
                console.error('Error en auto-guardado:', error);
                return false;
            }
        }
    }

    // Instancia global del auto-guardado
    const futproAutoSave = new FutProAutoSave();

    // ===== FUNCIONES DE MODAL =====
    function cerrarModalPublicar() {
        const modal = document.getElementById('modalPublicar');
        if (modal) modal.remove();
    }

    function enviarPublicacion(e) {
        e.preventDefault();
        const archivo = document.getElementById('archivoPublicacion').files[0];
        const pie = document.getElementById('piePublicacion').value;
        const numerales = document.getElementById('numeralesPublicacion').value;
        const ubicacion = document.getElementById('ubicacionPublicacion').value;
        
        if (!archivo) return alert('Selecciona una foto o video');
        
        // Auto-guardar la publicaci√≥n
        futproAutoSave.save('publicaciones', {
            tipo: archivo.type.startsWith('video') ? 'video' : 'imagen',
            archivo: archivo.name,
            pie,
            numerales,
            ubicacion,
            fecha: new Date().toISOString()
        });
        
        cerrarModalPublicar();
        mostrarConfirmacion('¬°Publicaci√≥n guardada correctamente!');
    }

    // ===== FUNCIONES DE CONFIRMACI√ìN =====
    function mostrarConfirmacion(mensaje) {
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); display: flex;
            align-items: center; justify-content: center; z-index: 10000;
        `;
        modal.innerHTML = `
            <div style="background: #FFD700; color: #000; padding: 20px; border-radius: 10px; text-align: center;">
                <h3>${mensaje}</h3>
                <button onclick="this.closest('div').parentElement.remove()" style="background: #000; color: #FFD700; border: none; padding: 8px 16px; border-radius: 5px; margin-top: 10px;">Cerrar</button>
            </div>
        `;
        document.body.appendChild(modal);
        setTimeout(() => modal.remove(), 3000);
    }

    // ===== INICIALIZACI√ìN DE PERFIL =====
    function inicializarPerfil() {
        // Opci√≥n para perfil propio
        if (window.location.pathname.includes('perfil-instagram')) {
            window.addEventListener('DOMContentLoaded', function() {
                const btn = document.createElement('button');
                btn.textContent = 'Publicar foto/video';
                btn.onclick = abrirModalPublicar;
                btn.style = 'background:#FFD700;color:#181818;font-weight:bold;padding:7px 16px;border:none;border-radius:16px;font-size:1rem;box-shadow:0 2px 8px #0004;cursor:pointer;margin-bottom:12px;float:right;';
                const cont = document.querySelector('.main-content') || document.body;
                cont.insertBefore(btn, cont.firstChild);
            });
        }
    }

    // ===== FUNCIONES DE TRANSMISI√ìN EN VIVO =====
    function abrirTransmisionEnVivo() {
        if (document.getElementById('modalLive')) return;
        cerrarMenu();
        const modal = document.createElement('div');
        modal.id = 'modalLive';
        modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.92);z-index:30000;display:flex;align-items:center;justify-content:center;';
        modal.innerHTML = `
            <div style=\"background:#181818;padding:32px 24px 24px 24px;border-radius:22px;max-width:340px;width:96vw;box-shadow:0 8px 40px #000a;position:relative;\">
                <button onclick=\"cerrarModalLive()\" style=\"position:absolute;top:10px;right:10px;background:none;border:none;color:#FFD700;font-size:1.5rem;cursor:pointer;\"><i class='fas fa-times'></i></button>
                <h3 style=\"color:#FF1744;font-size:1.2rem;margin-bottom:18px;\">Transmitir en Vivo</h3>
                <form id=\"formLive\" onsubmit=\"iniciarTransmision(event)\" style=\"display:flex;flex-direction:column;gap:10px;\">
                    <input type=\"text\" id=\"tituloLive\" maxlength=\"60\" placeholder=\"T√≠tulo de la transmisi√≥n\" required style=\"background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;font-size:0.95rem;\" />
                    <input type=\"text\" id=\"descLive\" maxlength=\"120\" placeholder=\"Descripci√≥n (opcional)\" style=\"background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;font-size:0.95rem;\" />
                    <button type=\"submit\" style=\"background:#FF1744;color:#fff;font-weight:bold;padding:8px 0;border:none;border-radius:12px;font-size:1.1rem;margin-top:8px;\">Iniciar transmisi√≥n</button>
                </form>
                <div id=\"livePreview\" style=\"margin-top:18px;display:none;\"></div>
            </div>
        `;
        document.body.appendChild(modal);
    }
    
    function cerrarModalLive() {
        const modal = document.getElementById('modalLive');
        if (modal) modal.remove();
    }
    
    function iniciarTransmision(e) {
        e.preventDefault();
        const titulo = document.getElementById('tituloLive').value;
        const desc = document.getElementById('descLive').value;
        const preview = document.getElementById('livePreview');
        preview.style.display = 'block';
        preview.innerHTML = `<div style='color:#FFD700;text-align:center;font-size:1.1rem;margin-bottom:10px;'>üî¥ Transmitiendo en vivo...</div><div style='color:#fff;font-size:1.05rem;margin-bottom:6px;'><b>${titulo}</b></div><div style='color:#ccc;font-size:0.95rem;'>${desc}</div><div style='margin-top:18px;'><button onclick='cerrarModalLive()' style='background:#FFD700;color:#181818;font-weight:bold;padding:7px 16px;border:none;border-radius:16px;font-size:1rem;box-shadow:0 2px 8px #0004;cursor:pointer;'>Finalizar transmisi√≥n</button></div>`;
        document.getElementById('formLive').style.display = 'none';
    }

    // Renderizar publicaciones en el feed
    function renderPublicaciones() {
        const publicaciones = (JSON.parse(localStorage.getItem('futpro_publicaciones_globales')||'[]')).sort((a,b)=>new Date(b.fecha)-new Date(a.fecha));
        const feed = document.getElementById('feedPublicaciones');
        if (!feed) return;
        feed.innerHTML = '';
        publicaciones.forEach((pub, idx) => {
            let mediaHtml = '';
            if(pub.tipo==='imagen') {
                mediaHtml = `<img src='${pub.archivo}' alt='Publicaci√≥n' style='width:100%;max-height:420px;object-fit:cover;border-radius:18px 18px 0 0;'>`;
            } else if(pub.tipo==='video') {
                mediaHtml = `<video src='${pub.archivo}' controls style='width:100%;max-height:420px;object-fit:cover;border-radius:18px 18px 0 0;background:#000;'></video>`;
            }
            // Likes y comentarios locales
            const pubId = pub.id;
            let likes = pub.likes || [];
            let comentarios = pub.comentarios || [];
            const user = JSON.parse(localStorage.getItem('futpro_user')||'{}');
            const yaLike = likes.includes(user.id);
            feed.innerHTML += `
                <div class='post' style='width:100%;max-width:600px;background:rgba(24,24,24,0.99);border:3px solid #FFD700;border-radius:22px;margin-bottom:32px;box-shadow:0 4px 24px #000a;animation:aparecer 0.6s ease-out;'>
                    <div style='padding:16px 18px 12px 18px;display:flex;align-items:center;gap:12px;'>
                        <img src='${pub.autorAvatar}' alt='${pub.autorNombre}' style='width:40px;height:40px;border-radius:50%;border:2px solid #FFD700;'>
                        <div style='flex:1;'>
                            <div style='color:#FFD700;font-weight:bold;font-size:1rem;'>${pub.autorNombre}</div>
                            <div style='color:#888;font-size:0.8rem;'>${pub.ubicacion ? pub.ubicacion + ' ‚Ä¢ ' : ''}${new Date(pub.fecha).toLocaleDateString()}</div>
                        </div>
                        <div style='position:relative;'>
                            <button onclick="mostrarMenuPublicacion('${pubId}')" style='background:none;border:none;color:#FFD700;font-size:1.2rem;cursor:pointer;padding:4px;'><i class='fas fa-ellipsis-h'></i></button>
                            <div id='menu_${pubId}' style='display:none;position:absolute;top:100%;right:0;background:#181818;border:2px solid #FFD700;border-radius:12px;min-width:140px;z-index:1000;box-shadow:0 4px 16px #000a;'>
                                <button onclick="editarPublicacion('${pubId}')" style='width:100%;background:none;border:none;color:#FFD700;padding:10px 16px;text-align:left;cursor:pointer;font-size:0.9rem;border-bottom:1px solid #333;'><i class='fas fa-edit'></i> Editar</button>
                                <button onclick="borrarPublicacion('${pubId}')" style='width:100%;background:none;border:none;color:#FF4444;padding:10px 16px;text-align:left;cursor:pointer;font-size:0.9rem;border-bottom:1px solid #333;'><i class='fas fa-trash'></i> Borrar</button>
                                <button onclick="compartirURLPublicacion('${pubId}')" style='width:100%;background:none;border:none;color:#FFD700;padding:10px 16px;text-align:left;cursor:pointer;font-size:0.9rem;'><i class='fas fa-share'></i> Compartir URL</button>
                            </div>
                        </div>
                    </div>
                    ${mediaHtml}
                    <div style='padding:18px 22px 10px 22px;'>
                        <div style='font-size:1.1rem;color:#FFD700;font-weight:bold;margin-bottom:4px;'>${pub.pie||''}</div>
                        <div style='font-size:0.98rem;color:#00ff88;margin-bottom:2px;'>${pub.numerales||''}</div>
                        <div style='display:flex;align-items:center;gap:18px;margin-top:10px;'>
                            <button onclick="toggleLikePubGlobal('${pubId}')" style="background:none;border:none;cursor:pointer;font-size:1.3rem;color:${yaLike?'#FF1744':'#FFD700'};display:flex;align-items:center;gap:6px;"><i class='fas fa-futbol'></i> <span id='likeCount_${pubId}'>${likes.length}</span></button>
                            <button onclick="abrirComentariosPubGlobal('${pubId}')" style="background:none;border:none;cursor:pointer;font-size:1.2rem;color:#FFD700;display:flex;align-items:center;gap:6px;"><i class='far fa-comment'></i> <span id='comentCount_${pubId}'>${comentarios.length}</span></button>
                        </div>
                    </div>
                </div>
            `;
        });
    }    // Like publicaci√≥n
    function toggleLikePub(pubId) {
        const user = JSON.parse(localStorage.getItem('futpro_user')||'{}');
        let likes = JSON.parse(localStorage.getItem('futpro_pub_likes_'+pubId)||'[]');
        const idx = likes.indexOf(user.id);
        if(idx>-1) {
            likes.splice(idx,1);
        } else {
            likes.push(user.id);
            // AUTO-GUARDAR: Like dado en publicaci√≥n
            autoSave.save('likes_dados', {
                tipoContenido: 'publicacion',
                contenidoId: pubId,
                propietario: 'Mi publicaci√≥n',
                ubicacion: 'feed_home'
            }, 'crear');
            
            // NOTIFICACI√ìN: Like recibido
            autoSave.createNotification(
                'like_publicacion',
                `${user.nombre || 'Alguien'} le dio ‚öΩ like a tu publicaci√≥n`,
                user.id, // Para el due√±o de la publicaci√≥n (en este caso el mismo usuario por ahora)
                {
                    publicacionId: pubId,
                    fromUser: user.nombre,
                    fromAvatar: user.avatar
                }
            );
        }
        localStorage.setItem('futpro_pub_likes_'+pubId, JSON.stringify(likes));
        document.getElementById('likeCount_'+pubId).textContent = likes.length;
        renderPublicaciones();
    }                // Comentarios publicaci√≥n
                function abrirComentariosPub(pubId) {
                    let comentarios = JSON.parse(localStorage.getItem('futpro_pub_coment_'+pubId)||'[]');
                    const user = JSON.parse(localStorage.getItem('futpro_user')||'{}');
                    if(document.getElementById('modalComentPub')) return;
                    const modal = document.createElement('div');
                    modal.id = 'modalComentPub';
                    modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);z-index:40000;display:flex;align-items:center;justify-content:center;';
                    modal.innerHTML = `
                        <div style='background:#181818;padding:28px 18px 18px 18px;border-radius:18px;max-width:340px;width:96vw;box-shadow:0 8px 40px #000a;position:relative;'>
                            <button onclick="cerrarModalComentPub()" style="position:absolute;top:10px;right:10px;background:none;border:none;color:#FFD700;font-size:1.3rem;cursor:pointer;"><i class='fas fa-times'></i></button>
                            <h3 style='color:#FFD700;font-size:1.1rem;margin-bottom:12px;'>Comentarios</h3>
                            <div id='comentariosListPub' style='max-height:180px;overflow-y:auto;margin-bottom:12px;'>
                                ${generarListaComentariosPub(comentarios)}
                            </div>
                            <div style='display:flex;gap:8px;'>
                                <input id='inputComentPub' type='text' maxlength='120' placeholder='Escribe un comentario...' style='flex:1;background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;font-size:0.97rem;'>
                                <button onclick="enviarComentarioPub('${pubId}')" style='background:#FFD700;color:#181818;font-weight:bold;padding:7px 12px;border:none;border-radius:8px;font-size:1rem;cursor:pointer;'>Enviar</button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(modal);
                }
                function cerrarModalComentPub() {
                    const modal = document.getElementById('modalComentPub');
                    if(modal) modal.remove();
                }
                function enviarComentarioPub(pubId) {
                    const input = document.getElementById('inputComentPub');
                    let comentarios = JSON.parse(localStorage.getItem('futpro_pub_coment_'+pubId)||'[]');
                    const user = JSON.parse(localStorage.getItem('futpro_user')||'{}');
                    const texto = input.value.trim();
                    if(!texto) return;
                    
                    const nuevoComentario = {user:user.nombre||'An√≥nimo', texto, fecha:new Date().toISOString()};
                    comentarios.push(nuevoComentario);
                    localStorage.setItem('futpro_pub_coment_'+pubId, JSON.stringify(comentarios));
                    
                    // AUTO-GUARDAR: Comentario hecho en publicaci√≥n
                    autoSave.save('comentarios_hechos', {
                        targetUser: 'Mi publicaci√≥n',
                        targetUserId: user.id,
                        publicacionId: pubId,
                        comentario: texto,
                        tipoContenido: 'publicacion'
                    }, 'crear');
                    
                    // NOTIFICACI√ìN: Comentario recibido
                    autoSave.createNotification(
                        'comentario_publicacion',
                        `${user.nombre || 'Alguien'} coment√≥ tu publicaci√≥n: "${texto.substring(0, 50)}${texto.length > 50 ? '...' : ''}"`,
                        user.id, // Para el due√±o de la publicaci√≥n
                        {
                            publicacionId: pubId,
                            fromUser: user.nombre,
                            fromAvatar: user.avatar,
                            comentario: texto
                        }
                    );
                    
                    document.getElementById('comentariosListPub').innerHTML = generarListaComentariosPub(comentarios);
                    input.value = '';
                    cerrarModalComentPub();
                }

    // ===== FUNCIONES DE DATOS =====
    function getData(categoria, filtros = {}) {
        try {
            const data = JSON.parse(localStorage.getItem(`futpro_${categoria}`) || '[]');
            return data.filter(item => {
                return Object.keys(filtros).every(key => 
                    filtros[key] === undefined || item[key] === filtros[key]
                );
            });
        } catch (error) {
            console.error('Error al obtener datos:', error);
            return [];
        }
    }

    function createNotification(tipo, mensaje, targetUserId = null, data = {}) {
        const notification = {
            id: 'notif_' + Date.now(),
            tipo,
            mensaje,
            targetUserId,
            timestamp: new Date().toISOString(),
            leida: false,
            data
        };
        
        // Guardar en localStorage
        const notificaciones = JSON.parse(localStorage.getItem('futpro_notificaciones') || '[]');
        notificaciones.unshift(notification);
        localStorage.setItem('futpro_notificaciones', JSON.stringify(notificaciones));
        return notification;
    }

    // ===== FUNCIONES DE LIKES =====
    function toggleLike(pubId) {
        const user = JSON.parse(localStorage.getItem('futpro_user')||'{}');
        const publicaciones = JSON.parse(localStorage.getItem('futpro_publicaciones_globales')||'[]');
        const pubIndex = publicaciones.findIndex(p => p.id === pubId);
        
        if (pubIndex > -1) {
            let likes = publicaciones[pubIndex].likes || [];
            const idx = likes.indexOf(user.id);
            if(idx > -1) {
                likes.splice(idx, 1);
            } else {
                likes.push(user.id);
            }
            publicaciones[pubIndex].likes = likes;
            localStorage.setItem('futpro_publicaciones_globales', JSON.stringify(publicaciones));
            renderPublicaciones();
        }
    }

    function notificarSeguidores(publicacion) {
        // Simular notificaci√≥n a seguidores
        const seguidores = ['demo_user_1', 'demo_user_2', 'demo_user_3'];
        seguidores.forEach(seguidorId => {
            createNotification(
                'nueva_publicacion_seguido',
                `${publicacion.autorNombre} public√≥: "${publicacion.pie || 'Nueva publicaci√≥n'}"`,
                seguidorId,
                {
                    publicacionId: publicacion.id,
                    autorId: publicacion.autorId,
                    autorNombre: publicacion.autorNombre
                }
            );
        });
    }

    function mostrarConfirmacionPublicacion() {
                    const confirmacion = document.createElement('div');
                    confirmacion.style = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#FFD700;color:#181818;padding:16px 24px;border-radius:12px;font-weight:bold;z-index:50000;animation:aparecerConfirm 0.5s ease-out;';
                    confirmacion.innerHTML = '‚úÖ ¬°Publicaci√≥n compartida!';
                    document.body.appendChild(confirmacion);
                    setTimeout(() => confirmacion.remove(), 3000);
                }

                // Funciones del men√∫ de publicaciones
                function mostrarMenuPublicacion(pubId) {
                    // Cerrar otros men√∫s abiertos
                    document.querySelectorAll('[id^="menu_"]').forEach(menu => {
                        if(menu.id !== 'menu_' + pubId) menu.style.display = 'none';
                    });
                    
                    const menu = document.getElementById('menu_' + pubId);
                    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
                }

                function editarPublicacion(pubId) {
                    const publicaciones = JSON.parse(localStorage.getItem('futpro_publicaciones_globales')||'[]');
                    const pub = publicaciones.find(p => p.id === pubId);
                    if(!pub) return;
                    
                    // Cerrar men√∫
                    document.getElementById('menu_' + pubId).style.display = 'none';
                    
                    // Abrir modal de edici√≥n
                    if (document.getElementById('modalPublicar')) return;
                    const modal = document.createElement('div');
                    modal.id = 'modalPublicar';
                    modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);z-index:20000;display:flex;align-items:center;justify-content:center;';
                    modal.innerHTML = `
                        <div style="background:#181818;padding:32px 24px 24px 24px;border-radius:22px;max-width:340px;width:96vw;box-shadow:0 8px 40px #000a;position:relative;">
                            <button onclick="cerrarModalPublicar()" style="position:absolute;top:10px;right:10px;background:none;border:none;color:#FFD700;font-size:1.5rem;cursor:pointer;"><i class='fas fa-times'></i></button>
                            <h3 style="color:#FFD700;font-size:1.2rem;margin-bottom:18px;">Editar publicaci√≥n</h3>
                            <form id="formPublicar" onsubmit="actualizarPublicacion(event, '${pubId}')" style="display:flex;flex-direction:column;gap:10px;">
                                <input type="file" id="archivoPublicacion" accept="image/*,video/*" style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;" />
                                <input type="text" id="piePublicacion" value="${pub.pie||''}" maxlength="80" placeholder="Pie de foto (opcional)" style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;font-size:0.95rem;" />
                                <input type="text" id="numeralesPublicacion" value="${pub.numerales||''}" maxlength="40" placeholder="#numerales (opcional)" style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;font-size:0.95rem;" />
                                <input type="text" id="ubicacionPublicacion" value="${pub.ubicacion||''}" maxlength="40" placeholder="Ubicaci√≥n (opcional)" style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;font-size:0.95rem;" />
                                <button type="submit" style="background:#FFD700;color:#181818;font-weight:bold;padding:8px 0;border:none;border-radius:12px;font-size:1.1rem;margin-top:8px;">Actualizar</button>
                            </form>
                        </div>
                    `;
                    document.body.appendChild(modal);
                }

                function actualizarPublicacion(e, pubId) {
                    e.preventDefault();
                    const archivo = document.getElementById('archivoPublicacion').files[0];
                    const pie = document.getElementById('piePublicacion').value;
                    const numerales = document.getElementById('numeralesPublicacion').value;
                    const ubicacion = document.getElementById('ubicacionPublicacion').value;
                    
                    let publicaciones = JSON.parse(localStorage.getItem('futpro_publicaciones_globales')||'[]');
                    const pubIndex = publicaciones.findIndex(p => p.id === pubId);
                    
                    if(pubIndex > -1) {
                        // Actualizar datos de texto
                        publicaciones[pubIndex].pie = pie;
                        publicaciones[pubIndex].numerales = numerales;
                        publicaciones[pubIndex].ubicacion = ubicacion;
                        
                        // Si hay nuevo archivo, actualizar
                        if(archivo) {
                            const reader = new FileReader();
                            reader.onload = function(ev) {
                                publicaciones[pubIndex].archivo = ev.target.result;
                                publicaciones[pubIndex].tipo = archivo.type.startsWith('video') ? 'video' : 'imagen';
                                localStorage.setItem('futpro_publicaciones_globales', JSON.stringify(publicaciones));
                                cerrarModalPublicar();
                                renderPublicaciones();
                                mostrarConfirmacionPublicacion();
                            };
                            reader.readAsDataURL(archivo);
                        } else {
                            localStorage.setItem('futpro_publicaciones_globales', JSON.stringify(publicaciones));
                            cerrarModalPublicar();
                            renderPublicaciones();
                            mostrarConfirmacionPublicacion();
                        }
                        
                        // AUTO-GUARDAR: Publicaci√≥n editada
                        autoSave.save('publicaciones', {
                            accion: 'editar',
                            publicacionId: pubId,
                            cambios: {pie, numerales, ubicacion}
                        }, 'editar');
                    }
                }

                function borrarPublicacion(pubId) {
                    if(!confirm('¬øEst√°s seguro de que quieres borrar esta publicaci√≥n?')) return;
                    
                    let publicaciones = JSON.parse(localStorage.getItem('futpro_publicaciones_globales')||'[]');
                    publicaciones = publicaciones.filter(p => p.id !== pubId);
                    localStorage.setItem('futpro_publicaciones_globales', JSON.stringify(publicaciones));
                    
                    // AUTO-GUARDAR: Publicaci√≥n borrada
                    autoSave.save('publicaciones', {
                        accion: 'borrar',
                        publicacionId: pubId
                    }, 'borrar');
                    
                    // Cerrar men√∫ y actualizar
                    document.getElementById('menu_' + pubId).style.display = 'none';
                    renderPublicaciones();
                    
                    // Mostrar confirmaci√≥n
                    const confirmacion = document.createElement('div');
                    confirmacion.style = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#FF4444;color:#fff;padding:16px 24px;border-radius:12px;font-weight:bold;z-index:50000;animation:aparecerConfirm 0.5s ease-out;';
                    confirmacion.innerHTML = 'üóëÔ∏è Publicaci√≥n eliminada';
                    document.body.appendChild(confirmacion);
                    setTimeout(() => confirmacion.remove(), 3000);
                }

                function compartirURLPublicacion(pubId) {
                    const url = `${window.location.origin}${window.location.pathname}?pub=${pubId}`;
                    
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(url).then(() => {
                            // Mostrar confirmaci√≥n
                            const confirmacion = document.createElement('div');
                            confirmacion.style = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#00ff88;color:#181818;padding:16px 24px;border-radius:12px;font-weight:bold;z-index:50000;animation:aparecerConfirm 0.5s ease-out;';
                            confirmacion.innerHTML = 'üìã URL copiada al portapapeles';
                            document.body.appendChild(confirmacion);
                            setTimeout(() => confirmacion.remove(), 3000);
                        });
                    } else {
                        // Fallback - mostrar URL en prompt
                        prompt('Copia esta URL para compartir:', url);
                    }
                    
                    // Cerrar men√∫
                    document.getElementById('menu_' + pubId).style.display = 'none';
                    
                    // AUTO-GUARDAR: URL compartida
                    autoSave.save('publicaciones', {
                        accion: 'compartir_url',
                        publicacionId: pubId,
                        url: url
                    }, 'compartir');
                }

                // Cerrar men√∫s al hacer click fuera
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('[id^="menu_"]') && !e.target.closest('button[onclick*="mostrarMenuPublicacion"]')) {
                        document.querySelectorAll('[id^="menu_"]').forEach(menu => {
                            menu.style.display = 'none';
                        });
                    }
                });

                // ====== SISTEMA DE NAVEGACI√ìN ======
                let currentSection = 'home';
                let videos = [];
                let currentVideoIndex = 0;

                function setActiveNav(activeItem) {
                    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                    activeItem.classList.add('active');
                }

                function irAHome() {
                    currentSection = 'home';
                    setActiveNav(document.querySelector('[onclick="irAHome()"]'));
                    document.getElementById('feedPublicaciones').style.display = 'block';
                    hideAllSections();
                    renderPublicaciones(); // Actualizar publicaciones
                    mostrarConfirmacion('üè† Home actualizado');
                }

                function irAMarket() {
                    currentSection = 'market';
                    setActiveNav(document.querySelector('[onclick="irAMarket()"]'));
                    hideAllSections();
                    mostrarMarketplace();
                }

                function irAVideos() {
                    currentSection = 'videos';
                    setActiveNav(document.querySelector('[onclick="irAVideos()"]'));
                    hideAllSections();
                    mostrarVideos();
                }

                function irAAlertas() {
                    currentSection = 'alertas';
                    setActiveNav(document.querySelector('[onclick="irAAlertas()"]'));
                    hideAllSections();
                    mostrarAlertas();
                }

                function irAChat() {
                    currentSection = 'chat';
                    setActiveNav(document.querySelector('[onclick="irAChat()"]'));
                    hideAllSections();
                    mostrarChat();
                }

                function hideAllSections() {
                    const sections = ['feedPublicaciones', 'marketSection', 'videosSection', 'alertasSection', 'chatSection'];
                    sections.forEach(id => {
                        const element = document.getElementById(id);
                        if(element) element.style.display = 'none';
                    });
                }

                function mostrarConfirmacion(mensaje) {
                    const confirmacion = document.createElement('div');
                    confirmacion.style = 'position:fixed;top:80px;left:50%;transform:translateX(-50%);background:#FFD700;color:#181818;padding:12px 20px;border-radius:8px;font-weight:bold;z-index:50000;animation:aparecerConfirm 0.5s ease-out;';
                    confirmacion.innerHTML = mensaje;
                    document.body.appendChild(confirmacion);
                    setTimeout(() => confirmacion.remove(), 2000);
                }

                // ====== MARKETPLACE ======
                function mostrarMarketplace() {
                    const section = document.getElementById('marketSection');
                    section.style.display = 'block';
                    section.innerHTML = `
                        <div style="padding:20px 0;">
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                                <h2 style="color:#FFD700;font-size:1.4rem;margin:0;">Marketplace</h2>
                                <button onclick="publicarProducto()" style="background:#FFD700;color:#181818;font-weight:bold;padding:8px 16px;border:none;border-radius:12px;font-size:0.9rem;">Vender</button>
                            </div>
                            <div style="margin-bottom:16px;">
                                <input type="text" id="buscarProductos" placeholder="Buscar productos..." style="width:100%;background:#222;color:#FFD700;padding:12px;border-radius:12px;border:2px solid #FFD700;" onkeyup="filtrarProductos()">
                            </div>
                            <div id="productosGrid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;"></div>
                        </div>
                    `;
                    cargarProductos();
                }

                function cargarProductos() {
                    const productos = JSON.parse(localStorage.getItem('futpro_marketplace_productos')||'[]');
                    const productosDemo = [
                        {id:'demo1',nombre:'Botines Nike',precio:150000,imagen:'https://i.imgur.com/placeholder-boots.jpg',vendedor:'Carlos P√©rez',vendedorId:'user_carlos',ubicacion:'Bogot√°',descripcion:'Botines en excelente estado'},
                        {id:'demo2',nombre:'Bal√≥n Profesional',precio:80000,imagen:'https://i.imgur.com/placeholder-ball.jpg',vendedor:'Ana Garc√≠a',vendedorId:'user_ana',ubicacion:'Medell√≠n',descripcion:'Bal√≥n FIFA para partidos'},
                        {id:'demo3',nombre:'Guantes Arquero',precio:45000,imagen:'https://i.imgur.com/placeholder-gloves.jpg',vendedor:'Luis Torres',vendedorId:'user_luis',ubicacion:'Cali',descripcion:'Guantes profesionales'}
                    ];
                    
                    if(productos.length === 0) {
                        localStorage.setItem('futpro_marketplace_productos', JSON.stringify(productosDemo));
                    }
                    
                    renderProductos([...productos, ...productosDemo]);
                }

                function renderProductos(productos) {
                    const grid = document.getElementById('productosGrid');
                    if(!grid) return;
                    
                    grid.innerHTML = productos.map(p => `
                        <div style="background:#181818;border:2px solid #FFD700;border-radius:12px;overflow:hidden;cursor:pointer;" onclick="verProducto('${p.id}')">
                            <img src="${p.imagen}" alt="${p.nombre}" style="width:100%;height:120px;object-fit:cover;">
                            <div style="padding:12px;">
                                <div style="color:#FFD700;font-weight:bold;font-size:0.9rem;margin-bottom:4px;">${p.nombre}</div>
                                <div style="color:#00ff88;font-weight:bold;font-size:1rem;margin-bottom:4px;">$${p.precio.toLocaleString()}</div>
                                <div style="color:#888;font-size:0.8rem;">${p.vendedor} ‚Ä¢ ${p.ubicacion}</div>
                            </div>
                        </div>
                    `).join('');
                }

                function verProducto(productId) {
                    const productos = [...JSON.parse(localStorage.getItem('futpro_marketplace_productos')||'[]')];
                    const productosDemo = [
                        {id:'demo1',nombre:'Botines Nike',precio:150000,imagen:'https://i.imgur.com/placeholder-boots.jpg',vendedor:'Carlos P√©rez',vendedorId:'user_carlos',ubicacion:'Bogot√°',descripcion:'Botines en excelente estado'},
                        {id:'demo2',nombre:'Bal√≥n Profesional',precio:80000,imagen:'https://i.imgur.com/placeholder-ball.jpg',vendedor:'Ana Garc√≠a',vendedorId:'user_ana',ubicacion:'Medell√≠n',descripcion:'Bal√≥n FIFA para partidos'},
                        {id:'demo3',nombre:'Guantes Arquero',precio:45000,imagen:'https://i.imgur.com/placeholder-gloves.jpg',vendedor:'Luis Torres',vendedorId:'user_luis',ubicacion:'Cali',descripcion:'Guantes profesionales'}
                    ];
                    const producto = [...productos, ...productosDemo].find(p => p.id === productId);
                    if(!producto) return;
                    
                    const modal = document.createElement('div');
                    modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.9);z-index:30000;display:flex;align-items:center;justify-content:center;';
                    modal.innerHTML = `
                        <div style="background:#181818;padding:24px;border-radius:16px;max-width:350px;width:90vw;border:2px solid #FFD700;">
                            <img src="${producto.imagen}" alt="${producto.nombre}" style="width:100%;height:200px;object-fit:cover;border-radius:12px;margin-bottom:16px;">
                            <h3 style="color:#FFD700;margin-bottom:8px;">${producto.nombre}</h3>
                            <div style="color:#00ff88;font-size:1.3rem;font-weight:bold;margin-bottom:8px;">$${producto.precio.toLocaleString()}</div>
                            <div style="color:#fff;margin-bottom:8px;">${producto.descripcion}</div>
                            <div style="color:#888;margin-bottom:16px;">Vendedor: ${producto.vendedor} ‚Ä¢ ${producto.ubicacion}</div>
                            <div style="display:flex;gap:8px;">
                                <button onclick="enviarMensajeVendedor('${producto.vendedorId}','${producto.nombre}','${producto.imagen}')" style="flex:1;background:#FFD700;color:#181818;font-weight:bold;padding:10px;border:none;border-radius:8px;">Estoy interesado</button>
                                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background:#666;color:#fff;padding:10px 16px;border:none;border-radius:8px;">Cerrar</button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(modal);
                }

                function publicarProducto() {
                    const modal = document.createElement('div');
                    modal.id = 'modalProducto';
                    modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);z-index:20000;display:flex;align-items:center;justify-content:center;';
                    modal.innerHTML = `
                        <div style="background:#181818;padding:24px;border-radius:16px;max-width:340px;width:96vw;border:2px solid #FFD700;">
                            <h3 style="color:#FFD700;margin-bottom:16px;">Publicar producto</h3>
                            <form onsubmit="guardarProducto(event)" style="display:flex;flex-direction:column;gap:12px;">
                                <input type="file" id="imagenProducto" accept="image/*" required style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;">
                                <input type="text" id="nombreProducto" placeholder="Nombre del producto" required style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;">
                                <input type="number" id="precioProducto" placeholder="Precio" required style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;">
                                <textarea id="descripcionProducto" placeholder="Descripci√≥n" style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;min-height:60px;"></textarea>
                                <input type="text" id="ubicacionProducto" placeholder="Ubicaci√≥n" style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;">
                                <div style="display:flex;gap:8px;">
                                    <button type="submit" style="flex:1;background:#FFD700;color:#181818;font-weight:bold;padding:8px;border:none;border-radius:8px;">Publicar</button>
                                    <button type="button" onclick="document.getElementById('modalProducto').remove()" style="background:#666;color:#fff;padding:8px 16px;border:none;border-radius:8px;">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    `;
                    document.body.appendChild(modal);
                }

                function guardarProducto(e) {
                    e.preventDefault();
                    const imagen = document.getElementById('imagenProducto').files[0];
                    const nombre = document.getElementById('nombreProducto').value;
                    const precio = parseInt(document.getElementById('precioProducto').value);
                    const descripcion = document.getElementById('descripcionProducto').value;
                    const ubicacion = document.getElementById('ubicacionProducto').value;
                    const user = JSON.parse(localStorage.getItem('futpro_user')||'{}');
                    
                    if(!imagen) return;
                    
                    const reader = new FileReader();
                    reader.onload = function(ev) {
                        const nuevoProducto = {
                            id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                            nombre,
                            precio,
                            descripcion,
                            ubicacion,
                            imagen: ev.target.result,
                            vendedor: user.nombre || 'Usuario Demo',
                            vendedorId: user.id || 'demo_user',
                            fecha: new Date().toISOString()
                        };
                        
                        let productos = JSON.parse(localStorage.getItem('futpro_marketplace_productos')||'[]');
                        productos.unshift(nuevoProducto);
                        localStorage.setItem('futpro_marketplace_productos', JSON.stringify(productos));
                        
                        autoSave.save('marketplace', nuevoProducto, 'crear');
                        document.getElementById('modalProducto').remove();
                        cargarProductos();
                        mostrarConfirmacion('‚úÖ Producto publicado');
                    };
                    reader.readAsDataURL(imagen);
                }

                function enviarMensajeVendedor(vendedorId, producto, imagen) {
                    const mensaje = `Hola, estoy interesado en tu ${producto}`;
                    
                    // Guardar mensaje
                    let chats = JSON.parse(localStorage.getItem('futpro_chats')||'{}');
                    const chatId = vendedorId;
                    if(!chats[chatId]) chats[chatId] = {mensajes:[], usuario: 'Vendedor', activo: true};
                    
                    chats[chatId].mensajes.push({
                        id: Date.now(),
                        mensaje,
                        imagen,
                        timestamp: new Date().toISOString(),
                        enviado: true
                    });
                    
                    localStorage.setItem('futpro_chats', JSON.stringify(chats));
                    autoSave.save('mensajes_enviados', {destinatario: vendedorId, contenido: mensaje, tipo: 'marketplace'}, 'crear');
                    
                    // Cerrar modal y mostrar confirmaci√≥n
                    document.querySelector('[onclick*="parentElement.parentElement.parentElement.remove"]').click();
                    mostrarConfirmacion('üí¨ Mensaje enviado al vendedor');
                }

                // ====== VIDEOS TIPO TIKTOK ======
                function mostrarVideos() {
                    const section = document.getElementById('videosSection');
                    section.style.display = 'block';
                    section.innerHTML = `
                        <div style="position:relative;width:100%;height:100vh;background:#000;">
                            <button onclick="cerrarVideos()" style="position:absolute;top:20px;left:20px;background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:20px;padding:8px 12px;border-radius:50%;cursor:pointer;z-index:10001;">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <div id="videoContainer" style="width:100%;height:100%;position:relative;display:flex;align-items:center;justify-content:center;">
                                <video id="currentVideo" style="width:100%;height:100%;object-fit:cover;" autoplay muted loop playsinline></video>
                                <div style="position:absolute;right:16px;bottom:120px;display:flex;flex-direction:column;gap:20px;align-items:center;">
                                    <button onclick="toggleLikeVideo()" id="likeVideoBtn" style="background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:24px;padding:12px;border-radius:50%;cursor:pointer;">
                                        <i class="fas fa-futbol"></i>
                                        <div style="font-size:12px;margin-top:4px;" id="videoLikesCount">0</div>
                                    </button>
                                    <button onclick="abrirComentariosVideo()" style="background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:24px;padding:12px;border-radius:50%;cursor:pointer;">
                                        <i class="fas fa-comment"></i>
                                        <div style="font-size:12px;margin-top:4px;" id="videoCommentsCount">0</div>
                                    </button>
                                    <button onclick="compartirVideo()" style="background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:24px;padding:12px;border-radius:50%;cursor:pointer;">
                                        <i class="fas fa-share"></i>
                                    </button>
                                </div>
                                <div style="position:absolute;bottom:20px;left:20px;right:80px;color:#fff;">
                                    <div style="font-weight:bold;margin-bottom:8px;" id="videoAutor">@usuario</div>
                                    <div style="margin-bottom:8px;" id="videoDescripcion">Descripci√≥n del video</div>
                                    <div style="font-size:12px;color:#ccc;" id="videoFecha">hace 2 horas</div>
                                </div>
                            </div>
                        </div>
                    `;
                    cargarVideos();
                }

                function cargarVideos() {
                    videos = [
                        {id:'v1',src:'https://sample-videos.com/zip/10/mp4/mp4-360-426-sample.mp4',autor:'@carlos_futbol',descripcion:'Incre√≠ble jugada en el partido de ayer üî•‚öΩ',likes:234,comentarios:45,fecha:'2025-10-09'},
                        {id:'v2',src:'https://sample-videos.com/zip/10/mp4/mp4-640-360-sample.mp4',autor:'@ana_sports',descripcion:'Entrenamiento matutino üí™ #futbol #training',likes:156,comentarios:23,fecha:'2025-10-08'},
                        {id:'v3',src:'https://sample-videos.com/zip/10/mp4/mp4-480-360-sample.mp4',autor:'@luis_gk',descripcion:'Atajadas espectaculares en el arco ‚öΩü•Ö',likes:89,comentarios:12,fecha:'2025-10-07'}
                    ];
                    
                    // Agregar videos de localStorage
                    const videosGuardados = JSON.parse(localStorage.getItem('futpro_videos')||'[]');
                    videos = [...videosGuardados, ...videos];
                    
                    currentVideoIndex = 0;
                    reproducirVideo();
                }

                function reproducirVideo() {
                    if(videos.length === 0) return;
                    const video = videos[currentVideoIndex];
                    const videoElement = document.getElementById('currentVideo');
                    const autorElement = document.getElementById('videoAutor');
                    const descripcionElement = document.getElementById('videoDescripcion');
                    const fechaElement = document.getElementById('videoFecha');
                    const likesElement = document.getElementById('videoLikesCount');
                    const commentsElement = document.getElementById('videoCommentsCount');
                    
                    if(videoElement) {
                        videoElement.src = video.src;
                        autorElement.textContent = video.autor;
                        descripcionElement.textContent = video.descripcion;
                        fechaElement.textContent = video.fecha;
                        likesElement.textContent = video.likes;
                        commentsElement.textContent = video.comentarios;
                    }
                }

                function toggleLikeVideo() {
                    if(videos.length === 0) return;
                    const btn = document.getElementById('likeVideoBtn');
                    const count = document.getElementById('videoLikesCount');
                    const video = videos[currentVideoIndex];
                    
                    video.likes += btn.classList.contains('liked') ? -1 : 1;
                    btn.classList.toggle('liked');
                    count.textContent = video.likes;
                    
                    // Auto-guardar like
                    autoSave.save('likes_dados', {
                        tipoContenido: 'video',
                        contenidoId: video.id,
                        propietario: video.autor
                    }, 'crear');
                }

                function cerrarVideos() {
                    document.getElementById('videosSection').style.display = 'none';
                    irAHome();
                }

                // Navegaci√≥n entre videos con swipe
                let touchStartY = 0;
                document.addEventListener('touchstart', (e) => {
                    if(currentSection === 'videos') {
                        touchStartY = e.touches[0].clientY;
                    }
                });

                document.addEventListener('touchend', (e) => {
                    if(currentSection === 'videos') {
                        const touchEndY = e.changedTouches[0].clientY;
                        const diff = touchStartY - touchEndY;
                        
                        if(Math.abs(diff) > 50) {
                            if(diff > 0) siguienteVideo();
                            else videoAnterior();
                        }
                    }
                });

                function siguienteVideo() {
                    if(currentVideoIndex < videos.length - 1) {
                        currentVideoIndex++;
                        reproducirVideo();
                    }
                }

                function videoAnterior() {
                    if(currentVideoIndex > 0) {
                        currentVideoIndex--;
                        reproducirVideo();
                    }
                }

                // ====== ALERTAS Y NOTIFICACIONES ======
                function mostrarAlertas() {
                    const section = document.getElementById('alertasSection');
                    section.style.display = 'block';
                    section.innerHTML = `
                        <div style="padding:20px 0;">
                            <h2 style="color:#FFD700;font-size:1.4rem;margin-bottom:20px;">Alertas y Notificaciones</h2>
                            <div style="display:flex;gap:8px;margin-bottom:16px;overflow-x:auto;">
                                <button onclick="filtrarAlertas('todas')" class="filtro-alertas active" style="background:#FFD700;color:#181818;border:none;padding:6px 12px;border-radius:16px;font-size:0.85rem;white-space:nowrap;">Todas</button>
                                <button onclick="filtrarAlertas('equipos')" class="filtro-alertas" style="background:#333;color:#FFD700;border:none;padding:6px 12px;border-radius:16px;font-size:0.85rem;white-space:nowrap;">Equipos</button>
                                <button onclick="filtrarAlertas('likes')" class="filtro-alertas" style="background:#333;color:#FFD700;border:none;padding:6px 12px;border-radius:16px;font-size:0.85rem;white-space:nowrap;">Likes</button>
                                <button onclick="filtrarAlertas('comentarios')" class="filtro-alertas" style="background:#333;color:#FFD700;border:none;padding:6px 12px;border-radius:16px;font-size:0.85rem;white-space:nowrap;">Comentarios</button>
                                <button onclick="filtrarAlertas('seguidores')" class="filtro-alertas" style="background:#333;color:#FFD700;border:none;padding:6px 12px;border-radius:16px;font-size:0.85rem;white-space:nowrap;">Seguidores</button>
                                <button onclick="filtrarAlertas('partidos')" class="filtro-alertas" style="background:#333;color:#FFD700;border:none;padding:6px 12px;border-radius:16px;font-size:0.85rem;white-space:nowrap;">Partidos</button>
                            </div>
                            <div id="alertasList" style="display:flex;flex-direction:column;gap:12px;"></div>
                        </div>
                    `;
                    cargarAlertas();
                }

                function cargarAlertas() {
                    const alertasDemo = [
                        {tipo:'likes',mensaje:'Carlos P√©rez le dio ‚öΩ like a tu publicaci√≥n',usuario:'Carlos P√©rez',avatar:'https://i.imgur.com/placeholder-user1.jpg',fecha:'hace 5 min',accion:'ver_publicacion'},
                        {tipo:'comentarios',mensaje:'Ana Garc√≠a coment√≥: "¬°Excelente jugada!"',usuario:'Ana Garc√≠a',avatar:'https://i.imgur.com/placeholder-user2.jpg',fecha:'hace 10 min',accion:'ver_comentario'},
                        {tipo:'equipos',mensaje:'Invitaci√≥n para unirte al equipo "Los Tigres"',usuario:'FC Tigres',avatar:'https://i.imgur.com/placeholder-team.jpg',fecha:'hace 15 min',accion:'aceptar_rechazar',pendiente:true},
                        {tipo:'seguidores',mensaje:'Luis Torres comenz√≥ a seguirte',usuario:'Luis Torres',avatar:'https://i.imgur.com/placeholder-user3.jpg',fecha:'hace 30 min',accion:'ver_perfil'},
                        {tipo:'partidos',mensaje:'Partido confirmado para ma√±ana 3:00 PM vs Real Madrid',usuario:'Sistema',avatar:'https://i.imgur.com/placeholder-system.jpg',fecha:'hace 1 hora',accion:'ver_calendario'},
                        {tipo:'transmisiones',mensaje:'Mar√≠a Rodr√≠guez est√° transmitiendo en vivo',usuario:'Mar√≠a Rodr√≠guez',avatar:'https://i.imgur.com/placeholder-user4.jpg',fecha:'hace 2 min',accion:'ver_transmision',enVivo:true}
                    ];
                    
                    let alertas = JSON.parse(localStorage.getItem('futpro_alertas')||'[]');
                    if(alertas.length === 0) {
                        alertas = alertasDemo;
                        localStorage.setItem('futpro_alertas', JSON.stringify(alertas));
                    }
                    
                    renderAlertas(alertas);
                    actualizarBadgeAlertas(alertas.filter(a => !a.leida).length);
                }

                function renderAlertas(alertas, filtro = 'todas') {
                    const alertasFiltradas = filtro === 'todas' ? alertas : alertas.filter(a => a.tipo === filtro);
                    const lista = document.getElementById('alertasList');
                    if(!lista) return;
                    
                    lista.innerHTML = alertasFiltradas.map(alerta => `
                        <div style="background:${alerta.leida ? 'rgba(51,51,51,0.5)' : 'rgba(24,24,24,0.9)'};border:${alerta.leida ? '1px solid #333' : '2px solid #FFD700'};border-radius:12px;padding:16px;display:flex;align-items:center;gap:12px;${alerta.enVivo ? 'animation:pulse 2s infinite;' : ''}" onclick="procesarAlerta('${alerta.tipo}','${alerta.accion}')">
                            <img src="${alerta.avatar}" alt="${alerta.usuario}" style="width:40px;height:40px;border-radius:50%;border:2px solid ${alerta.enVivo ? '#FF1744' : '#FFD700'};">
                            <div style="flex:1;">
                                <div style="color:#FFD700;font-weight:bold;font-size:0.9rem;margin-bottom:4px;">${alerta.mensaje}</div>
                                <div style="color:#888;font-size:0.8rem;">${alerta.fecha}</div>
                            </div>
                            ${alerta.pendiente ? `
                                <div style="display:flex;gap:8px;">
                                    <button onclick="event.stopPropagation();responderInvitacion(true)" style="background:#00ff88;color:#181818;border:none;padding:6px 12px;border-radius:6px;font-size:0.8rem;">Aceptar</button>
                                    <button onclick="event.stopPropagation();responderInvitacion(false)" style="background:#FF4444;color:#fff;border:none;padding:6px 12px;border-radius:6px;font-size:0.8rem;">Rechazar</button>
                                </div>
                            ` : ''}
                            ${alerta.enVivo ? '<div style="background:#FF1744;color:#fff;padding:4px 8px;border-radius:12px;font-size:0.7rem;font-weight:bold;">EN VIVO</div>' : ''}
                        </div>
                    `).join('');
                }

                function filtrarAlertas(tipo) {
                    document.querySelectorAll('.filtro-alertas').forEach(btn => {
                        btn.style.background = '#333';
                        btn.style.color = '#FFD700';
                        btn.classList.remove('active');
                    });
                    event.target.style.background = '#FFD700';
                    event.target.style.color = '#181818';
                    event.target.classList.add('active');
                    
                    const alertas = JSON.parse(localStorage.getItem('futpro_alertas')||'[]');
                    renderAlertas(alertas, tipo);
                }

                function procesarAlerta(tipo, accion) {
                    switch(accion) {
                        case 'ver_publicacion':
                            irAHome();
                            break;
                        case 'ver_perfil':
                            mostrarConfirmacion('üë§ Viendo perfil');
                            break;
                        case 'ver_transmision':
                            mostrarConfirmacion('üî¥ Uniendo a transmisi√≥n');
                            break;
                        case 'ver_calendario':
                            mostrarConfirmacion('üìÖ Abriendo calendario');
                            break;
                    }
                }

                function responderInvitacion(aceptar) {
                    const mensaje = aceptar ? '‚úÖ Invitaci√≥n aceptada' : '‚ùå Invitaci√≥n rechazada';
                    mostrarConfirmacion(mensaje);
                    // Aqu√≠ se actualizar√≠a la invitaci√≥n
                }

                function actualizarBadgeAlertas(count) {
                    const badge = document.getElementById('alertasBadge');
                    if(badge) {
                        badge.style.display = count > 0 ? 'block' : 'none';
                        badge.textContent = count;
                    }
                }

                // ====== CHAT Y MENSAJER√çA ======
                function mostrarChat() {
                    const section = document.getElementById('chatSection');
                    section.style.display = 'block';
                    section.innerHTML = `
                        <div style="padding:20px 0;">
                            <h2 style="color:#FFD700;font-size:1.4rem;margin-bottom:20px;">Chat FutPro</h2>
                            <div style="display:flex;gap:8px;margin-bottom:16px;overflow-x:auto;">
                                <button onclick="mostrarTipoChat('equipos')" class="filtro-chat active" style="background:#FFD700;color:#181818;border:none;padding:6px 12px;border-radius:16px;font-size:0.85rem;white-space:nowrap;">Equipos</button>
                                <button onclick="mostrarTipoChat('directos')" class="filtro-chat" style="background:#333;color:#FFD700;border:none;padding:6px 12px;border-radius:16px;font-size:0.85rem;white-space:nowrap;">Mensajes Directos</button>
                                <button onclick="mostrarTipoChat('grupos')" class="filtro-chat" style="background:#333;color:#FFD700;border:none;padding:6px 12px;border-radius:16px;font-size:0.85rem;white-space:nowrap;">Grupos</button>
                            </div>
                            <div id="chatList" style="display:flex;flex-direction:column;gap:8px;"></div>
                        </div>
                    `;
                    cargarChats();
                }

                function cargarChats() {
                    const chatsDemo = {
                        equipos: [
                            {id:'team1',nombre:'FC Barcelona',avatar:'https://i.imgur.com/placeholder-barca.jpg',ultimoMensaje:'¬°Preparando el partido de ma√±ana!',fecha:'hace 5 min',online:true,noLeidos:3},
                            {id:'team2',nombre:'Real Madrid',avatar:'https://i.imgur.com/placeholder-real.jpg',ultimoMensaje:'Gran entrenamiento hoy',fecha:'hace 1 hora',online:false,noLeidos:0},
                            {id:'team3',nombre:'Los Tigres',avatar:'https://i.imgur.com/placeholder-tigres.jpg',ultimoMensaje:'Estrategia para el pr√≥ximo juego',fecha:'hace 2 horas',online:true,noLeidos:1}
                        ],
                        directos: [
                            {id:'user1',nombre:'Carlos P√©rez',avatar:'https://i.imgur.com/placeholder-user1.jpg',ultimoMensaje:'¬øVienes al partido?',fecha:'hace 10 min',online:true,noLeidos:2},
                            {id:'user2',nombre:'Ana Garc√≠a',avatar:'https://i.imgur.com/placeholder-user2.jpg',ultimoMensaje:'Excelente jugada!',fecha:'hace 30 min',online:false,noLeidos:0},
                            {id:'user3',nombre:'Luis Torres',avatar:'https://i.imgur.com/placeholder-user3.jpg',ultimoMensaje:'Nos vemos en el campo',fecha:'hace 1 hora',online:true,noLeidos:1}
                        ],
                        grupos: [
                            {id:'group1',nombre:'F√∫tbol Local',avatar:'https://i.imgur.com/placeholder-group1.jpg',ultimoMensaje:'Nueva fecha confirmada',fecha:'hace 15 min',online:true,noLeidos:5,miembros:24},
                            {id:'group2',nombre:'Entrenadores',avatar:'https://i.imgur.com/placeholder-group2.jpg',ultimoMensaje:'Compartiendo t√©cnicas',fecha:'hace 45 min',online:false,noLeidos:0,miembros:12}
                        ]
                    };
                    
                    let chats = JSON.parse(localStorage.getItem('futpro_chats')||'{}');
                    if(Object.keys(chats).length === 0) {
                        chats = chatsDemo;
                        localStorage.setItem('futpro_chats', JSON.stringify(chats));
                    }
                    
                    mostrarTipoChat('equipos', chats);
                }

                function mostrarTipoChat(tipo, chatsData = null) {
                    document.querySelectorAll('.filtro-chat').forEach(btn => {
                        btn.style.background = '#333';
                        btn.style.color = '#FFD700';
                        btn.classList.remove('active');
                    });
                    event?.target?.style.setProperty('background', '#FFD700');
                    event?.target?.style.setProperty('color', '#181818');
                    event?.target?.classList.add('active');
                    
                    const chats = chatsData || JSON.parse(localStorage.getItem('futpro_chats')||'{}');
                    const lista = document.getElementById('chatList');
                    if(!lista) return;
                    
                    const chatsDelTipo = chats[tipo] || [];
                    lista.innerHTML = chatsDelTipo.map(chat => `
                        <div style="background:rgba(24,24,24,0.9);border:1px solid #333;border-radius:12px;padding:16px;display:flex;align-items:center;gap:12px;cursor:pointer;" onclick="abrirChat('${chat.id}','${chat.nombre}','${tipo}')">
                            <div style="position:relative;">
                                <img src="${chat.avatar}" alt="${chat.nombre}" style="width:50px;height:50px;border-radius:50%;border:2px solid #FFD700;">
                                ${chat.online ? '<div style="position:absolute;bottom:2px;right:2px;width:12px;height:12px;background:#00ff88;border:2px solid #181818;border-radius:50%;"></div>' : ''}
                            </div>
                            <div style="flex:1;">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                                    <div style="color:#FFD700;font-weight:bold;font-size:1rem;">${chat.nombre}</div>
                                    <div style="color:#888;font-size:0.8rem;">${chat.fecha}</div>
                                </div>
                                <div style="color:#ccc;font-size:0.9rem;display:flex;justify-content:space-between;align-items:center;">
                                    <span>${chat.ultimoMensaje}</span>
                                    ${chat.noLeidos > 0 ? `<div style="background:#FF4444;color:#fff;border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:0.8rem;font-weight:bold;">${chat.noLeidos}</div>` : ''}
                                </div>
                                ${chat.miembros ? `<div style="color:#888;font-size:0.8rem;margin-top:4px;">${chat.miembros} miembros</div>` : ''}
                            </div>
                        </div>
                    `).join('');
                }

                function abrirChat(chatId, nombre, tipo) {
                    const chatModal = document.createElement('div');
                    chatModal.id = 'chatModal';
                    chatModal.style.cssText = `
                        position:fixed;top:0;left:0;width:100%;height:100%;
                        background:rgba(0,0,0,0.95);z-index:1000;
                        display:flex;flex-direction:column;
                    `;
                    
                    const mensajesDemo = [
                        {usuario:'Carlos P√©rez',mensaje:'¬°Hola equipo! ¬øListos para el partido?',fecha:'10:30 AM',avatar:'https://i.imgur.com/placeholder-user1.jpg',esPropio:false},
                        {usuario:'T√∫',mensaje:'¬°Por supuesto! Ya estoy preparando mi equipamiento',fecha:'10:32 AM',avatar:'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNGRkQ3MDAiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSI+CjxwYXRoIGQ9Ik0xMiAxMkMxNC4yMDkxIDEyIDE2IDEwLjIwOTEgMTYgOEMxNiA1Ljc5MDg2IDE0LjIwOTEgNCAxMiA0QzkuNzkwODYgNCA4IDUuNzkwODYgOCA4QzggMTAuMjA5MSA5Ljc5MDg2IDEyIDEyIDEyWiIgZmlsbD0iIzE4MTgxOCIvPgo8cGF0aCBkPSJNMTIgMTRDOC4xMzQwMSAxNCA1IDE2Ljg5NTQgNSAyMC41QzUgMjEuMzI4NCA1LjY3MTU3IDIyIDYuNSAyMkgxNy41QzE4LjMyODQgMjIgMTkgMjEuMzI4NCAxOSAyMC41QzE5IDE2Ljg5NTQgMTUuODY2IDE0IDEyIDE0WiIgZmlsbD0iIzE4MTgxOCIvPgo8L3N2Zz4KPC9zdmc+',esPropio:true},
                        {usuario:'Ana Garc√≠a',mensaje:'Recuerden llevar las camisetas nuevas',fecha:'10:35 AM',avatar:'https://i.imgur.com/placeholder-user2.jpg',esPropio:false}
                    ];
                    
                    chatModal.innerHTML = `
                        <div style="background:#181818;border-bottom:1px solid #333;padding:16px;display:flex;align-items:center;gap:12px;">
                            <button onclick="cerrarChat()" style="background:none;border:none;color:#FFD700;font-size:1.2rem;">‚Üê</button>
                            <img src="https://i.imgur.com/placeholder-${tipo}.jpg" alt="${nombre}" style="width:40px;height:40px;border-radius:50%;border:2px solid #FFD700;">
                            <div style="flex:1;">
                                <div style="color:#FFD700;font-weight:bold;">${nombre}</div>
                                <div style="color:#888;font-size:0.8rem;">${tipo === 'equipos' ? 'Equipo' : tipo === 'grupos' ? 'Grupo' : 'Chat directo'}</div>
                            </div>
                            <button style="background:none;border:none;color:#FFD700;font-size:1.2rem;">üìû</button>
                            <button style="background:none;border:none;color:#FFD700;font-size:1.2rem;">üìπ</button>
                        </div>
                        <div id="mensajesContainer" style="flex:1;padding:16px;overflow-y:auto;display:flex;flex-direction:column;gap:12px;">
                            ${mensajesDemo.map(msg => `
                                <div style="display:flex;align-items:flex-end;gap:8px;${msg.esPropio ? 'flex-direction:row-reverse;' : ''}">
                                    <img src="${msg.avatar}" alt="${msg.usuario}" style="width:30px;height:30px;border-radius:50%;border:1px solid #FFD700;">
                                    <div style="max-width:70%;${msg.esPropio ? 'margin-left:auto;' : ''}">
                                        <div style="background:${msg.esPropio ? '#FFD700' : 'rgba(51,51,51,0.8)'};color:${msg.esPropio ? '#181818' : '#fff'};padding:12px;border-radius:16px;${msg.esPropio ? 'border-bottom-right-radius:4px;' : 'border-bottom-left-radius:4px;'}">${msg.mensaje}</div>
                                        <div style="color:#888;font-size:0.7rem;margin-top:4px;${msg.esPropio ? 'text-align:right;' : ''}">${msg.fecha}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="background:#181818;border-top:1px solid #333;padding:16px;display:flex;gap:12px;align-items:center;">
                            <input type="text" id="mensajeInput" placeholder="Escribe un mensaje..." style="flex:1;background:rgba(51,51,51,0.8);border:1px solid #333;border-radius:20px;padding:12px 16px;color:#fff;font-size:0.9rem;" onkeypress="if(event.key==='Enter') enviarMensaje()">
                            <button onclick="enviarMensaje()" style="background:#FFD700;color:#181818;border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;">‚û§</button>
                        </div>
                    `;
                    
                    document.body.appendChild(chatModal);
                    document.getElementById('mensajeInput').focus();
                }

                function enviarMensaje() {
                    const input = document.getElementById('mensajeInput');
                    const mensaje = input.value.trim();
                    if(!mensaje) return;
                    
                    const container = document.getElementById('mensajesContainer');
                    const ahora = new Date().toLocaleTimeString('es-ES', {hour:'2-digit',minute:'2-digit'});
                    
                    const nuevoMensaje = document.createElement('div');
                    nuevoMensaje.style.cssText = 'display:flex;align-items:flex-end;gap:8px;flex-direction:row-reverse;';
                    nuevoMensaje.innerHTML = `
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNGRkQ3MDAiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSI+CjxwYXRoIGQ9Ik0xMiAxMkMxNC4yMDkxIDEyIDE2IDEwLjIwOTEgMTYgOEMxNiA1Ljc5MDg2IDE0LjIwOTEgNCA0IDEyIDRDOS43OTA4NiA0IDggNS43OTA4NiA4IDhDOCAxMC4yMDkxIDkuNzkwODYgMTIgMTIgMTJaIiBmaWxsPSIjMTgxODE4Ii8+CjxwYXRoIGQ9Ik0xMiAxNEM4LjEzNDAxIDE0IDUgMTYuODk1NCA1IDIwLjVDNSAyMS4zMjg0IDUuNjcxNTcgMjIgNi41IDIySDEuNUM4LjMyODQgMjIgMTkgMjEuMzI4NCAxOSAyMC41QzE5IDE2Ljg5NTQgMTUuODY2IDE0IDEyIDE0WiIgZmlsbD0iIzE4MTgxOCIvPgo8L3N2Zz4KPC9zdmc+" alt="T√∫" style="width:30px;height:30px;border-radius:50%;border:1px solid #FFD700;">
                        <div style="max-width:70%;margin-left:auto;">
                            <div style="background:#FFD700;color:#181818;padding:12px;border-radius:16px;border-bottom-right-radius:4px;">${mensaje}</div>
                            <div style="color:#888;font-size:0.7rem;margin-top:4px;text-align:right;">${ahora}</div>
                        </div>
                    `;
                    
                    container.appendChild(nuevoMensaje);
                    container.scrollTop = container.scrollHeight;
                    input.value = '';
                    
                    // Auto-guardar mensaje
                    futproAutoSave.saveTemporaryData('ultimo_mensaje', {mensaje, fecha: ahora});
                    mostrarConfirmacion('üí¨ Mensaje enviado');
                }

                function cerrarChat() {
                    const modal = document.getElementById('chatModal');
                    if(modal) modal.remove();
                }

                function actualizarBadgeChat(count) {
                    const badge = document.getElementById('chatBadge');
                    if(badge) {
                        badge.style.display = count > 0 ? 'block' : 'none';
                        badge.textContent = count;
                    }
                }

                // ====== INICIALIZACI√ìN DE BADGES ======
                function inicializarBadges() {
                    // Simular notificaciones pendientes
                    actualizarBadgeAlertas(3);
                    actualizarBadgeChat(2);
                }

                // Inicializar badges al cargar la p√°gina
                document.addEventListener('DOMContentLoaded', inicializarBadges);

    // ===== CLASE FUTPRO AUTO SAVE =====
    class FutProAutoSave {
        save(categoria, data, accion = 'crear') {
            try {
                const registro = {
                    id: this.generateId(),
                    categoria,
                    accion,
                    data,
                    timestamp: new Date().toISOString(),
                    resumen: this.generarResumen(categoria, accion, data)
                };
                
                // Guardar en localStorage
                const existingData = JSON.parse(localStorage.getItem(`futpro_autosave_${categoria}`) || '[]');
                existingData.unshift(registro);
                
                // Limitar a 100 registros por categor√≠a
                if (existingData.length > 100) {
                    existingData.splice(100);
                }
                
                localStorage.setItem(`futpro_autosave_${categoria}`, JSON.stringify(existingData));
                console.log(`‚úÖ Auto-guardado: ${categoria} - ${accion}`, registro);
                return registro;
            } catch (error) {
                console.error('‚ùå Error en auto-guardado:', error);
                return null;
            }
        }

        generarResumen(categoria, accion, data) {
            const resumenes = {
                'likes_dados': `Le diste like a ${data.targetUser || 'contenido'}`,
                'likes_recibidos': `${data.fromUser} te dio like`,
                'comentarios_hechos': `Comentaste: "${data.comentario?.substring(0, 30)}..."`,
                'comentarios_recibidos': `${data.fromUser} coment√≥: "${data.comentario?.substring(0, 30)}..."`,
                'mensajes_enviados': `Enviaste mensaje a ${data.targetUser}`,
                'mensajes_recibidos': `${data.fromUser} te envi√≥ un mensaje`,
                'partidos': `Partido: ${data.equipoLocal} vs ${data.equipoVisitante}`,
                'equipos': `${accion === 'crear' ? 'Creaste' : 'Modificaste'} equipo: ${data.nombre}`,
                'torneos': `${accion === 'crear' ? 'Creaste' : 'Modificaste'} torneo: ${data.nombre}`,
                'fotos_subidas': `Subiste una foto: ${data.descripcion || 'Sin descripci√≥n'}`,
                'videos_subidos': `Subiste un video: ${data.titulo || 'Sin t√≠tulo'}`,
                'cambios_perfil': `Cambiaste tu ${data.campo}: ${data.valorAnterior} ‚Üí ${data.valorNuevo}`
            };
            return resumenes[categoria] || `${accion} en ${categoria}`;
        }

        // M√©todo para obtener datos espec√≠ficos
        get(categoria, filtros = {}) {
            const data = JSON.parse(localStorage.getItem(`futpro_${categoria}`) || '[]');
            if (Object.keys(filtros).length === 0) return data;
            
            return data.filter(item => {
                return Object.keys(filtros).every(key => item[key] === filtros[key]);
            });
        }

        // M√©todo para notificaciones
        createNotification(tipo, mensaje, targetUserId = null, data = {}) {
            const notificacion = {
                id: Date.now() + Math.random(),
                tipo: tipo, // 'like', 'comentario', 'mensaje', 'invitacion', etc.
                mensaje: mensaje,
                targetUserId: targetUserId || this.userId,
                fromUserId: this.userId,
                data: data,
                leida: false,
                timestamp: new Date().toISOString()
            };

            // Guardar notificaci√≥n para el usuario objetivo
            const notifs = JSON.parse(localStorage.getItem(`futpro_notificaciones_${targetUserId || this.userId}`) || '[]');
            notifs.unshift(notificacion); // M√°s recientes primero
            localStorage.setItem(`futpro_notificaciones_${targetUserId || this.userId}`, JSON.stringify(notifs));

            // Tambi√©n en sistema general
            this.save('notificaciones', notificacion, 'crear');
            return notificacion;
        }

        // ===== M√âTODOS ESPEC√çFICOS PARA CADA ACCI√ìN =====

        // EQUIPOS Y JUGADORES
        saveTeamCreation(equipoData) {
            return this.save('equipos_creados', {
                nombreEquipo: equipoData.nombre,
                descripcion: equipoData.descripcion,
                logo: equipoData.logo,
                jugadores: equipoData.jugadores || [],
                capitan: equipoData.capitan,
                estadisticas: { partidos: 0, victorias: 0, derrotas: 0, empates: 0 }
            });
        }

        savePlayerInvitation(invitacionData) {
            const invitacion = this.save('jugadores_invitados', {
                jugadorInvitado: invitacionData.jugador,
                equipoId: invitacionData.equipoId,
                nombreEquipo: invitacionData.nombreEquipo,
                posicion: invitacionData.posicion,
                mensaje: invitacionData.mensaje,
                estado: 'pendiente'
            });

            // Notificar al jugador invitado
            this.createNotification(
                'invitacion_equipo',
                `Te invitaron a unirte al equipo ${invitacionData.nombreEquipo}`,
                invitacionData.jugadorId,
                { equipoId: invitacionData.equipoId, invitacionId: invitacion.id }
            );

            return invitacion;
        }

        savePlayerAcceptance(aceptacionData) {
            return this.save('invitaciones_aceptadas', {
                equipoId: aceptacionData.equipoId,
                nombreEquipo: aceptacionData.nombreEquipo,
                posicion: aceptacionData.posicion,
                fechaUnion: new Date().toISOString()
            });
        }

        // PARTIDOS Y TORNEOS
        saveMatchCreation(partidoData) {
            return this.save('partidos_creados', {
                equipoLocal: partidoData.equipoLocal,
                equipoVisitante: partidoData.equipoVisitante,
                fecha: partidoData.fecha,
                hora: partidoData.hora,
                cancha: partidoData.cancha,
                tipo: partidoData.tipo || 'amistoso',
                torneoId: partidoData.torneoId
            });
        }

        saveMatchResult(resultadoData) {
            const resultado = this.save('resultados_registrados', {
                partidoId: resultadoData.partidoId,
                equipoLocal: resultadoData.equipoLocal,
                equipoVisitante: resultadoData.equipoVisitante,
                golesLocal: resultadoData.golesLocal,
                golesVisitante: resultadoData.golesVisitante,
                goleadores: resultadoData.goleadores || [],
                tarjetas: resultadoData.tarjetas || [],
                estadisticasDetalladas: resultadoData.estadisticas
            });

            // Actualizar estad√≠sticas de equipos
            this.updateTeamStats(resultadoData.equipoLocal, resultadoData.golesLocal, resultadoData.golesVisitante);
            this.updateTeamStats(resultadoData.equipoVisitante, resultadoData.golesVisitante, resultadoData.golesLocal);

            return resultado;
        }

        updateTeamStats(equipo, golesFavor, golesContra) {
            const estadisticas = JSON.parse(localStorage.getItem('futpro_estadisticas_equipo') || '[]');
            let equipoStats = estadisticas.find(e => e.nombreEquipo === equipo);
            
            if (!equipoStats) {
                equipoStats = {
                    nombreEquipo: equipo,
                    partidos: 0,
                    victorias: 0,
                    empates: 0,
                    derrotas: 0,
                    golesFavor: 0,
                    golesContra: 0,
                    puntos: 0
                };
                estadisticas.push(equipoStats);
            }

            equipoStats.partidos++;
            equipoStats.golesFavor += golesFavor;
            equipoStats.golesContra += golesContra;

            if (golesFavor > golesContra) {
                equipoStats.victorias++;
                equipoStats.puntos += 3;
            } else if (golesFavor === golesContra) {
                equipoStats.empates++;
                equipoStats.puntos += 1;
            } else {
                equipoStats.derrotas++;
            }

            localStorage.setItem('futpro_estadisticas_equipo', JSON.stringify(estadisticas));
            return this.save('estadisticas_equipo', equipoStats, 'actualizar');
        }

        saveTournamentCreation(torneoData) {
            return this.save('campeonatos_creados', {
                nombreTorneo: torneoData.nombre,
                descripcion: torneoData.descripcion,
                fechaInicio: torneoData.fechaInicio,
                fechaFin: torneoData.fechaFin,
                equiposParticipantes: torneoData.equipos || [],
                premio: torneoData.premio,
                reglamento: torneoData.reglamento,
                estado: 'programado'
            });
        }

        // CONTENIDO Y MEDIOS
        savePhotoUpload(fotoData) {
            return this.save('fotos_subidas', {
                archivo: fotoData.nombre,
                tama√±o: fotoData.size,
                tipo: fotoData.type,
                descripcion: fotoData.descripcion,
                ubicacion: fotoData.ubicacion,
                etiquetas: fotoData.etiquetas || [],
                privacidad: fotoData.privacidad || 'publico'
            });
        }

        saveVideoUpload(videoData) {
            return this.save('videos_subidos', {
                archivo: videoData.nombre,
                tama√±o: videoData.size,
                duracion: videoData.duracion,
                titulo: videoData.titulo,
                descripcion: videoData.descripcion,
                categoria: videoData.categoria,
                calidad: videoData.calidad
            });
        }

        saveLiveStream(enVivoData) {
            return this.save('en_vivos', {
                titulo: enVivoData.titulo,
                descripcion: enVivoData.descripcion,
                duracion: enVivoData.duracion,
                espectadores: enVivoData.espectadores || 0,
                comentarios: enVivoData.comentarios || [],
                calidad: enVivoData.calidad
            });
        }

        saveProfileChange(cambioData) {
            return this.save('cambios_perfil', {
                campo: cambioData.campo,
                valorAnterior: cambioData.valorAnterior,
                valorNuevo: cambioData.valorNuevo,
                tipo: cambioData.tipo || 'texto'
            });
        }

        saveProfilePhotoChange(fotoData) {
            const cambio = this.save('cambios_foto_perfil', {
                fotoAnterior: fotoData.fotoAnterior,
                fotaNueva: fotoData.fotaNueva,
                motivo: fotoData.motivo || 'actualizacion'
            });

            // Tambi√©n guardar como foto subida
            this.savePhotoUpload({
                nombre: 'foto_perfil_' + Date.now(),
                size: fotoData.size,
                type: fotoData.type,
                descripcion: 'Cambio de foto de perfil',
                ubicacion: 'perfil'
            });

            return cambio;
        }

        // CARDS Y PUBLICACIONES
        savePlayerCard(cardData) {
            return this.save('cards_jugador', {
                nombreJugador: cardData.nombre,
                posicion: cardData.posicion,
                edad: cardData.edad,
                nacionalidad: cardData.nacionalidad,
                overall: cardData.overall,
                estadisticas: cardData.stats,
                foto: cardData.foto,
                equipo: cardData.equipo
            });
        }

        saveTeamCard(cardData) {
            return this.save('cards_equipo', {
                nombreEquipo: cardData.nombre,
                logo: cardData.logo,
                fundacion: cardData.fundacion,
                estadio: cardData.estadio,
                jugadores: cardData.jugadores,
                palmares: cardData.palmares,
                rating: cardData.rating
            });
        }

        savePublication(publicacionData) {
            return this.save('publicaciones', {
                titulo: publicacionData.titulo,
                contenido: publicacionData.contenido,
                tipo: publicacionData.tipo, // 'texto', 'imagen', 'video'
                privacidad: publicacionData.privacidad,
                etiquetas: publicacionData.etiquetas || [],
                likes: 0,
                comentarios: []
            });
        }

        // ESTAD√çSTICAS Y DATOS
        savePlayerStats(statsData) {
            return this.save('estadisticas_jugador', {
                partidos: statsData.partidos || 0,
                goles: statsData.goles || 0,
                asistencias: statsData.asistencias || 0,
                tarjetasAmarillas: statsData.tarjetasAmarillas || 0,
                tarjetasRojas: statsData.tarjetasRojas || 0,
                minutos: statsData.minutos || 0,
                posicion: statsData.posicion,
                valoracion: statsData.valoracion || 0
            });
        }

        saveAlert(alertaData) {
            return this.save('alertas', {
                tipo: alertaData.tipo, // 'partido', 'invitacion', 'resultado', etc.
                titulo: alertaData.titulo,
                mensaje: alertaData.mensaje,
                fecha: alertaData.fecha,
                prioridad: alertaData.prioridad || 'media',
                leida: false,
                relacionadoCon: alertaData.relacionadoCon
            });
        }

        saveUpcomingMatch(partidoData) {
            return this.save('proximos_partidos', {
                equipoLocal: partidoData.equipoLocal,
                equipoVisitante: partidoData.equipoVisitante,
                fecha: partidoData.fecha,
                hora: partidoData.hora,
                cancha: partidoData.cancha,
                importancia: partidoData.importancia,
                tipo: partidoData.tipo
            });
        }

        // INTERACCIONES SOCIALES
        saveLikeGiven(likeData) {
            const like = this.save('likes_dados', {
                tipoContenido: likeData.tipo, // 'historia', 'publicacion', 'foto'
                contenidoId: likeData.contenidoId,
                propietario: likeData.propietario,
                ubicacion: likeData.ubicacion
            });

            // Notificar al due√±o del contenido
            if (likeData.propietarioId && likeData.propietarioId !== this.userId) {
                this.createNotification(
                    'like_recibido',
                    `Te dieron ‚öΩ like en tu ${likeData.tipo}`,
                    likeData.propietarioId,
                    { contenidoId: likeData.contenidoId, tipo: likeData.tipo }
                );
            }

            return like;
        }

        saveMessage(mensajeData) {
            const mensaje = this.save('mensajes_enviados', {
                destinatario: mensajeData.destinatario,
                destinatarioId: mensajeData.destinatarioId,
                contenido: mensajeData.contenido,
                tipo: mensajeData.tipo || 'texto', // 'texto', 'imagen', 'audio'
                conversacionId: mensajeData.conversacionId
            });

            // Guardar para el receptor
            const mensajeRecibido = {
                ...mensajeData,
                remitente: this.getCurrentUser().nombre,
                remitenteId: this.userId,
                id: mensaje.id,
                timestamp: mensaje.timestamp,
                leido: false
            };

            const mensajesRecibidos = JSON.parse(localStorage.getItem(`futpro_mensajes_recibidos_${mensajeData.destinatarioId}`) || '[]');
            mensajesRecibidos.push(mensajeRecibido);
            localStorage.setItem(`futpro_mensajes_recibidos_${mensajeData.destinatarioId}`, JSON.stringify(mensajesRecibidos));

            // Notificar
            this.createNotification(
                'mensaje_nuevo',
                `Nuevo mensaje de ${this.getCurrentUser().nombre}`,
                mensajeData.destinatarioId,
                { mensajeId: mensaje.id, preview: mensajeData.contenido.substring(0, 50) }
            );

            return mensaje;
        }

        getCurrentUser() {
            return JSON.parse(localStorage.getItem('futpro_user') || '{}');
        }

        // M√âTODO PARA OBTENER ESTAD√çSTICAS COMPLETAS
        getCompleteStats() {
            const categorias = [
                'likes_dados', 'likes_recibidos', 'comentarios_hechos', 'comentarios_recibidos',
                'mensajes_enviados', 'mensajes_recibidos', 'fotos_subidas', 'videos_subidos',
                'equipos_creados', 'partidos_jugados', 'campeonatos_creados', 'publicaciones'
            ];

            const stats = {};
            categorias.forEach(categoria => {
                const data = this.get(categoria);
                stats[categoria] = {
                    total: data.length,
                    hoy: data.filter(item => {
                        const itemDate = new Date(item.timestamp);
                        const today = new Date();
                        return itemDate.toDateString() === today.toDateString();
                    }).length,
                    estaSemana: data.filter(item => {
                        const itemDate = new Date(item.timestamp);
                        const weekAgo = new Date();
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        return itemDate >= weekAgo;
                    }).length
                };
            });

            return stats;
        }
    }

    // ===== FUNCIONES DE PUBLICACI√ìN =====
    function abrirModalPublicar() {
        if (document.getElementById('modalPublicar')) return;
        const modal = document.createElement('div');
        modal.id = 'modalPublicar';
        modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);z-index:20000;display:flex;align-items:center;justify-content:center;';
        modal.innerHTML = `
            <div style="background:#181818;padding:32px 24px 24px 24px;border-radius:22px;max-width:340px;width:96vw;box-shadow:0 8px 40px #000a;position:relative;">
                <button onclick="cerrarModalPublicar()" style="position:absolute;top:10px;right:10px;background:none;border:none;color:#FFD700;font-size:1.5rem;cursor:pointer;"><i class='fas fa-times'></i></button>
                <h3 style="color:#FFD700;font-size:1.2rem;margin-bottom:18px;">Publicar foto o video</h3>
                <form id="formPublicar" onsubmit="enviarPublicacion(event)" style="display:flex;flex-direction:column;gap:10px;">
                    <input type="file" id="archivoPublicacion" accept="image/*,video/*" required style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;" />
                    <input type="text" id="piePublicacion" maxlength="80" placeholder="Pie de foto (opcional)" style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;font-size:0.95rem;" />
                    <input type="text" id="numeralesPublicacion" maxlength="40" placeholder="#numerales (opcional)" style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;font-size:0.95rem;" />
                    <input type="text" id="ubicacionPublicacion" maxlength="40" placeholder="Ubicaci√≥n (opcional)" style="background:#222;color:#FFD700;padding:8px;border-radius:8px;border:1px solid #FFD700;font-size:0.95rem;" />
                    <button type="submit" style="background:#FFD700;color:#181818;font-weight:bold;padding:8px 0;border:none;border-radius:12px;font-size:1.1rem;margin-top:8px;">Publicar</button>
                </form>
            </div>
        `;
        document.body.appendChild(modal);
    }

    function cerrarModalPublicar() {
        const modal = document.getElementById('modalPublicar');
        if (modal) modal.remove();
    }

    function enviarPublicacion(e) {
        e.preventDefault();
        const archivo = document.getElementById('archivoPublicacion').files[0];
        const pie = document.getElementById('piePublicacion').value;
        const numerales = document.getElementById('numeralesPublicacion').value;
        const ubicacion = document.getElementById('ubicacionPublicacion').value;

        if (archivo) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const publicacion = {
                    id: 'pub_' + Date.now(),
                    tipo: archivo.type.startsWith('video/') ? 'video' : 'foto',
                    contenido: e.target.result,
                    pie: pie,
                    numerales: numerales,
                    ubicacion: ubicacion,
                    fecha: new Date().toISOString(),
                    likes: 0,
                    comentarios: []
                };

                // Guardar publicaci√≥n
                let publicaciones = JSON.parse(localStorage.getItem('futpro_publicaciones') || '[]');
                publicaciones.unshift(publicacion);
                localStorage.setItem('futpro_publicaciones', JSON.stringify(publicaciones));

                // Auto-guardar
                futproAutoSave.savePublication(publicacion);

                cerrarModalPublicar();
                cargarPublicaciones();
                mostrarConfirmacion('üì∏ Publicaci√≥n subida correctamente');
            };
            reader.readAsDataURL(archivo);
        }
    }

    // --- MEN√ö HAMBURGUESA DESPLEGABLE ---
    function toggleMenu() {
        const menu = document.getElementById('dropdownMenu');
        if (menu.style.display === 'none' || menu.style.display === '') {
            menu.style.display = 'block';
            setTimeout(() => menu.classList.add('show'), 10);
        } else {
            menu.classList.remove('show');
            setTimeout(() => menu.style.display = 'none', 400);
        }
    }
    // Cerrar men√∫ al hacer click fuera
    document.addEventListener('click', function(e) {
        const menu = document.getElementById('dropdownMenu');
        const btn = document.querySelector('.hamburger-btn');
        if (!menu.contains(e.target) && !btn.contains(e.target)) {
            menu.classList.remove('show');
            setTimeout(() => menu.style.display = 'none', 400);
        }
    });

    // === FUNCIONES DEL MEN√ö HAMBURGUESA - FUTPRO COMPLETO ===

    // SECCI√ìN PRINCIPAL
    function irAInicio() {
        // Cerrar men√∫ y animar transici√≥n
        toggleMenu();
        setTimeout(() => {
            window.location.href = '/homepage-instagram.html';
        }, 300);
    }

    function irAPerfil() {
        const usuario = JSON.parse(localStorage.getItem('futpro_user') || '{}');
        if (!usuario.nombre) {
            alert('Por favor, completa tu perfil primero');
            window.location.href = '/editar-perfil.html';
        } else {
            window.location.href = '/perfil-instagram.html';
        }
    }

    function editarPerfil() {
        // AUTO-GUARDAR: Acceso a editar perfil
        autoSave.save('navegacion', {
            seccion: 'editar_perfil',
            timestamp: new Date().toISOString()
        }, 'acceder');
        
    window.location.href = '/editar-perfil.html';
    }

    function verEstadisticas() {
        // Verificar datos de usuario y redirigir
        const stats = JSON.parse(localStorage.getItem('futpro_stats') || '{}');
        if (Object.keys(stats).length === 0) {
            // Crear estad√≠sticas iniciales
            const estadisticasBase = {
                partidos: 0,
                goles: 0,
                asistencias: 0,
                tarjetas: 0,
                posicion: 'No definida',
                equipo: 'Sin equipo'
            };
            localStorage.setItem('futpro_stats', JSON.stringify(estadisticasBase));
            
            // AUTO-GUARDAR: Estad√≠sticas inicializadas
            autoSave.save('estadisticas_detalladas', {
                accion: 'inicializar',
                estadisticas: estadisticasBase
            }, 'crear');
        }
        
        // AUTO-GUARDAR: Visualizaci√≥n de estad√≠sticas
        autoSave.save('navegacion', {
            seccion: 'estadisticas',
            timestamp: new Date().toISOString()
        }, 'acceder');
        
    window.location.href = '/estadisticas.html';
    }

    function verPartidos() {
        // Cargar o crear historial de partidos
        const partidos = JSON.parse(localStorage.getItem('futpro_partidos') || '[]');
        if (partidos.length === 0) {
            const partidosDemo = [
                {fecha: '2025-10-01', rival: 'FC Barcelona', resultado: '2-1', goles: 1, asistencias: 0},
                {fecha: '2025-09-28', rival: 'Real Madrid', resultado: '0-3', goles: 0, asistencias: 1}
            ];
            localStorage.setItem('futpro_partidos', JSON.stringify(partidosDemo));
            
            // AUTO-GUARDAR: Partidos inicializados
            partidosDemo.forEach(partido => {
                autoSave.save('partidos', {
                    ...partido,
                    tipo: 'demo_inicial'
                }, 'crear');
            });
        }
        
        // AUTO-GUARDAR: Acceso a partidos
        autoSave.save('navegacion', {
            seccion: 'partidos',
            timestamp: new Date().toISOString()
        }, 'acceder');
        
    window.location.href = '/partidos.html';
    }

    function verLogros() {
        // Generar logros basados en estad√≠sticas
        const stats = JSON.parse(localStorage.getItem('futpro_stats') || '{}');
        const logros = [];
        if (stats.goles > 5) logros.push('Goleador');
        if (stats.partidos > 10) logros.push('Veterano');
        if (stats.asistencias > 3) logros.push('Asistente');
        localStorage.setItem('futpro_logros', JSON.stringify(logros));
    window.location.href = '/logros.html';
    }

    function verTarjetas() {
    window.location.href = '/tarjetas.html';
    }

    // SECCI√ìN EQUIPOS Y TORNEOS
    function verEquipos() {
    window.location.href = '/equipos.html';
    }

    function crearEquipo() {
        const nombre = prompt('Nombre del nuevo equipo:');
        if (nombre && nombre.trim()) {
            const equipos = JSON.parse(localStorage.getItem('futpro_equipos') || '[]');
            const nuevoEquipo = {
                id: Date.now(),
                nombre: nombre.trim(),
                jugadores: [],
                fechaCreacion: new Date().toLocaleDateString(),
                partidos: 0,
                victorias: 0,
                creador: autoSave.userId
            };
            equipos.push(nuevoEquipo);
            localStorage.setItem('futpro_equipos', JSON.stringify(equipos));
            
            // AUTO-GUARDAR: Equipo creado
            autoSave.save('equipos', nuevoEquipo, 'crear');
            
            alert('¬°Equipo "' + nombre + '" creado exitosamente!');
            window.location.href = './equipos.html';
        }
    }

    function verTorneos() {
        // AUTO-GUARDAR: Acceso a torneos
        autoSave.save('navegacion', {
            seccion: 'torneos',
            timestamp: new Date().toISOString()
        }, 'acceder');
        
    window.location.href = '/torneo.html';
    }

    function crearTorneo() {
        const nombre = prompt('Nombre del nuevo torneo:');
        if (nombre && nombre.trim()) {
            const torneos = JSON.parse(localStorage.getItem('futpro_torneos') || '[]');
            const nuevoTorneo = {
                id: Date.now(),
                nombre: nombre.trim(),
                equipos: [],
                fechaInicio: new Date().toLocaleDateString(),
                estado: 'Inscripciones abiertas',
                creador: autoSave.userId
            };
            torneos.push(nuevoTorneo);
            localStorage.setItem('futpro_torneos', JSON.stringify(torneos));
            
            // AUTO-GUARDAR: Torneo creado
            autoSave.save('torneos', nuevoTorneo, 'crear');
            
            // AUTO-GUARDAR: Registro del campeonato
            autoSave.save('registros_campeonato', {
                torneoId: nuevoTorneo.id,
                nombre: nuevoTorneo.nombre,
                accion: 'crear_torneo',
                creador: autoSave.userId
            }, 'crear');
            
            alert('¬°Torneo "' + nombre + '" creado exitosamente!');
            window.location.href = './torneo.html';
        }
    }

    function crearAmistoso() {
    window.location.href = '/amistoso.html';
    }

    // SECCI√ìN JUEGOS Y CARDS
    function jugarPenaltis() {
    window.location.href = '/penaltis.html';
    }

    function centroJuegos() {
    window.location.href = '/juegos.html';
    }

    function verCardFIFA() {
    window.location.href = '/fifa-card-demo.html';
    }

    function sugerenciasCard() {
        const stats = JSON.parse(localStorage.getItem('futpro_stats') || '{}');
        let sugerencias = 'Sugerencias para mejorar tu Card FIFA:\n\n';
        
        if (stats.goles < 5) sugerencias += '‚öΩ Anota m√°s goles para aumentar tu rating de ataque\n';
        if (stats.asistencias < 3) sugerencias += 'üéØ Haz m√°s asistencias para mejorar tu pase\n';
        if (stats.partidos < 10) sugerencias += 'üèÉ Juega m√°s partidos para ganar experiencia\n';
        if (!stats.posicion || stats.posicion === 'No definida') sugerencias += 'üìç Define tu posici√≥n favorita\n';
        
        if (sugerencias === 'Sugerencias para mejorar tu Card FIFA:\n\n') {
            sugerencias += 'üåü ¬°Tu rendimiento es excelente! Sigue as√≠ para mantener tu rating alto.';
        }
        
        alert(sugerencias);
    }

    // SECCI√ìN SOCIAL
    function verNotificaciones() {
        // Crear notificaciones din√°micas
        const notificaciones = [
            {tipo: 'partido', mensaje: 'Nuevo partido programado para ma√±ana', fecha: new Date().toLocaleDateString()},
            {tipo: 'logro', mensaje: 'Has desbloqueado el logro "Goleador"', fecha: new Date().toLocaleDateString()}
        ];
        localStorage.setItem('futpro_notificaciones', JSON.stringify(notificaciones));
    window.location.href = '/notificaciones.html';
    }

    function abrirChat() {
    window.location.href = '/chat.html';
    }

    function verVideos() {
    window.location.href = '/videos.html';
    }

    function abrirMarketplace() {
    window.location.href = '/marketplace.html';
    }

    function verEstados() {
    window.location.href = '/estados.html';
    }

    function verAmigos() {
        // Crear lista de amigos demo si no existe
        const amigos = JSON.parse(localStorage.getItem('futpro_amigos') || '[]');
        if (amigos.length === 0) {
            const amigosDemo = [
                {nombre: 'Carlos P√©rez', equipo: 'FC Barcelona', online: true},
                {nombre: 'Ana Garc√≠a', equipo: 'Real Madrid', online: false},
                {nombre: 'Luis Torres', equipo: 'Atl√©tico', online: true}
            ];
            localStorage.setItem('futpro_amigos', JSON.stringify(amigosDemo));
        }
    window.location.href = '/amigos.html';
    }

    // SECCI√ìN RANKINGS
    function rankingJugadores() {
    window.location.href = '/ranking.html';
    }

    function rankingPartidos() {
    window.location.href = '/ranking.html#partidos';
    }

    function buscarRanking() {
    window.location.href = '/buscar-ranking.html';
    }

    // SECCI√ìN ADMINISTRACI√ìN
    function abrirConfiguracion() {
    window.location.href = '/configuracion.html';
    }

    function contactarSoporte() {
        const problema = prompt('Describe brevemente tu problema o consulta:');
        if (problema && problema.trim()) {
            const tickets = JSON.parse(localStorage.getItem('futpro_soporte') || '[]');
            const nuevoTicket = {
                id: Date.now(),
                problema: problema.trim(),
                fecha: new Date().toLocaleDateString(),
                estado: 'Pendiente'
            };
            tickets.push(nuevoTicket);
            localStorage.setItem('futpro_soporte', JSON.stringify(tickets));
            alert('Tu consulta ha sido enviada. Ticket #' + nuevoTicket.id + '\n\nNuestro equipo te responder√° pronto.');
            window.location.href = './soporte.html';
        }
    }

    function verPrivacidad() {
    window.location.href = '/privacidad.html';
    }

    // Funci√≥n para cerrar sesi√≥n
    function cerrarSesion() {
        if (confirm('¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
            // Limpiar datos de sesi√≥n y redirigir a login
            localStorage.removeItem('futpro_user');
            localStorage.removeItem('futpro_token');
            sessionStorage.clear();
        window.location.href = '/index.html';
        }
    }

    // Funci√≥n auxiliar para cerrar men√∫
    function cerrarMenu() {
        const menu = document.getElementById('dropdownMenu');
        menu.classList.remove('show');
        setTimeout(() => menu.style.display = 'none', 400);
    }
    </script>

    <!-- BARRA DE HISTORIAS ESTILO INSTAGRAM (DEBAJO DEL HEADER) -->
    <div class="stories-container" style="margin:0 auto 32px auto;max-width:1100px;display:flex;gap:32px;padding:28px 24px 18px 24px;overflow-x:auto;background:rgba(30,30,30,0.98);border-radius:22px;border:2px solid #FFD700;box-shadow:0 4px 24px #0008;align-items:flex-end;">
        <!-- Historia del usuario due√±o (siempre a la izquierda) -->
        <div class="story" style="display:flex;flex-direction:column;align-items:center;min-width:90px;cursor:pointer;" onclick="abrirHistoria('mi-historia')">
            <div class="story-avatar" style="width:80px;height:80px;border-radius:50%;background:linear-gradient(45deg,#FFD700,#181818 80%);display:flex;align-items:center;justify-content:center;margin-bottom:8px;padding:4px;box-shadow:0 2px 12px #000a;position:relative;">
                <img src="https://i.imgur.com/placeholder-user.jpg" alt="Mi Historia" class="avatar-circular">
                <div class="story-indicator" style="position:absolute;top:-2px;right:-2px;width:20px;height:20px;background:#4CAF50;border-radius:50%;border:2px solid #181818;"></div>
            </div>
            <span class="story-username" style="color:#FFD700;font-weight:bold;font-size:12px;">Mi Historia</span>
        </div>
        <!-- Otras historias -->
        <div class="story" style="display:flex;flex-direction:column;align-items:center;min-width:90px;cursor:pointer;" onclick="abrirHistoria('fc-barcelona')">
            <div class="story-avatar" style="width:80px;height:80px;border-radius:50%;background:linear-gradient(45deg,#004d98,#dc143c);display:flex;align-items:center;justify-content:center;margin-bottom:8px;padding:4px;box-shadow:0 2px 12px #000a;position:relative;">
                <img src="https://i.imgur.com/placeholder-team1.jpg" alt="FC Barcelona" class="avatar-circular">
                <div class="story-indicator" style="position:absolute;top:-2px;right:-2px;width:20px;height:20px;background:#FF1744;border-radius:50%;border:2px solid #181818;"></div>
            </div>
            <span class="story-username" style="color:#fff;font-weight:500;font-size:12px;">FC Barcelona</span>
        </div>
        <div class="story" style="display:flex;flex-direction:column;align-items:center;min-width:90px;cursor:pointer;" onclick="abrirHistoria('real-madrid')">
            <div class="story-avatar" style="width:80px;height:80px;border-radius:50%;background:linear-gradient(45deg,#ffffff,#FFD700);display:flex;align-items:center;justify-content:center;margin-bottom:8px;padding:4px;box-shadow:0 2px 12px #000a;position:relative;">
                <img src="https://i.imgur.com/placeholder-team2.jpg" alt="Real Madrid" class="avatar-circular">
                <div class="story-indicator" style="position:absolute;top:-2px;right:-2px;width:20px;height:20px;background:#FF1744;border-radius:50%;border:2px solid #181818;"></div>
            </div>
            <span class="story-username" style="color:#fff;font-weight:500;font-size:12px;">Real Madrid</span>
        </div>
        <div class="story" style="display:flex;flex-direction:column;align-items:center;min-width:90px;cursor:pointer;" onclick="abrirHistoria('liverpool-fc')">
            <div class="story-avatar" style="width:80px;height:80px;border-radius:50%;background:linear-gradient(45deg,#c8102e,#FFD700);display:flex;align-items:center;justify-content:center;margin-bottom:8px;padding:4px;box-shadow:0 2px 12px #000a;position:relative;">
                <img src="https://i.imgur.com/placeholder-team3.jpg" alt="Liverpool FC" class="avatar-circular">
                <div class="story-indicator" style="position:absolute;top:-2px;right:-2px;width:20px;height:20px;background:#4CAF50;border-radius:50%;border:2px solid #181818;"></div>
            </div>
            <span class="story-username" style="color:#fff;font-weight:500;font-size:12px;">Liverpool FC</span>
        </div>
        <div class="story" style="display:flex;flex-direction:column;align-items:center;min-width:90px;cursor:pointer;" onclick="abrirHistoria('en-vivo')">
            <div class="story-avatar" style="width:80px;height:80px;border-radius:50%;background:linear-gradient(45deg,#FF1744,#FF5722);display:flex;align-items:center;justify-content:center;margin-bottom:8px;padding:4px;box-shadow:0 2px 12px #000a;position:relative;">
                <i class="fas fa-broadcast-tower" style="font-size:32px;color:#fff;"></i>
                <div class="live-pulse" style="position:absolute;top:-2px;right:-2px;width:20px;height:20px;background:#FF1744;border-radius:50%;border:2px solid #181818;animation:pulse 1.5s infinite;"></div>
            </div>
            <span class="story-username" style="color:#FF1744;font-weight:bold;font-size:12px;">EN VIVO</span>
        </div>
    </div>

    <!-- MODAL PARA HISTORIAS TIPO TIKTOK -->
    <div id="modalHistorias" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000;z-index:10000;overflow:hidden;">
        <div class="historia-container" style="position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;">
            <!-- Bot√≥n cerrar -->
            <button onclick="cerrarHistorias()" style="position:absolute;top:20px;right:20px;background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:24px;cursor:pointer;z-index:10001;padding:8px 12px;border-radius:50%;">
                <i class="fas fa-times"></i>
            </button>
            
            <!-- Indicadores de progreso -->
            <div class="progress-indicators" style="position:absolute;top:20px;left:20px;right:60px;display:flex;gap:4px;z-index:10001;" id="progressIndicators"></div>
            
            <!-- Contenedor del video/historia -->
            <div class="historia-content" style="width:100%;max-width:400px;height:100vh;position:relative;background:#181818;display:flex;flex-direction:column;">
                <!-- Video principal -->
                <div class="video-player" style="flex:1;position:relative;overflow:hidden;" id="videoPlayer">
                    <video style="width:100%;height:100%;object-fit:cover;" id="historiaVideo" muted autoplay loop>
                        <source src="" type="video/mp4">
                    </video>
                    
                    <!-- Overlay de informaci√≥n -->
                    <div class="historia-overlay" style="position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(0,0,0,0.7));padding:20px;color:#fff;">
                        <div class="historia-user" style="display:flex;align-items:center;gap:12px;margin-bottom:12px;" id="historiaUser">
                            <img src="" alt="" style="width:40px;height:40px;border-radius:50%;border:2px solid #FFD700;" id="historiaAvatar">
                            <div>
                                <div style="font-weight:bold;font-size:16px;" id="historiaNombre"></div>
                                <div style="font-size:12px;color:#ccc;" id="historiaTiempo"></div>
                            </div>
                        </div>
                        <div class="historia-text" style="font-size:16px;line-height:1.4;" id="historiaTexto"></div>
                        
                        <!-- Controles tipo TikTok -->
                        <div class="historia-controls" style="position:absolute;right:16px;bottom:100px;display:flex;flex-direction:column;gap:16px;align-items:center;">
                            <button class="control-btn like-btn" onclick="toggleLikeHistoria()" style="background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:20px;padding:12px;border-radius:50%;cursor:pointer;transition:all 0.3s;">
                                <i class="fas fa-futbol"></i>
                                <div style="font-size:12px;margin-top:4px;" id="likesCount">0</div>
                            </button>
                            <button class="control-btn comment-btn" onclick="abrirComentarios()" style="background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:20px;padding:12px;border-radius:50%;cursor:pointer;">
                                <i class="fas fa-comment"></i>
                                <div style="font-size:12px;margin-top:4px;">üí¨</div>
                            </button>
                            <button class="control-btn viewers-btn" onclick="mostrarViewersHistoria()" style="background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:20px;padding:12px;border-radius:50%;cursor:pointer;display:none;">
                                <i class="fas fa-eye"></i>
                                <div style="font-size:12px;margin-top:4px;">üëÅÔ∏è</div>
                            </button>
                            <button class="control-btn share-btn" onclick="compartirHistoria()" style="background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:20px;padding:12px;border-radius:50%;cursor:pointer;">
                                <i class="fas fa-share"></i>
                                <div style="font-size:12px;margin-top:4px;">üì§</div>
                            </button>
                            <button class="control-btn mute-btn" onclick="toggleMute()" style="background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:20px;padding:12px;border-radius:50%;cursor:pointer;">
                                <i class="fas fa-volume-mute" id="muteIcon"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Navegaci√≥n entre historias -->
            <button onclick="historiaAnterior()" style="position:absolute;left:20px;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:24px;padding:12px;border-radius:50%;cursor:pointer;" id="btnAnterior">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="historiaSiguiente()" style="position:absolute;right:20px;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.5);border:none;color:#fff;font-size:24px;padding:12px;border-radius:50%;cursor:pointer;" id="btnSiguiente">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <style>
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .progress-indicator {
            height: 3px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            flex: 1;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #FFD700;
            width: 0%;
            transition: width 0.1s linear;
        }
        
        @keyframes progreso {
            from { width: 0%; }
            to { width: 100%; }
        }
        
        @keyframes aparecer {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes aparecerConfirm {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
    </style>

    <!-- CONTENIDO PRINCIPAL - MURO ESTILO INSTAGRAM -->
    <div class="main-content" style="max-width:1200px;width:100vw;margin:0 auto;padding:0 0 40px 0;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-height:calc(100vh - 120px);background:none;">
        <!-- BOT√ìN PUBLICAR PEQUE√ëO EN HOME -->
        <div style="width:100%;max-width:600px;margin:0 auto 12px auto;display:flex;justify-content:flex-end;">
            <button onclick="abrirModalPublicar()" style="background:#FFD700;color:#181818;font-weight:bold;padding:6px 14px;border:none;border-radius:12px;font-size:0.9rem;box-shadow:0 2px 6px #0003;cursor:pointer;">Publicar</button>
        </div>
        <!-- PUBLICACIONES PERSONALIZADAS -->
        <div id="feedPublicaciones" style="width:100%;max-width:600px;margin:0 auto 32px auto;"></div>
        
        <!-- SECCI√ìN MARKETPLACE -->
        <div id="marketSection" style="display:none;width:100%;max-width:600px;margin:0 auto;"></div>
        
        <!-- SECCI√ìN VIDEOS -->
        <div id="videosSection" style="display:none;width:100vw;height:100vh;position:fixed;top:0;left:0;background:#000;z-index:10000;"></div>
        
        <!-- SECCI√ìN ALERTAS -->
        <div id="alertasSection" style="display:none;width:100%;max-width:600px;margin:0 auto;"></div>
        
        <!-- SECCI√ìN CHAT -->
        <div id="chatSection" style="display:none;width:100%;max-width:600px;margin:0 auto;"></div>
        
        <!-- POSTS DEL FEED ORIGINAL -->

        <!-- NAVEGACI√ìN INFERIOR -->
    <script>
    // Funciones de navegaci√≥n/acciones que deben ejecutarse en JS, aseguramos que est√©n dentro de <script>
    function abrirTransmisionEnVivo() {
        alert('Funci√≥n de transmisi√≥n en vivo pr√≥ximamente.');
        cerrarMenu();
    }
    </script>
    <div class="post" style="width:100%;max-width:1000px;background:rgba(24,24,24,0.99);border:4px solid #FFD700;border-radius:32px;margin-bottom:44px;box-shadow:0 8px 40px #000a;">
            <div class="post-header" style="padding:44px 54px 22px 54px;display:flex;align-items:center;gap:34px;">
                <img src="https://i.imgur.com/placeholder-user.jpg" alt="Usuario" class="avatar-circular">
                <div class="post-user-info">
                    <span class="post-username">Mi Equipo FC</span>
                    <span class="post-location">Madrid, Espa√±a</span>
                </div>
                <i class="fas fa-ellipsis-h post-options"></i>
            </div>
            <div class="post-image" style="height:480px;display:flex;align-items:center;justify-content:center;background:#181818;border-radius:24px;overflow:hidden;">
                <img src="https://i.imgur.com/placeholder-field.jpg" alt="Campo de f√∫tbol">
            </div>
            <div class="post-actions">
                <div class="action-buttons">
                    <i class="fas fa-futbol like-btn" title="Me gusta" onclick="toggleLike(this)"></i>
                    <i class="far fa-comment comment-btn"></i>
                    <i class="far fa-paper-plane share-btn"></i>
                </div>
                <i class="far fa-bookmark save-btn"></i>
            </div>
            <div class="post-info" style="padding:0 54px 38px 54px;">
                <span class="likes" style="font-size:1.6rem;color:#FFD700;font-weight:bold;">156 Me gusta</span>
                <div class="post-description" style="font-size:1.55rem;color:#fff;">
                    <span class="post-username">Mi Equipo FC</span>
                    ¬°Gran entrenamiento hoy! Prepar√°ndonos para el pr√≥ximo torneo üèÜ‚öΩ
                </div>
                <span class="post-time" style="color:#FFD700;font-size:1.2rem;">hace 2 horas</span>
            </div>
        </div>

        <div class="post">
            <div class="post-header">
                <img src="https://i.imgur.com/placeholder-team1.jpg" alt="FC Barcelona" class="avatar-circular">
                <div class="post-user-info">
                    <span class="post-username">FC Barcelona</span>
                    <span class="post-location">Barcelona, Espa√±a</span>
                </div>
                <i class="fas fa-ellipsis-h post-options"></i>
            </div>
            <div class="post-image">
                <img src="https://i.imgur.com/placeholder-celebration.jpg" alt="Celebraci√≥n">
            </div>
            <div class="post-actions">
                <div class="action-buttons">
                    <i class="fas fa-futbol like-btn liked" title="Me gusta" onclick="toggleLike(this)"></i>
                    <i class="far fa-comment comment-btn"></i>
                    <i class="far fa-paper-plane share-btn"></i>
                </div>
                <i class="far fa-bookmark save-btn"></i>
            </div>
            <div class="post-info">
                <span class="likes">2,847 Me gusta</span>
                <div class="post-description">
                    <span class="post-username">FC Barcelona</span>
                    ¬°Otro triunfo en casa! Gracias a todos los aficionados üíô‚ù§Ô∏è
                </div>
                <span class="post-time">hace 4 horas</span>
            </div>
        </div>

        <!-- POST 2 -->
        <div class="post">
            <div class="post-header">
                <div class="post-avatar">AR</div>
                <div class="post-info">
                    <h4>Ana Rodr√≠guez</h4>
                    <p>Mediocampo ‚Ä¢ 4 horas</p>
                </div>
            </div>
            <div class="post-image">
                <i class="fas fa-trophy"></i>
            </div>
            <div class="post-content">
                <p>¬°Campeones de la liga local! üèÜ El trabajo en equipo lo es todo üí™ #Champions #TeamWork</p>
            </div>
            <div class="post-actions">
                <button class="action-btn" onclick="toggleLikeBtn(this)">
                    <i class="fas fa-futbol"></i>
                    <span>45</span>
                </button>
                <button class="action-btn">
                    <i class="fas fa-comment"></i>
                    <span>12</span>
                </button>
                <button class="action-btn">
                    <i class="fas fa-share"></i>
                    <span>7</span>
                </button>
            </div>
        </div>

        <!-- POST 3 -->
        <div class="post">
            <div class="post-header">
                <div class="post-avatar">CL</div>
                <div class="post-info">
                    <h4>Carlos L√≥pez</h4>
                    <p>Portero ‚Ä¢ 6 horas</p>
                </div>
            </div>
            <div class="post-image">
                <i class="fas fa-hand-paper"></i>
            </div>
            <div class="post-content">
                <p>¬°Atajada del partido! Mantenemos la porter√≠a en cero ü•Ö‚úã #Portero #CleanSheet</p>
            </div>
            <div class="post-actions">
                <button class="action-btn" onclick="toggleLikeBtn(this)">
                    <i class="fas fa-futbol"></i>
                    <span>31</span>
                </button>
                <button class="action-btn">
                    <i class="fas fa-comment"></i>
                    <span>6</span>
                </button>
                <button class="action-btn">
                    <i class="fas fa-share"></i>
                    <span>2</span>
                </button>
            </div>
        </div>

        <!-- POST 4 -->
        <div class="post">
            <div class="post-header">
                <div class="post-avatar">MF</div>
                <div class="post-info">
                    <h4>Mar√≠a Fern√°ndez</h4>
                    <p>Defensa ‚Ä¢ 8 horas</p>
                </div>
            </div>
            <div class="post-image">
                <i class="fas fa-running"></i>
            </div>
            <div class="post-content">
                <p>Entrenamiento matutino completado üí™ ¬°Prepar√°ndose para el pr√≥ximo partido! #Training #Motivation</p>
            </div>
            <div class="post-actions">
                <button class="action-btn" onclick="toggleLikeBtn(this)">
                    <i class="fas fa-futbol"></i>
                    <span>18</span>
                </button>
                <button class="action-btn">
                    <i class="fas fa-comment"></i>
                    <span>4</span>
                </button>
                <button class="action-btn">
                    <i class="fas fa-share"></i>
                    <span>1</span>
                </button>
            </div>
        </div>
    </div>

    <!-- BARRA DE NAVEGACI√ìN INFERIOR -->
    <div class="bottom-nav" style="position:fixed;bottom:0;left:0;width:100vw;height:60px;background:#222;display:flex;justify-content:space-around;align-items:center;z-index:10001;box-shadow:0 -2px 12px #000a;">
        <button class="nav-item" id="navHome" onclick="window.location.href='home.html'" style="background:none;border:none;color:#FFD700;font-size:22px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;">
            <i class="fas fa-home"></i>
            <span style="font-size:12px;">Home</span>
        </button>
        <button class="nav-item" id="navMarket" onclick="window.location.href='marketplace.html'" style="background:none;border:none;color:#FFD700;font-size:22px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;">
            <i class="fas fa-store"></i>
            <span style="font-size:12px;">Market</span>
        </button>
        <button class="nav-item" id="navVideos" onclick="window.location.href='videos.html'" style="background:none;border:none;color:#FFD700;font-size:22px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;">
            <i class="fas fa-video"></i>
            <span style="font-size:12px;">Videos</span>
        </button>
        <button class="nav-item" id="navAlertas" onclick="window.location.href='notificaciones.html'" style="background:none;border:none;color:#FFD700;font-size:22px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;">
            <i class="fas fa-bell"></i>
            <span style="font-size:12px;">Alertas</span>
        </button>
        <button class="nav-item" id="navChat" onclick="window.location.href='chat.html'" style="background:none;border:none;color:#FFD700;font-size:22px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;">
            <i class="fas fa-comments"></i>
            <span style="font-size:12px;">Chat</span>
        </button>
    </div>

    <script>
        // --- AMISTOSOS L√ìGICA REAL ---
        function getAmistosos() {
            return JSON.parse(localStorage.getItem('futpro_amistosos')||'[]');
        }
        function saveAmistosos(arr) {
            localStorage.setItem('futpro_amistosos', JSON.stringify(arr));
        }
        function renderAmistosos() {
            const list = document.getElementById('amistosoList');
            if (!list) return;
            list.innerHTML = '';
            const amistosos = getAmistosos();
            amistosos.forEach((a, idx) => {
                const card = document.createElement('div');
                card.className = 'amistoso-card';
                card.style = 'background:#232323;border-radius:12px;padding:18px;width:340px;box-shadow:0 2px 12px #0006;display:flex;flex-direction:column;align-items:center;position:relative;';
                let res = '';
                if (a.resultado) res = `<b style='color:#FFD700;'>${a.resultado[0]}</b> - <b style='color:#FFD700;'>${a.resultado[1]}</b>`;
                card.innerHTML = `
                    <h3 style=\"color:#FFD700;margin:12px 0 4px;\">${a.local} vs ${a.visitante}</h3>
                    <p style=\"color:#aaa;font-size:14px;\">${a.fecha}</p>
                    <p style=\"color:#fff;font-size:15px;margin-bottom:8px;\">${res}</p>
                    <div style=\"display:flex;gap:10px;justify-content:center;margin-top:8px;\">
                        <button class='btn-resultado-amistoso' data-idx='${idx}' style=\"background:#FFD700;color:#181818;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;\">Registrar resultado</button>
                        <button class='btn-eliminar-amistoso' data-idx='${idx}' style=\"background:#c00;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;\">Eliminar</button>
                    </div>
                `;
                list.appendChild(card);
            });
            // Bot√≥n resultado
            list.querySelectorAll('.btn-resultado-amistoso').forEach(btn => {
                btn.onclick = function() {
                    const i = parseInt(this.dataset.idx);
                    const amistosos = getAmistosos();
                    const a = amistosos[i];
                    const g1 = prompt('Goles equipo local:');
                    const g2 = prompt('Goles equipo visitante:');
                    if (g1===null||g2===null||isNaN(g1)||isNaN(g2)) return;
                    
                    // Aqu√≠ se registrar√≠a el resultado del partido
                    const res = `${g1} - ${g2}`;
                    amistosos[i].resultado = res;
                    localStorage.setItem('futpro_amistosos', JSON.stringify(amistosos));
                    renderAmistosos(); // Refrescar la lista
                };
            });
            
            // Bot√≥n eliminar
            list.querySelectorAll('.btn-eliminar-amistoso').forEach(btn => {
                btn.onclick = function() {
                    const i = parseInt(this.dataset.idx);
                    const amistosos = getAmistosos();
                    const a = amistosos[i];
                    const g1 = prompt('Goles equipo local:');
                    const g2 = prompt('Goles equipo visitante:');
                    if (g1===null||g2===null||isNaN(g1)||isNaN(g2)) return;
                    const goles1 = parseInt(g1), goles2 = parseInt(g2);
                    a.resultado = [goles1,goles2];
                    amistosos[i] = a;
                    saveAmistosos(amistosos);
                    // Sumar logros a equipos y jugadores
                    if (goles1>goles2) {
                        sumarLogroJugadoresPorPartido(a.local, 'Victoria Amistoso', 'Amistoso');
                        sumarLogroJugadoresPorPartido(a.visitante, 'Derrota Amistoso', 'Amistoso');
                    } else if (goles1<goles2) {
                        sumarLogroJugadoresPorPartido(a.visitante, 'Victoria Amistoso', 'Amistoso');
                        sumarLogroJugadoresPorPartido(a.local, 'Derrota Amistoso', 'Amistoso');
                    } else {
                        sumarLogroJugadoresPorPartido(a.local, 'Empate Amistoso', 'Amistoso');
                        sumarLogroJugadoresPorPartido(a.visitante, 'Empate Amistoso', 'Amistoso');
                    }
                    renderAmistosos();
                    renderEquipos();
                };
            });
            // Bot√≥n eliminar
            list.querySelectorAll('.btn-eliminar-amistoso').forEach(btn => {
                btn.onclick = function() {
                    if (!confirm('¬øEliminar este amistoso?')) return;
                    const i = parseInt(this.dataset.idx);
                    const amistosos = getAmistosos();
                    amistosos.splice(i,1);
                    saveAmistosos(amistosos);
                    renderAmistosos();
                };
            });
        }
        // Formulario crear amistoso
        const amistosoForm = document.getElementById('amistosoForm');
        if (amistosoForm) {
            // Llenar selects
            const equipos = getEquipos();
            const localSel = document.getElementById('amistosoLocal');
            const visSel = document.getElementById('amistosoVisitante');
            localSel.innerHTML = '<option value="">Equipo local</option>';
            visSel.innerHTML = '<option value="">Equipo visitante</option>';
            equipos.forEach(eq => {
                localSel.innerHTML += `<option value="${eq.nombre}">${eq.nombre}</option>`;
                visSel.innerHTML += `<option value="${eq.nombre}">${eq.nombre}</option>`;
            });
            amistosoForm.onsubmit = function(e) {
                e.preventDefault();
                const local = localSel.value;
                const visitante = visSel.value;
                const fecha = document.getElementById('amistosoFecha').value;
                if (!local || !visitante || local===visitante || !fecha) return alert('Completa todos los campos y elige equipos distintos');
                const amistosos = getAmistosos();
                amistosos.unshift({local, visitante, fecha});
                saveAmistosos(amistosos);
                amistosoForm.reset();
                renderAmistosos();
            };
        }
        // Render inicial amistosos
        renderAmistosos();
        // --- TORNEOS L√ìGICA REAL ---
        function getTorneos() {
            return JSON.parse(localStorage.getItem('futpro_torneos')||'[]');
        }
        function saveTorneos(arr) {
            localStorage.setItem('futpro_torneos', JSON.stringify(arr));
        }
        function renderTorneos() {
            const list = document.getElementById('torneoList');
            if (!list) return;
            list.innerHTML = '';
            let torneos = getTorneos();
            // Filtro/b√∫squeda
            const filtro = (document.getElementById('torneoBuscar')?.value||'').toLowerCase();
            if (filtro) {
                torneos = torneos.filter(t => t.nombre.toLowerCase().includes(filtro) || t.ciudad.toLowerCase().includes(filtro));
            }
            torneos.forEach((t, idx) => {
                const card = document.createElement('div');
                card.className = 'torneo-card';
                card.style = 'background:#232323;border-radius:12px;padding:18px;width:340px;box-shadow:0 2px 12px #0006;display:flex;flex-direction:column;align-items:center;position:relative;';
                card.innerHTML = `
                    <h3 style=\"color:#FFD700;margin:12px 0 4px;\">${t.nombre}</h3>
                    <p style=\"color:#aaa;font-size:14px;\">${t.ciudad} ‚Ä¢ ${t.categoria}</p>
                    <p style=\"color:#fff;font-size:15px;margin-bottom:8px;\">Fecha: ${t.fecha}</p>
                    <div style=\"display:flex;gap:10px;justify-content:center;margin-top:8px;\">
                        <button class='btn-detalles-torneo' data-idx='${idx}' style=\"background:#FFD700;color:#181818;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;\">Detalles</button>
                        <button class='btn-eliminar-torneo' data-idx='${idx}' style=\"background:#c00;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;\">Eliminar</button>
                    </div>
                    <button class='btn-exportar-torneo' data-idx='${idx}' style='margin-top:10px;background:#FFD700;color:#181818;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;'>Exportar CSV</button>
                `;
                list.appendChild(card);
            });
            // Botones Detalles
            list.querySelectorAll('.btn-detalles-torneo').forEach(btn => {
                btn.onclick = function() {
                    const i = parseInt(this.dataset.idx);
                    mostrarDetallesTorneo(i);
                };
            });
            // Botones Eliminar
            list.querySelectorAll('.btn-eliminar-torneo').forEach(btn => {
                btn.onclick = function() {
                    if (!confirm('¬øEliminar este torneo?')) return;
                    const i = parseInt(this.dataset.idx);
                    let torneos = getTorneos();
                    torneos.splice(i,1);
                    saveTorneos(torneos);
                    renderTorneos();
                };
            });
            // Bot√≥n Exportar
            list.querySelectorAll('.btn-exportar-torneo').forEach(btn => {
                btn.onclick = function() {
                    const i = parseInt(this.dataset.idx);
                    exportarTorneoCSV(i);
                };
            });
        }
        // Formulario crear torneo
        const torneoForm = document.getElementById('torneoForm');
        if (torneoForm) {
            torneoForm.onsubmit = function(e) {
                e.preventDefault();
                const nombre = document.getElementById('torneoNombre').value.trim();
                const ciudad = document.getElementById('torneoCiudad').value.trim();
                const fecha = document.getElementById('torneoFecha').value;
                const categoria = document.getElementById('torneoCategoria').value;
                if (!nombre || !ciudad || !fecha || !categoria) return alert('Completa todos los campos');
                const torneos = getTorneos();
                torneos.unshift({nombre, ciudad, fecha, categoria, equipos: []});
                saveTorneos(torneos);
                torneoForm.reset();
                renderTorneos();
            };
        }
        // Filtro/b√∫squeda
        const torneoBuscar = document.getElementById('torneoBuscar');
        if (torneoBuscar) {
            torneoBuscar.oninput = renderTorneos;
        }
        // Modal detalles torneo
        function mostrarDetallesTorneo(idx) {
            // Eliminaci√≥n directa/playoffs
            const elimDiv = document.getElementById('eliminacionTorneo');
            elimDiv.innerHTML = '';
            if (t.eliminacion && t.eliminacion.length) {
                elimDiv.innerHTML = '<b>Playoffs/Eliminaci√≥n directa:</b>';
                t.eliminacion.forEach((ronda, i) => {
                    elimDiv.innerHTML += `<div style='margin:8px 0;'><b>Ronda ${i+1}:</b><ul style='padding-left:18px;'>`+
                        ronda.map((partido, j) => {
                            const res = partido.resultado ? ` <b>${partido.resultado[0]}</b> - <b>${partido.resultado[1]}</b>` : '';
                            return `<li>${partido.local} vs ${partido.visitante}${res} <button class='btn-resultado-elim' data-r='${i}' data-p='${j}' style='margin-left:8px;background:#FFD700;color:#181818;border:none;padding:2px 8px;border-radius:5px;cursor:pointer;font-size:12px;'>Resultado</button></li>`;
                        }).join('') + '</ul></div>';
                });
            }
            document.getElementById('generarEliminacionBtn').onclick = function() {
                if ((t.equipos||[]).length<2) return alert('Agrega al menos 2 equipos');
                t.eliminacion = generarEliminacion(t.equipos);
                const torneos = getTorneos();
                torneos[idx] = t;
                saveTorneos(torneos);
                mostrarDetallesTorneo(idx);
            };
            // Botones resultado eliminaci√≥n
            elimDiv.querySelectorAll('.btn-resultado-elim').forEach(btn => {
                btn.onclick = function() {
                    const r = parseInt(this.dataset.r), p = parseInt(this.dataset.p);
                    const g1 = prompt('Goles equipo local:');
                    const g2 = prompt('Goles equipo visitante:');
                    if (g1===null||g2===null||isNaN(g1)||isNaN(g2)) return;
                    const goles1 = parseInt(g1), goles2 = parseInt(g2);
                    t.eliminacion[r][p].resultado = [goles1,goles2];
                    // Sumar logros a jugadores
                    if (goles1>goles2) {
                        sumarLogroJugadoresPorPartido(t.eliminacion[r][p].local, 'Victoria', t.nombre);
                        sumarLogroJugadoresPorPartido(t.eliminacion[r][p].visitante, 'Derrota', t.nombre);
                    } else if (goles1<goles2) {
                        sumarLogroJugadoresPorPartido(t.eliminacion[r][p].visitante, 'Victoria', t.nombre);
                        sumarLogroJugadoresPorPartido(t.eliminacion[r][p].local, 'Derrota', t.nombre);
                    } else {
                        sumarLogroJugadoresPorPartido(t.eliminacion[r][p].local, 'Empate', t.nombre);
                        sumarLogroJugadoresPorPartido(t.eliminacion[r][p].visitante, 'Empate', t.nombre);
                    }
                    // Avanzar ganador
                    if (!t.eliminacion[r+1]) t.eliminacion[r+1]=[];
                    const ganador = goles1>goles2 ? t.eliminacion[r][p].local : t.eliminacion[r][p].visitante;
                    if (t.eliminacion[r+1].length < t.eliminacion[r].length/2) {
                        t.eliminacion[r+1].push({local: ganador, visitante: null});
                    }
                    // Si ya hay dos en la siguiente ronda, emparejar
                    if (t.eliminacion[r+1].length%2===0 && t.eliminacion[r+1].length>0) {
                        for(let i=0;i<t.eliminacion[r+1].length;i+=2){
                            if(t.eliminacion[r+1][i].visitante===null && t.eliminacion[r+1][i+1]){
                                t.eliminacion[r+1][i].visitante = t.eliminacion[r+1][i+1].local;
                                t.eliminacion[r+1].splice(i+1,1);
                            }
                        }
                    }
                    // Si hay campe√≥n
                    if (t.eliminacion[r+1].length===1 && t.eliminacion[r+1][0].visitante===null) {
                        t.campeon = t.eliminacion[r+1][0].local;
                        sumarLogroEquipo(t.campeon, t.nombre);
                    }
                    const torneos = getTorneos();
                    torneos[idx] = t;
                    saveTorneos(torneos);
                    mostrarDetallesTorneo(idx);
                };
            });
        // Generar eliminaci√≥n directa (playoffs)
        function generarEliminacion(equipos) {
            let eqs = [...equipos];
            if (eqs.length%2!==0) eqs.push('Libre');
            let rondas = Math.ceil(Math.log2(eqs.length));
            let actual = eqs;
            let eliminacion = [];
            for(let r=0;r<rondas;r++){
                let ronda = [];
                for(let i=0;i<actual.length;i+=2){
                    if(actual[i]!=='Libre'&&actual[i+1]!=='Libre')
                        ronda.push({local:actual[i],visitante:actual[i+1]});
                }
                eliminacion.push(ronda);
                // Avanzan ganadores
                actual = ronda.map(()=>null); // se llenar√° al ingresar resultados
            }
            return eliminacion;
        }
        // Sumar logro a equipo (card resumen)
        function sumarLogroEquipo(nombreEquipo, torneo) {
            let equipos = getEquipos();
            const idx = equipos.findIndex(eq=>eq.nombre===nombreEquipo);
            if(idx!==-1){
                equipos[idx].logros = equipos[idx].logros||[];
                equipos[idx].logros.push({torneo, fecha: new Date().toLocaleDateString()});
                saveEquipos(equipos);
            }
            renderEquipos();
        }
            const modal = document.getElementById('modalTorneo');
            const detallesDiv = document.getElementById('detallesTorneo');
            const torneos = getTorneos();
            const t = torneos[idx];
            if (!modal || !detallesDiv) return;
            modal.style.display = 'flex';
            detallesDiv.innerHTML = `<b>Nombre:</b> ${t.nombre}<br><b>Ciudad:</b> ${t.ciudad}<br><b>Fecha:</b> ${t.fecha}<br><b>Categor√≠a:</b> ${t.categoria}<br><b>Equipos participantes:</b> <ul style='padding-left:18px;'>`+
                (t.equipos||[]).map(e=>`<li>${e}</li>`).join('')+'</ul>';
            // Fixture y fases
            const fixtureDiv = document.getElementById('fixtureTorneo');
            const tablaDiv = document.getElementById('tablaPosiciones');
            fixtureDiv.innerHTML = '';
            tablaDiv.innerHTML = '';
            // Mostrar fixture si existe
            if (t.fixture && t.fixture.length) {
                fixtureDiv.innerHTML = '<b>Fixture:</b>';
                t.fixture.forEach((fecha, i) => {
                    fixtureDiv.innerHTML += `<div style='margin:8px 0;'><b>Fecha ${i+1}:</b><ul style='padding-left:18px;'>`+
                        fecha.map((partido, j) => {
                            const res = partido.resultado ? ` <b>${partido.resultado[0]}</b> - <b>${partido.resultado[1]}</b>` : '';
                            return `<li>${partido.local} vs ${partido.visitante}${res} <button class='btn-resultado' data-f='${i}' data-p='${j}' style='margin-left:8px;background:#FFD700;color:#181818;border:none;padding:2px 8px;border-radius:5px;cursor:pointer;font-size:12px;'>Resultado</button></li>`;
                        }).join('') + '</ul></div>';
                });
            }
            // Mostrar tabla de posiciones si hay resultados
            if (t.tabla && t.tabla.length) {
                tablaDiv.innerHTML = '<b>Tabla de posiciones:</b>';
                tablaDiv.innerHTML += `<table style='width:100%;margin-top:8px;background:#181818;border-radius:8px;'><tr style='color:#FFD700;'><th>Equipo</th><th>Pts</th><th>GF</th><th>GC</th><th>Dif</th></tr>`+
                    t.tabla.map(e=>`<tr><td>${e.nombre}</td><td>${e.puntos}</td><td>${e.gf}</td><td>${e.gc}</td><td>${e.gf-e.gc}</td></tr>`).join('')+'</table>';
            }
            // Bot√≥n generar fixture
            document.getElementById('generarFixtureBtn').onclick = function() {
                if ((t.equipos||[]).length<2) return alert('Agrega al menos 2 equipos');
                t.fixture = generarFixture(t.equipos);
                t.tabla = t.equipos.map(eq=>({nombre:eq,puntos:0,gf:0,gc:0}));
                const torneos = getTorneos();
                torneos[idx] = t;
                saveTorneos(torneos);
                mostrarDetallesTorneo(idx);
            };
            // Botones resultado
            fixtureDiv.querySelectorAll('.btn-resultado').forEach(btn => {
                btn.onclick = function() {
                    const f = parseInt(this.dataset.f), p = parseInt(this.dataset.p);
                    const g1 = prompt('Goles equipo local:');
                    const g2 = prompt('Goles equipo visitante:');
                    if (g1===null||g2===null||isNaN(g1)||isNaN(g2)) return;
                    const goles1 = parseInt(g1), goles2 = parseInt(g2);
                    t.fixture[f][p].resultado = [goles1,goles2];
                    // Sumar logros a jugadores
                    if (goles1>goles2) {
                        sumarLogroJugadoresPorPartido(t.fixture[f][p].local, 'Victoria', t.nombre);
                        sumarLogroJugadoresPorPartido(t.fixture[f][p].visitante, 'Derrota', t.nombre);
                    } else if (goles1<goles2) {
                        sumarLogroJugadoresPorPartido(t.fixture[f][p].visitante, 'Victoria', t.nombre);
                        sumarLogroJugadoresPorPartido(t.fixture[f][p].local, 'Derrota', t.nombre);
                    } else {
                        sumarLogroJugadoresPorPartido(t.fixture[f][p].local, 'Empate', t.nombre);
                        sumarLogroJugadoresPorPartido(t.fixture[f][p].visitante, 'Empate', t.nombre);
                    }
                    // Actualizar tabla
                    t.tabla = calcularTabla(t.equipos, t.fixture);
                    const torneos = getTorneos();
                    torneos[idx] = t;
                    saveTorneos(torneos);
                    mostrarDetallesTorneo(idx);
                };
            });
        function sumarLogroJugadoresPorPartido(nombreEquipo, tipoLogro, torneo) {
            let equipos = getEquipos();
            const idx = equipos.findIndex(eq=>eq.nombre===nombreEquipo);
            if(idx!==-1 && equipos[idx].plantilla) {
                equipos[idx].plantilla.forEach(m => {
                    if (m.tipo==='jugador') {
                        m.logros = m.logros||[];
                        m.logros.push({torneo, tipo:tipoLogro, fecha: new Date().toLocaleDateString()});
                    }
                });
                saveEquipos(equipos);
            }
        }
        // Generar fixture round-robin simple
        function generarFixture(equipos) {
            let eqs = [...equipos];
            if (eqs.length%2!==0) eqs.push('Libre');
            const n = eqs.length;
            const rondas = n-1;
            const partidosPorFecha = n/2;
            let fixture = [];
            for(let r=0;r<rondas;r++){
                let fecha = [];
                for(let p=0;p<partidosPorFecha;p++){
                    const local = eqs[p];
                    const visitante = eqs[n-1-p];
                    if(local!=='Libre'&&visitante!=='Libre')
                        fecha.push({local,visitante});
                }
                fixture.push(fecha);
                eqs.splice(1,0,eqs.pop());
            }
            return fixture;
        }
        // Calcular tabla de posiciones
        function calcularTabla(equipos, fixture) {
            let tabla = equipos.map(e=>({nombre:e,puntos:0,gf:0,gc:0}));
            fixture.forEach(fecha=>{
                fecha.forEach(partido=>{
                    if(!partido.resultado) return;
                    const i1 = tabla.findIndex(e=>e.nombre===partido.local);
                    const i2 = tabla.findIndex(e=>e.nombre===partido.visitante);
                    const g1 = partido.resultado[0], g2 = partido.resultado[1];
                    tabla[i1].gf += g1; tabla[i1].gc += g2;
                    tabla[i2].gf += g2; tabla[i2].gc += g1;
                    if(g1>g2){ tabla[i1].puntos+=3; }
                    else if(g1<g2){ tabla[i2].puntos+=3; }
                    else { tabla[i1].puntos+=1; tabla[i2].puntos+=1; }
                });
            });
            tabla.sort((a,b)=>b.puntos-b.puntos||(b.gf-b.gc)-(a.gf-a.gc));
            return tabla;
        }
            // Llenar select de equipos
            const select = document.getElementById('equipoTorneo');
            select.innerHTML = '<option value="">Selecciona equipo</option>';
            getEquipos().forEach(eq => {
                if (!t.equipos.includes(eq.nombre)) {
                    select.innerHTML += `<option value="${eq.nombre}">${eq.nombre}</option>`;
                }
            });
            // Agregar equipo participante
            document.getElementById('agregarEquipoTorneoForm').onsubmit = function(e) {
                e.preventDefault();
                const eqNombre = select.value;
                if (!eqNombre) return;
                t.equipos.push(eqNombre);
                torneos[idx] = t;
                saveTorneos(torneos);
                mostrarDetallesTorneo(idx);
            };
        }
        document.getElementById('cerrarTorneo').onclick = function() {
            document.getElementById('modalTorneo').style.display = 'none';
        };
        // Exportar torneo CSV
        function exportarTorneoCSV(idx) {
            const torneos = getTorneos();
            const t = torneos[idx];
            let csv = `Torneo,${t.nombre}\nCiudad,${t.ciudad}\nFecha,${t.fecha}\nCategoria,${t.categoria}\n\nEquipos participantes:\n`;
            (t.equipos||[]).forEach(e => {
                csv += `${e}\n`;
            });
            const blob = new Blob([csv], {type:'text/csv'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `torneo_${t.nombre.replace(/\s+/g,'_')}.csv`;
            a.click();
        }
        // Render inicial torneos
        renderTorneos();
        // --- EQUIPOS L√ìGICA REAL ---
        function getEquipos() {
            return JSON.parse(localStorage.getItem('futpro_equipos')||'[]');
        }
        function saveEquipos(arr) {
            localStorage.setItem('futpro_equipos', JSON.stringify(arr));
        }
        function renderEquipos() {
            const list = document.getElementById('equipoList');
            if (!list) return;
            list.innerHTML = '';
            let equipos = getEquipos();
            // Filtro/b√∫squeda
            const filtro = (document.getElementById('equipoBuscar')?.value||'').toLowerCase();
            if (filtro) {
                equipos = equipos.filter(eq => eq.nombre.toLowerCase().includes(filtro) || eq.ciudad.toLowerCase().includes(filtro));
            }
            equipos.forEach((eq, idx) => {
                const card = document.createElement('div');
                card.className = 'equipo-card';
                card.style = 'background:#232323;border-radius:12px;padding:18px;width:340px;box-shadow:0 2px 12px #0006;display:flex;flex-direction:column;align-items:center;position:relative;';
                // Logo personalizado o generado
                let logoHtml = '';
                if (eq.logo) {
                    logoHtml = `<img src="${eq.logo}" alt="logo" style="width:64px;height:64px;border-radius:50%;object-fit:cover;margin-bottom:8px;box-shadow:0 2px 8px #0004;">`;
                } else {
                    const iniciales = eq.nombre.split(' ').map(w=>w[0]).join('').substring(0,3).toUpperCase();
                    logoHtml = `<div style=\"width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#FFD700,#181818 80%);display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:bold;color:#181818;box-shadow:0 2px 8px #0004;margin-bottom:8px;user-select:none;\">${iniciales}</div>`;
                }
                // Card resumen de logros
                let logrosHtml = '';
                if (eq.logros && eq.logros.length) {
                    logrosHtml = `<div style='margin:8px 0 0 0;'><b>üèÜ Logros:</b><ul style='padding-left:18px;'>`+
                        eq.logros.map(l=>`<li>${l.torneo} <span style='color:#FFD700'>(${l.fecha})</span></li>`).join('')+'</ul></div>';
                }
                card.innerHTML = `
                    ${logoHtml}
                    <h3 style=\"color:#FFD700;margin:12px 0 4px;\">${eq.nombre}</h3>
                    <p style=\"color:#aaa;font-size:14px;\">${eq.ciudad} ‚Ä¢ ${eq.categoria}</p>
                    <p style=\"color:#fff;font-size:15px;margin-bottom:8px;\">Jugadores: ${eq.jugadores||0} ‚Ä¢ Staff: ${eq.staff||0}</p>
                    <div style=\"display:flex;gap:10px;justify-content:center;margin-top:8px;\">
                        <button class='btn-plantilla' data-idx='${idx}' style=\"background:#FFD700;color:#181818;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;\">Plantilla</button>
                        <button class='btn-detalles' data-idx='${idx}' style=\"background:#FFD700;color:#181818;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;\">Detalles</button>
                        <button class='btn-editar' data-idx='${idx}' style=\"background:#222;color:#FFD700;border:1px solid #FFD700;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;\">Editar</button>
                        <button class='btn-eliminar' data-idx='${idx}' style=\"background:#c00;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;\">Eliminar</button>
                    </div>
                    <div class='detalles-equipo' id='detalles-${idx}' style='display:none;margin-top:10px;background:#181818;padding:10px 12px;border-radius:8px;color:#fff;font-size:14px;'></div>
                    <button class='btn-exportar' data-idx='${idx}' style='margin-top:10px;background:#FFD700;color:#181818;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;'>Exportar PDF/CSV</button>
                    ${logrosHtml}
                `;
                list.appendChild(card);
            });
            // Bot√≥n Plantilla
            list.querySelectorAll('.btn-plantilla').forEach(btn => {
                btn.onclick = function() {
                    const i = parseInt(this.dataset.idx);
                    mostrarPlantilla(i);
                };
            });
            // Botones Detalles
            list.querySelectorAll('.btn-detalles').forEach(btn => {
                btn.onclick = function() {
                    const i = parseInt(this.dataset.idx);
                    const detalles = list.querySelector(`#detalles-${i}`);
                    if (!detalles) return;
                    if (detalles.style.display === 'none') {
                        const eq = equipos[i];
                        detalles.innerHTML = `<b>Equipo:</b> ${eq.nombre}<br><b>Ciudad:</b> ${eq.ciudad}<br><b>Categor√≠a:</b> ${eq.categoria}<br><b>Jugadores:</b> ${eq.jugadores||0}<br><b>Staff:</b> ${eq.staff||0}`;
                        detalles.style.display = 'block';
                    } else {
                        detalles.style.display = 'none';
                    }
                };
            });
            // Botones Eliminar
            list.querySelectorAll('.btn-eliminar').forEach(btn => {
                btn.onclick = function() {
                    if (!confirm('¬øEliminar este equipo?')) return;
                    const i = parseInt(this.dataset.idx);
                    equipos.splice(i,1);
                    saveEquipos(equipos);
                    renderEquipos();
                };
            });
            // Botones Editar
            list.querySelectorAll('.btn-editar').forEach(btn => {
                btn.onclick = function() {
                    const i = parseInt(this.dataset.idx);
                    const eq = equipos[i];
                    document.getElementById('equipoNombre').value = eq.nombre;
                    document.getElementById('equipoCiudad').value = eq.ciudad;
                    document.getElementById('equipoCategoria').value = eq.categoria;
                    document.getElementById('equipoJugadores').value = eq.jugadores||0;
                    document.getElementById('equipoStaff').value = eq.staff||0;
                    // Eliminar el equipo viejo
                    equipos.splice(i,1);
                    saveEquipos(equipos);
                    renderEquipos();
                };
            });
            // Bot√≥n Exportar
            list.querySelectorAll('.btn-exportar').forEach(btn => {
                btn.onclick = function() {
                    const i = parseInt(this.dataset.idx);
                    exportarEquipo(i);
                };
            });
        }
        const equipoForm = document.getElementById('equipoForm');
        if (equipoForm) {
            equipoForm.onsubmit = function(e) {
                e.preventDefault();
                const nombre = document.getElementById('equipoNombre').value.trim();
                const ciudad = document.getElementById('equipoCiudad').value.trim();
                const categoria = document.getElementById('equipoCategoria').value;
                const jugadores = parseInt(document.getElementById('equipoJugadores').value);
                const staff = parseInt(document.getElementById('equipoStaff').value);
                if (!nombre || !ciudad || !categoria) return alert('Completa todos los campos');
                if (jugadores < 12 || jugadores > 23) return alert('Jugadores debe ser entre 12 y 23');
                if (staff < 0 || staff > 5) return alert('Staff debe ser entre 0 y 5');
                const equipos = getEquipos();
                equipos.unshift({nombre, ciudad, categoria, jugadores, staff});
                saveEquipos(equipos);
                equipoForm.reset();
                renderEquipos();
            };
        }
        // Render inicial equipos
        renderEquipos();
        // --- MARKETPLACE L√ìGICA REAL ---
        function getMarketProducts() {
            return JSON.parse(localStorage.getItem('futpro_market')||'[]');
        }
        function saveMarketProducts(arr) {
            localStorage.setItem('futpro_market', JSON.stringify(arr));
        }
        function renderMarket() {
            const list = document.getElementById('marketList');
            if (!list) return;
            list.innerHTML = '';
            const productos = getMarketProducts();
            productos.forEach((prod, idx) => {
                const card = document.createElement('div');
                card.className = 'market-card';
                card.style = 'background:#232323;border-radius:12px;padding:18px;width:320px;box-shadow:0 2px 12px #0006;display:flex;flex-direction:column;align-items:center;';
                card.innerHTML = `
                    <img src="${prod.img||'https://cdn-icons-png.flaticon.com/512/833/833314.png'}" alt="${prod.title}" style="width:100%;border-radius:8px;object-fit:cover;max-height:160px;">
                    <h3 style="color:#FFD700;margin:12px 0 4px;">${prod.title}</h3>
                    <p style="color:#aaa;font-size:14px;">${prod.extra||''}</p>
                    <p style="color:#fff;font-size:15px;margin-bottom:8px;">${prod.desc}</p>
                    <div style="display:flex;align-items:center;gap:12px;margin-top:10px;">
                        <button class="market-like-btn" data-idx="${idx}" style="background:none;border:none;cursor:pointer;font-size:22px;">
                            <i class="fas fa-futbol"></i> <span>${prod.likes||0}</span>
                        </button>
                        <button class="market-comment-btn" data-idx="${idx}" style="background:none;border:none;cursor:pointer;font-size:20px;color:#FFD700;">
                            <i class="fas fa-comment"></i>
                        </button>
                        <button class="market-share-btn" data-idx="${idx}" style="background:none;border:none;cursor:pointer;font-size:20px;color:#FFD700;">
                            <i class="fas fa-share"></i>
                        </button>
                    </div>
                `;
                list.appendChild(card);
            });
            // L√≥gica de botones
            document.querySelectorAll('.market-like-btn').forEach(btn => {
                btn.onclick = function() {
                    const idx = parseInt(this.dataset.idx);
                    const productos = getMarketProducts();
                    productos[idx].likes = (productos[idx].likes||0) + 1;
                    saveMarketProducts(productos);
                    renderMarket();
                };
            });
            document.querySelectorAll('.market-comment-btn').forEach(btn => {
                btn.onclick = function() {
                    alert('üí¨ Comentarios de producto - Pr√≥ximamente');
                };
            });
            document.querySelectorAll('.market-share-btn').forEach(btn => {
                btn.onclick = function() {
                    alert('üì§ Compartir producto - Pr√≥ximamente');
                };
            });
        }
        const marketForm = document.getElementById('marketForm');
        if (equipoForm) {
            equipoForm.onsubmit = async function(e) {
                e.preventDefault();
                const nombre = document.getElementById('equipoNombre').value.trim();
                const ciudad = document.getElementById('equipoCiudad').value.trim();
                const categoria = document.getElementById('equipoCategoria').value;
                const jugadores = parseInt(document.getElementById('equipoJugadores').value);
                const staff = parseInt(document.getElementById('equipoStaff').value);
                let logo = '';
                const logoInput = document.getElementById('equipoLogo');
                if (logoInput && logoInput.files && logoInput.files[0]) {
                    logo = await fileToBase64(logoInput.files[0]);
                }
                if (!nombre || !ciudad || !categoria) return alert('Completa todos los campos');
                if (jugadores < 12 || jugadores > 23) return alert('Jugadores debe ser entre 12 y 23');
                if (staff < 0 || staff > 5) return alert('Staff debe ser entre 0 y 5');
                const equipos = getEquipos();
                equipos.unshift({nombre, ciudad, categoria, jugadores, staff, logo, plantilla: []});
                saveEquipos(equipos);
                equipoForm.reset();
                renderEquipos();
            };
        }
        // Filtro/b√∫squeda
        const equipoBuscar = document.getElementById('equipoBuscar');
        if (equipoBuscar) {
            equipoBuscar.oninput = renderEquipos;
        }
        // Utilidad para convertir archivo a base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        // PLANTILLA COMPLETA
        function mostrarPlantilla(idx) {
            // Mostrar logros de cada jugador
            // ...
            // (despu√©s de mostrar la lista de jugadores)
            // Si hay logros, mostrarlos
            const equipos = getEquipos();
            const eq = equipos[idx];
            if (eq.plantilla) {
                document.querySelectorAll('#jugadoresLista li').forEach((li, i) => {
                    const m = eq.plantilla.filter(j=>j.tipo==='jugador')[i];
                    if (m && m.logros && m.logros.length) {
                        li.innerHTML += `<ul style='margin-left:10px;font-size:12px;color:#FFD700;'>`+
                            m.logros.map(l=>`<li>${l.tipo} - ${l.torneo} (${l.fecha})</li>`).join('')+'</ul>';
                    }
                });
            }
            const modal = document.getElementById('modalPlantilla');
            const plantillaDiv = document.getElementById('plantillaEquipo');
            if (!modal || !plantillaDiv) return;
            modal.style.display = 'flex';
            plantillaDiv.innerHTML = '';
            // Jugadores
            const jugadores = (eq.plantilla||[]).filter(m=>m.tipo==='jugador');
            const staff = (eq.plantilla||[]).filter(m=>m.tipo==='staff');
            plantillaDiv.innerHTML += `<b>Jugadores (${jugadores.length}):</b><ul style='padding-left:18px;'>` +
                jugadores.map(j=>`<li><img src='${j.avatar||''}' style='width:24px;height:24px;border-radius:50%;object-fit:cover;vertical-align:middle;margin-right:6px;'> <b>${j.nombre}</b> (${j.posicion}) ${j.rol?'<span style=\'color:#FFD700\'>['+j.rol+']</span>':''}</li>`).join('') + '</ul>';
            plantillaDiv.innerHTML += `<b>Staff (${staff.length}):</b><ul style='padding-left:18px;'>` +
                staff.map(s=>`<li><img src='${s.avatar||''}' style='width:24px;height:24px;border-radius:50%;object-fit:cover;vertical-align:middle;margin-right:6px;'> <b>${s.nombre}</b> (${s.posicion}) ${s.rol?'<span style=\'color:#FFD700\'>['+s.rol+']</span>':''}</li>`).join('') + '</ul>';
            // Bot√≥n para exportar plantilla
            plantillaDiv.innerHTML += `<button id='exportarPlantillaBtn' style='margin-top:10px;background:#FFD700;color:#181818;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;'>Exportar Plantilla CSV</button>`;
            // Asignar roles
            plantillaDiv.innerHTML += `<hr><b>Asignar rol:</b> <select id='rolPlantilla'><option value=''>Selecciona miembro</option>`+
                (eq.plantilla||[]).map((m,i)=>`<option value='${i}'>${m.nombre} (${m.tipo})</option>`).join('')+`</select> <input id='rolNuevo' placeholder='Ej: Capit√°n, DT' style='width:90px;'> <button id='btnAsignarRol' style='background:#FFD700;color:#181818;border:none;padding:2px 8px;border-radius:5px;cursor:pointer;font-size:12px;'>Asignar</button>`;
            // Eliminar miembro
            plantillaDiv.innerHTML += `<br><b>Eliminar miembro:</b> <select id='eliminarMiembro'><option value=''>Selecciona</option>`+
                (eq.plantilla||[]).map((m,i)=>`<option value='${i}'>${m.nombre} (${m.tipo})</option>`).join('')+`</select> <button id='btnEliminarMiembro' style='background:#c00;color:#fff;border:none;padding:2px 8px;border-radius:5px;cursor:pointer;font-size:12px;'>Eliminar</button>`;
            // Exportar plantilla CSV
            document.getElementById('exportarPlantillaBtn').onclick = function() {
                exportarPlantillaCSV(eq);
            };
            // Asignar rol
            document.getElementById('btnAsignarRol').onclick = function() {
                const idxMiembro = document.getElementById('rolPlantilla').value;
                const rol = document.getElementById('rolNuevo').value.trim();
                if (rol && idxMiembro!=='') {
                    plantillaDiv.innerHTML = '';
                    // Jugadores
                    const jugadores = (eq.plantilla||[]).filter(m=>m.tipo==='jugador');
                    const staff = (eq.plantilla||[]).filter(m=>m.tipo==='staff');
                    plantillaDiv.innerHTML += `<b>Jugadores <span class='contador-badge'>${jugadores.length}</span>:</b><ul class='plantilla-lista' id='jugadoresLista' style='padding-left:18px;'>` +
                        jugadores.map((j,i)=>`<li draggable='true' data-idx='${i}' class='fade-in'><img src='${j.avatar||''}' class='avatar-circular'> <b>${j.nombre}</b> (${j.posicion})${j.rol?'<span class=\'badge-rol\'>'+j.rol+'</span>':''}</li>`).join('') + '</ul>';
                    plantillaDiv.innerHTML += `<b>Staff <span class='contador-badge'>${staff.length}</span>:</b><ul class='plantilla-lista' id='staffLista' style='padding-left:18px;'>` +
                        staff.map((s,i)=>`<li draggable='true' data-idx='${i}' class='fade-in'><img src='${s.avatar||''}' class='avatar-circular'> <b>${s.nombre}</b> (${s.posicion})${s.rol?'<span class=\'badge-rol\'>'+s.rol+'</span>':''}</li>`).join('') + '</ul>';
                    // Bot√≥n para exportar plantilla y copiar
                    plantillaDiv.innerHTML += `<button id='exportarPlantillaBtn' style='margin-top:10px;background:#FFD700;color:#181818;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;'>Exportar Plantilla CSV</button> <button id='copiarPlantillaBtn' style='margin-top:10px;background:#FFD700;color:#181818;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:13px;'>Copiar Plantilla</button>`;
                    // Asignar roles
                    plantillaDiv.innerHTML += `<hr><b>Asignar rol:</b> <select id='rolPlantilla'><option value=''>Selecciona miembro</option>`+
                        (eq.plantilla||[]).map((m,i)=>`<option value='${i}'>${m.nombre} (${m.tipo})</option>`).join('')+`</select> <input id='rolNuevo' placeholder='Ej: Capit√°n, DT' style='width:90px;'> <button id='btnAsignarRol' style='background:#FFD700;color:#181818;border:none;padding:2px 8px;border-radius:5px;cursor:pointer;font-size:12px;'>Asignar</button>`;
                    // Eliminar miembro
                    plantillaDiv.innerHTML += `<br><b>Eliminar miembro:</b> <select id='eliminarMiembro'><option value=''>Selecciona</option>`+
                        (eq.plantilla||[]).map((m,i)=>`<option value='${i}'>${m.nombre} (${m.tipo})</option>`).join('')+`</select> <button id='btnEliminarMiembro' style='background:#c00;color:#fff;border:none;padding:2px 8px;border-radius:5px;cursor:pointer;font-size:12px;'>Eliminar</button>`;
                    // Exportar plantilla CSV
                    document.getElementById('exportarPlantillaBtn').onclick = function() {
                        exportarPlantillaCSV(eq);
                    };
                    // Copiar plantilla al portapapeles
                    document.getElementById('copiarPlantillaBtn').onclick = function() {
                        let txt = 'Jugadores:\n';
                        jugadores.forEach(j=>{txt+=`- ${j.nombre} (${j.posicion})${j.rol?' ['+j.rol+']':''}\n`;});
                        txt += '\nStaff:\n';
                        staff.forEach(s=>{txt+=`- ${s.nombre} (${s.posicion})${s.rol?' ['+s.rol+']':''}\n`;});
                        navigator.clipboard.writeText(txt);
                        this.textContent = '¬°Copiado!';
                        this.style.background = '#4caf50';
                        setTimeout(()=>{this.textContent='Copiar Plantilla';this.style.background='#FFD700';},1200);
                    };
                    // Asignar rol
                    document.getElementById('btnAsignarRol').onclick = function() {
                        const idxMiembro = document.getElementById('rolPlantilla').value;
                        const rol = document.getElementById('rolNuevo').value.trim();
                        if (rol && idxMiembro!=='') {
                            eq.plantilla[idxMiembro].rol = rol;
                            equipos[idx] = eq;
                            saveEquipos(equipos);
                            mostrarPlantilla(idx);
                        }
                    };
                    // Eliminar miembro
                    document.getElementById('btnEliminarMiembro').onclick = function() {
                        const idxMiembro = document.getElementById('eliminarMiembro').value;
                        if (idxMiembro!=='') {
                            eq.plantilla.splice(idxMiembro,1);
                            equipos[idx] = eq;
                            saveEquipos(equipos);
                            mostrarPlantilla(idx);
                        }
                    };
                    // Drag & Drop para reordenar jugadores
                    const ulJug = document.getElementById('jugadoresLista');
                    if (ulJug) dragAndDropLista(ulJug, eq, idx, 'jugador');
                    const ulStaff = document.getElementById('staffLista');
                    if (ulStaff) dragAndDropLista(ulStaff, eq, idx, 'staff');
            let csv = `Equipo,${eq.nombre}\nCiudad,${eq.ciudad}\nCategoria,${eq.categoria}\nJugadores,${eq.jugadores||0}\nStaff,${eq.staff||0}\n\nPlantilla:\nTipo,Nombre,Posici√≥n,Rol\n`;
            (eq.plantilla||[]).forEach(m => {
                csv += `${m.tipo},${m.nombre},${m.posicion},${m.rol||''}\n`;
            });
            const blob = new Blob([csv], {type:'text/csv'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `equipo_${eq.nombre.replace(/\s+/g,'_')}.csv`;
            a.click();
        }
        // Exportar plantilla CSV
        function exportarPlantillaCSV(eq) {
            let csv = `Tipo,Nombre,Posici√≥n,Rol\n`;
            (eq.plantilla||[]).forEach(m => {
                csv += `${m.tipo},${m.nombre},${m.posicion},${m.rol||''}\n`;
            });
            const blob = new Blob([csv], {type:'text/csv'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `plantilla_${eq.nombre.replace(/\s+/g,'_')}.csv`;
            a.click();
        }
        // Render inicial equipos
        document.querySelectorAll('.market-like-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const icon = this.querySelector('i');
                if (icon.style.color === 'gold') {
                    icon.style.color = '';
                    const count = parseInt(this.querySelector('span').textContent);
                    this.querySelector('span').textContent = count - 1;
                } else {
                    icon.style.color = 'gold';
                    const count = parseInt(this.querySelector('span').textContent);
                    this.querySelector('span').textContent = count + 1;
                }
            });
        });
        document.querySelectorAll('.market-comment-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                alert('üí¨ Comentarios de producto - Pr√≥ximamente');
            });
        });
        document.querySelectorAll('.market-share-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                alert('üì§ Compartir producto - Pr√≥ximamente');
            });
        });
        function verEstados() {
            window.location.href = './estados.html';
        }
        function verEnVivo() {
            window.location.href = './videos.html';
        }
        function verTorneos() {
            window.location.href = './torneo.html';
        }
        function verEquipos() {
            window.location.href = './equipos.html';
        }
        function crearTorneo() {
            window.location.href = './torneo.html#crear';
        }
        function crearEquipo() {
            window.location.href = './equipos.html#crear';
        }
        function crearAmistoso() {
            window.location.href = './amistoso.html';
        }
        // L√≥gica para asignar Card al iniciar sesi√≥n
        function asignarCardAlIniciarSesion() {
            const userData = localStorage.getItem('futpro_usuario');
            if (userData) {
                const user = JSON.parse(userData);
                // Simulaci√≥n: asignar card seg√∫n nivel
                let card = 'Bronce';
                if (user.nivel === 'avanzado') card = 'Oro';
                if (user.nivel === 'intermedio') card = 'Plata';
                localStorage.setItem('futpro_card', card);
                // Mostrar card en el men√∫
                document.getElementById('profilePosition').textContent += ` ‚Ä¢ Card: ${card}`;
            }
        }

        // Funci√≥n Jugar Penaltis
        function jugarPenaltis() {
            window.location.href = './penaltis.html';
        }

        // Funci√≥n Crear Juego
        function crearJuego() {
            window.location.href = './juegos.html';
        }

        // Funci√≥n Ranking Equipos
        function verRankingEquipos() {
            window.location.href = './ranking.html#equipos';
        }

        // Funci√≥n Ranking Partidos
        function verRankingPartidos() {
            window.location.href = './ranking.html#partidos';
        }

        // CARGAR PERFIL DEL USUARIO REGISTRADO
        function loadUserProfile() {
            const userData = localStorage.getItem('futpro_usuario');
            if (userData) {
                const user = JSON.parse(userData);
                
                // Actualizar informaci√≥n del perfil en el men√∫
                document.getElementById('profileName').textContent = `${user.nombre} ${user.apellido}`;
                document.getElementById('profilePosition').textContent = user.posicion || 'Jugador';
                
                // Crear avatar con iniciales
                const initials = `${user.nombre.charAt(0)}${user.apellido.charAt(0)}`.toUpperCase();
                document.getElementById('profileAvatar').textContent = initials;
                
                console.log('Perfil cargado:', user);
            } else {
                // Si no hay usuario registrado, redirigir al registro
                console.log('No hay usuario registrado');
                document.getElementById('profileName').textContent = 'Invitado';
                document.getElementById('profilePosition').textContent = 'No registrado';
            }
        }

        // TOGGLE MEN√ö HAMBURGUESA MEJORADO
        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            const button = document.querySelector('.hamburger-btn');
            const isOpen = menu.classList.contains('show');
            
            if (isOpen) {
                // Cerrar men√∫
                menu.classList.remove('show');
                button.classList.remove('active');
                // Reset animation delays para pr√≥xima apertura
                setTimeout(() => {
                    const items = menu.querySelectorAll('.dropdown-item');
                    items.forEach(item => {
                        item.style.animation = 'none';
                        item.offsetHeight; // Trigger reflow
                        item.style.animation = null;
                    });
                }, 300);
            } else {
                // Abrir men√∫
                menu.classList.add('show');
                button.classList.add('active');
                // Activar animaciones escalonadas
                const items = menu.querySelectorAll('.dropdown-item');
                items.forEach((item, index) => {
                    item.style.animationDelay = `${index * 0.05}s`;
                });
            }
        }

        // CERRAR MEN√ö AL HACER CLICK FUERA
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('dropdownMenu');
            const button = document.querySelector('.hamburger-btn');
            
            if (!menu.contains(event.target) && !button.contains(event.target)) {
                menu.classList.remove('show');
                button.classList.remove('active');
            }
        });

        // CERRAR MEN√ö CON ESCAPE
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const menu = document.getElementById('dropdownMenu');
                const button = document.querySelector('.hamburger-btn');
                menu.classList.remove('show');
                button.classList.remove('active');
            }
        });

        // FUNCIONES DEL MEN√ö
            function mostrarSugerenciasCard() {
                const sugerencias = [
                    "üí° Juega m√°s partidos para mejorar tu rating",
                    "‚öΩ Anota goles para aumentar tu nivel de shooting", 
                    "üèÉ‚Äç‚ôÇÔ∏è Completa entrenamientos para ganar experiencia",
                    "üèÜ Participa en torneos para subir de categor√≠a",
                    "üë• √önete a un equipo para desarrollar teamwork",
                    "üéØ Practica penaltis para mejorar precisi√≥n",
                    "üìà Mant√©n una racha de victorias para bonificaciones",
                    "üéÆ Juega mini-juegos para habilidades espec√≠ficas"
                ];
            
                const sugerenciaAleatoria = sugerencias[Math.floor(Math.random() * sugerencias.length)];
                alert(`üéØ Sugerencia para tu Card FIFA:\n\n${sugerenciaAleatoria}\n\n¬°Sigue jugando para mejorar tu rating!`);
                toggleMenu();
            }

            function viewProfile() {
                alert('üìã Ver Perfil - Funci√≥n en desarrollo');
                toggleMenu();
            }

            function editProfile() {
                alert('‚úèÔ∏è Editar Perfil - Funci√≥n en desarrollo');
                toggleMenu();
            }

        function viewStats() {
            alert('üìä Mis Estad√≠sticas - Funci√≥n en desarrollo');
            toggleMenu();
        }

        function viewMatches() {
            alert('‚öΩ Mis Partidos - Funci√≥n en desarrollo');
            toggleMenu();
        }

        function viewTeams() {
            alert('üë• Mis Equipos - Funci√≥n en desarrollo');
            toggleMenu();
        }

        function settings() {
            alert('‚öôÔ∏è Configuraci√≥n - Funci√≥n en desarrollo');
            toggleMenu();
        }

        function logout() {
            if (confirm('¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
                // AUTO-GUARDAR: Cierre de sesi√≥n
                autoSave.save('navegacion', {
                    accion: 'cerrar_sesion',
                    timestamp: new Date().toISOString()
                }, 'crear');
                
                localStorage.removeItem('futpro_sesion_activa');
                alert('üëã Sesi√≥n cerrada');
                window.location.href = './formulario-completo.html';
            }
            toggleMenu();
        }

        // ===== FUNCIONES DE LIKES EN POSTS =====
        function toggleLike(el) {
            el.classList.toggle('liked');
            
            const post = el.closest('.post');
            const postAuthor = post?.querySelector('.post-info h4')?.textContent || 'Usuario desconocido';
            const postContent = post?.querySelector('.post-content p')?.textContent || 'Contenido sin texto';
            const currentUser = JSON.parse(localStorage.getItem('futpro_user') || '{}');
            
            if (!currentUser.nombre) {
                alert('Debes completar tu perfil para dar likes');
                el.classList.remove('liked');
                return;
            }

            if (el.classList.contains('liked')) {
                // AUTO-GUARDAR: Like dado en post
                autoSave.save('likes_dados', {
                    targetUser: postAuthor,
                    contenido: postContent.substring(0, 100) + '...',
                    tipoContenido: 'post',
                    timestamp: new Date().toISOString()
                }, 'crear');

                // AUTO-GUARDAR: Like recibido (para el autor del post)
                if (postAuthor !== currentUser.nombre) {
                    autoSave.save('likes_recibidos', {
                        fromUser: currentUser.nombre,
                        fromUserId: currentUser.id,
                        contenido: postContent.substring(0, 100) + '...',
                        tipoContenido: 'post',
                        timestamp: new Date().toISOString()
                    }, 'crear');

                    // NOTIFICACI√ìN para el autor del post
                    autoSave.createNotification(
                        'like_post',
                        `${currentUser.nombre} le dio ‚öΩ like a tu publicaci√≥n`,
                        'unknown', // En un sistema real, tendr√≠amos el userId del autor
                        {
                            contenido: postContent.substring(0, 50) + '...',
                            fromUser: currentUser.nombre,
                            fromAvatar: currentUser.avatar
                        }
                    );
                }
            }
        }
        
        function toggleLikeBtn(btn) {
            const icon = btn.querySelector('i');
            const span = btn.querySelector('span');
            const currentUser = JSON.parse(localStorage.getItem('futpro_user') || '{}');
            
            if (!currentUser.nombre) {
                alert('Debes completar tu perfil para dar likes');
                return;
            }

            if (icon.classList.contains('liked')) {
                icon.classList.remove('liked');
                let n = parseInt(span.textContent) || 0;
                span.textContent = n > 0 ? n - 1 : 0;
            } else {
                icon.classList.add('liked');
                let n = parseInt(span.textContent) || 0;
                span.textContent = n + 1;
                
                // AUTO-GUARDAR: Like en bot√≥n de acci√≥n
                const post = btn.closest('.post');
                const postAuthor = post?.querySelector('.post-info h4')?.textContent || 'Usuario desconocido';
                
                autoSave.save('likes_dados', {
                    targetUser: postAuthor,
                    tipoContenido: 'post_accion',
                    timestamp: new Date().toISOString()
                }, 'crear');
            }
        }

        // NAVEGACI√ìN INFERIOR
        function setActiveNav(element) {
            // Remover clase active de todos
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            // Agregar clase active al seleccionado
            element.classList.add('active');
        }

        function openMarketplace() {
            window.location.href = './marketplace.html';
        }

        function openVideos() {
            window.location.href = './videos.html';
        }

        function openNotifications() {
            window.location.href = './notificaciones.html';
        }

        function openChat() {
            window.location.href = './chat.html';
        }

        // ACCIONES DE POSTS
        document.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const icon = this.querySelector('i');
                if (icon.classList.contains('fa-thumbs-up')) {
                    // Toggle balos (like/voto)
                    if (icon.style.color === 'gold') {
                        icon.style.color = '';
                        const count = parseInt(this.querySelector('span').textContent);
                        this.querySelector('span').textContent = count - 1;
                    } else {
                        icon.style.color = 'gold';
                        const count = parseInt(this.querySelector('span').textContent);
                        this.querySelector('span').textContent = count + 1;
                    }
                } else if (icon.classList.contains('fa-comment')) {
                    alert('üí¨ Comentarios - Funci√≥n en desarrollo');
                } else if (icon.classList.contains('fa-share')) {
                    alert('üì§ Compartir - Funci√≥n en desarrollo');
                }
            });
        });

        // INICIALIZAR AL CARGAR LA P√ÅGINA
        document.addEventListener('DOMContentLoaded', function() {
            loadUserProfile();
            asignarCardAlIniciarSesion();
        });

        // === SISTEMA DE HISTORIAS TIPO TIKTOK ===
        let historiasData = {
            'mi-historia': [
                {
                    video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                    avatar: 'https://i.imgur.com/placeholder-user.jpg',
                    nombre: 'Mi Historia',
                    userId: autoSave.userId,
                    tiempo: 'hace 2h',
                    texto: '¬°Entrenamiento matutino completado! üí™‚öΩ',
                    likes: 24,
                    vistas: 145,
                    isLive: false
                },
                {
                    video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4',
                    avatar: 'https://i.imgur.com/placeholder-user.jpg',
                    nombre: 'Mi Historia',
                    userId: autoSave.userId,
                    tiempo: 'hace 4h',
                    texto: 'Nuevo equipo, nuevas metas üèÜ',
                    likes: 18,
                    vistas: 89,
                    isLive: false
                }
            ],
            'fc-barcelona': [
                {
                    video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4',
                    avatar: 'https://i.imgur.com/placeholder-team1.jpg',
                    nombre: 'FC Barcelona',
                    userId: 'user_barcelona_oficial',
                    tiempo: 'hace 1h',
                    texto: '¬°Gol de √∫ltimo minuto! üî•‚öΩ #Bar√ßaForever',
                    likes: 156,
                    vistas: 3420,
                    isLive: false
                }
            ],
            'real-madrid': [
                {
                    video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4',
                    avatar: 'https://i.imgur.com/placeholder-team2.jpg',
                    nombre: 'Real Madrid',
                    userId: 'user_realmadrid_oficial',
                    tiempo: 'hace 3h',
                    texto: 'Entrenamiento en el Bernab√©u üèüÔ∏èüëë #HalaMadrid',
                    likes: 203,
                    vistas: 4560,
                    isLive: false
                }
            ],
            'liverpool-fc': [
                {
                    video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4',
                    avatar: 'https://i.imgur.com/placeholder-team3.jpg',
                    nombre: 'Liverpool FC',
                    userId: 'user_liverpool_oficial',
                    tiempo: 'hace 5h',
                    texto: 'You\'ll Never Walk Alone üî¥‚öΩ #YNWA',
                    likes: 89,
                    vistas: 1890,
                    isLive: false
                }
            ],
            'en-vivo': [
                {
                    video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4',
                    avatar: 'https://i.imgur.com/live-icon.jpg',
                    nombre: 'FutPro TV',
                    userId: 'user_futpro_tv',
                    tiempo: 'EN VIVO',
                    texto: 'üî¥ TRANSMISI√ìN EN VIVO: Final del Torneo Local',
                    likes: 2847,
                    vistas: 18450,
                    isLive: true
                }
            ]
        };

        let historiaActual = '';
        let videoIndex = 0;
        let progressTimer;

        function abrirHistoria(historiaId) {
            historiaActual = historiaId;
            videoIndex = 0;
            const historias = historiasData[historiaActual];
            const historia = historias[videoIndex];
            const currentUser = JSON.parse(localStorage.getItem('futpro_user') || '{}');
            // Verificar privacidad: solo mostrar si es p√∫blica o el usuario sigue al due√±o
            const puedeVer = historia.publica || (historia.seguidores && historia.seguidores.includes(currentUser.id)) || (historia.userId === currentUser.id);
            if (!puedeVer) {
                alert('Solo puedes ver historias de cuentas p√∫blicas o que sigues.');
                return;
            }
            const modal = document.getElementById('modalHistorias');
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            inicializarHistoria();
        }

        function cerrarHistorias() {
            const modal = document.getElementById('modalHistorias');
            modal.style.display = 'none';
            
            // Restaurar scroll del body
            document.body.style.overflow = 'auto';
            
            // Pausar video
            const video = document.getElementById('historiaVideo');
            video.pause();
            
            // Limpiar timer
            if (progressTimer) {
                clearInterval(progressTimer);
            }
        }

        function inicializarHistoria() {
            const historias = historiasData[historiaActual];
            if (!historias || !historias[videoIndex]) return;
            const historia = historias[videoIndex];
            const currentUser = JSON.parse(localStorage.getItem('futpro_user') || '{}');
            // AUTO-GUARDAR: Historia vista
            if (currentUser.id && historiaActual !== 'mi-historia') {
                autoSave.save('historias_vistas', {
                    historiaId: `${historiaActual}_${videoIndex}`,
                    targetUser: historia.nombre,
                    targetUserId: historia.userId || 'unknown',
                    duracionVista: 0
                }, 'crear');
                // Notificaci√≥n al due√±o solo la primera vez
                if (historia.userId && historia.userId !== currentUser.id) {
                    const vistas = autoSave.get('historias_vistas', {
                        historiaId: `${historiaActual}_${videoIndex}`,
                        userId: currentUser.id
                    });
                    if (vistas.length === 1) {
                        historia.vistas = (historia.vistas || 0) + 1;
                        autoSave.createNotification(
                            'vista_historia',
                            `${currentUser.nombre} vio tu historia`,
                            historia.userId,
                            { historiaId: `${historiaActual}_${videoIndex}` }
                        );
                    }
                }
            }
            
            // Actualizar contenido
            document.getElementById('historiaVideo').src = historia.video;
            document.getElementById('historiaAvatar').src = historia.avatar;
            document.getElementById('historiaNombre').textContent = historia.nombre;
            document.getElementById('historiaTiempo').textContent = historia.tiempo;
            document.getElementById('historiaTexto').textContent = historia.texto;
            document.getElementById('likesCount').textContent = historia.likes;

            // Mostrar bot√≥n de viewers solo si es el due√±o de la historia
            const viewersBtn = document.querySelector('.viewers-btn');
            if (historia.userId === currentUser.id) {
                viewersBtn.style.display = 'flex';
                // Mostrar likes y viewers
                // (ya implementado en mostrarViewersHistoria)
            } else {
                viewersBtn.style.display = 'none';
            }
            // Mostrar/ocultar botones de like y comentario seg√∫n privacidad
            const puedeInteractuar = historia.publica || (historia.seguidores && historia.seguidores.includes(currentUser.id));
            const likeBtn = document.querySelector('.like-btn');
            const commentBtn = document.querySelector('.comment-btn');
            if (puedeInteractuar && historia.userId !== currentUser.id) {
                likeBtn.style.display = 'flex';
                commentBtn.style.display = 'flex';
            } else {
                likeBtn.style.display = 'none';
                commentBtn.style.display = 'none';
            }
            // Registrar vista de la historia
            if (currentUser.id && historia.userId !== currentUser.id) {
                const existingViews = JSON.parse(localStorage.getItem(`futpro_historia_views_${historiaActual}_${videoIndex}`) || '[]');
                const alreadyViewed = existingViews.some(view => view.userId === currentUser.id);
                if (!alreadyViewed) {
                    existingViews.push({
                        userId: currentUser.id,
                        userName: currentUser.nombre,
                        userAvatar: currentUser.avatar,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem(`futpro_historia_views_${historiaActual}_${videoIndex}`, JSON.stringify(existingViews));
                }
            }
            // Mostrar likes y viewers solo al due√±o
            if (historia.userId === currentUser.id) {
                // listeners ya implementados: mostrarViewersHistoria()
            }

            // Crear indicadores de progreso
            crearIndicadoresProgreso(historias.length);
            
            // Configurar video
            const video = document.getElementById('historiaVideo');
            video.load();
            video.play().catch(e => console.log('Autoplay bloqueado'));
            
            // Iniciar progreso
            iniciarProgreso();
            
            // Event listener para cuando termine el video
            video.onended = () => {
                // AUTO-GUARDAR: Duraci√≥n completada de la historia
                if (currentUser.id && historiaActual !== 'mi-historia') {
                    autoSave.save('historias_vistas', {
                        historiaId: `${historiaActual}_${videoIndex}`,
                        targetUser: historia.nombre,
                        targetUserId: historia.userId || 'unknown',
                        duracionVista: video.duration || 10,
                        completada: true
                    }, 'actualizar');
                }

                setTimeout(() => {
                    if (videoIndex < historias.length - 1) {
                        historiaSiguiente();
                    } else {
                        cerrarHistorias();
                    }
                }, 500);
            };

            // Agregar bot√≥n de estad√≠sticas si es tu propia historia
            if (historiaActual === 'mi-historia') {
                agregarBotonEstadisticasHistoria();
            }

            // Actualizar botones de navegaci√≥n
            actualizarBotonesNavegacion();
        }

        function agregarBotonEstadisticasHistoria() {
            // Verificar si ya existe el bot√≥n
            if (document.getElementById('statsBtn')) return;

            const statsBtn = document.createElement('button');
            statsBtn.id = 'statsBtn';
            statsBtn.innerHTML = '<i class="fas fa-chart-bar"></i>';
            statsBtn.style.cssText = `
                position: absolute;
                top: 80px;
                right: 20px;
                background: rgba(0,0,0,0.7);
                border: none;
                color: #FFD700;
                font-size: 18px;
                padding: 12px;
                border-radius: 50%;
                cursor: pointer;
                z-index: 10003;
            `;
            statsBtn.onclick = () => mostrarEstadisticasHistoria();
            
            document.querySelector('.historia-container').appendChild(statsBtn);
        }

        function mostrarEstadisticasHistoria() {
            const historiaId = `mi-historia_${videoIndex}`;
            
            // Obtener vistas de la historia
            const vistas = autoSave.get('historias_vistas', { historiaId: historiaId });
            const likes = autoSave.get('historias_likes', { historiaId: historiaId });
            const comentarios = autoSave.get('historias_comentarios', { historiaId: historiaId });
            
            let estadisticas = `üìä ESTAD√çSTICAS DE TU HISTORIA\n\n`;
            estadisticas += `üëÄ Visualizaciones: ${vistas.length}\n`;
            estadisticas += `‚öΩ Likes: ${likes.length}\n`;
            estadisticas += `üí¨ Comentarios: ${comentarios.length}\n\n`;
            
            if (vistas.length > 0) {
                estadisticas += `üë• QUI√âNES LA VIERON:\n`;
                const usuarios = [...new Set(vistas.map(v => v.userId))];
                usuarios.slice(0, 5).forEach(userId => {
                    const user = autoSave.get('user', { id: userId })[0];
                    estadisticas += `‚Ä¢ ${user?.nombre || 'Usuario'}\n`;
                });
                if (usuarios.length > 5) {
                    estadisticas += `‚Ä¢ ...y ${usuarios.length - 5} m√°s\n`;
                }
                estadisticas += `\n`;
            }
            
            if (likes.length > 0) {
                estadisticas += `‚öΩ QUI√âNES LE DIERON LIKE:\n`;
                likes.slice(0, 5).forEach(like => {
                    estadisticas += `‚Ä¢ ${like.fromUser || 'Usuario'}\n`;
                });
                if (likes.length > 5) {
                    estadisticas += `‚Ä¢ ...y ${likes.length - 5} m√°s\n`;
                }
            }
            
            alert(estadisticas);
        }

        function crearIndicadoresProgreso(total) {
            const container = document.getElementById('progressIndicators');
            container.innerHTML = '';
            
            for (let i = 0; i < total; i++) {
                const indicator = document.createElement('div');
                indicator.className = 'progress-indicator';
                indicator.innerHTML = '<div class="progress-fill"></div>';
                container.appendChild(indicator);
                
                // Marcar completados
                if (i < videoIndex) {
                    indicator.querySelector('.progress-fill').style.width = '100%';
                }
            }
        }

        function iniciarProgreso() {
            if (progressTimer) clearInterval(progressTimer);
            
            const video = document.getElementById('historiaVideo');
            const indicator = document.querySelector('.progress-indicator:nth-child(' + (videoIndex + 1) + ') .progress-fill');
            
            progressTimer = setInterval(() => {
                if (video.duration && video.currentTime) {
                    const progress = (video.currentTime / video.duration) * 100;
                    if (indicator) {
                        indicator.style.width = progress + '%';
                    }
                }
            }, 100);
        }

        function historiaSiguiente() {
            const historias = historiasData[historiaActual];
            if (videoIndex < historias.length - 1) {
                videoIndex++;
                inicializarHistoria();
            } else {
                // Ir a la siguiente cuenta
                const cuentas = Object.keys(historiasData);
                const currentIndex = cuentas.indexOf(historiaActual);
                if (currentIndex < cuentas.length - 1) {
                    historiaActual = cuentas[currentIndex + 1];
                    videoIndex = 0;
                    inicializarHistoria();
                } else {
                    cerrarHistorias();
                }
            }
        }

        function historiaAnterior() {
            if (videoIndex > 0) {
                videoIndex--;
                inicializarHistoria();
            } else {
                // Ir a la cuenta anterior
                const cuentas = Object.keys(historiasData);
                const currentIndex = cuentas.indexOf(historiaActual);
                if (currentIndex > 0) {
                    historiaActual = cuentas[currentIndex - 1];
                    const historiasPrev = historiasData[historiaActual];
                    videoIndex = historiasPrev.length - 1;
                    inicializarHistoria();
                }
            }
        }

        function actualizarBotonesNavegacion() {
            const btnAnterior = document.getElementById('btnAnterior');
            const btnSiguiente = document.getElementById('btnSiguiente');
            
            // Mostrar/ocultar bot√≥n anterior
            const cuentas = Object.keys(historiasData);
            const currentIndex = cuentas.indexOf(historiaActual);
            btnAnterior.style.display = (currentIndex === 0 && videoIndex === 0) ? 'none' : 'block';
            
            // El bot√≥n siguiente siempre visible (se cierra autom√°ticamente al final)
            btnSiguiente.style.display = 'block';
        }

        function toggleLikeHistoria() {
            const btn = document.querySelector('.like-btn');
            const icon = btn.querySelector('i');
            const countElement = document.getElementById('likesCount');
            const historias = historiasData[historiaActual];
            const historia = historias[videoIndex];
            const currentUser = JSON.parse(localStorage.getItem('futpro_user') || '{}');
            // Solo si la historia es p√∫blica o el usuario la sigue
            if (!(historia.publica || (historia.seguidores && historia.seguidores.includes(currentUser.id)))) {
                alert('Solo puedes dar like a historias p√∫blicas o de personas que sigues.');
                return;
            }
            if (!currentUser.nombre) {
                alert('Debes completar tu perfil para dar likes');
                return;
            }
            const isLiked = btn.classList.contains('liked');
            const newCount = parseInt(countElement.textContent) + (isLiked ? -1 : 1);
            if (!isLiked) {
                btn.classList.add('liked');
                icon.className = 'fas fa-futbol';
                countElement.textContent = newCount;
                autoSave.save('likes_dados', {
                    targetUser: historia.nombre,
                    targetUserId: historia.userId || 'unknown',
                    historiaId: `${historiaActual}_${videoIndex}`,
                    tipoContenido: 'historia'
                }, 'crear');
                if (historia.userId && historia.userId !== currentUser.id) {
                    autoSave.save('likes_recibidos', {
                        fromUser: currentUser.nombre,
                        fromUserId: currentUser.id,
                        historiaId: `${historiaActual}_${videoIndex}`,
                        tipoContenido: 'historia'
                    }, 'crear');
                    autoSave.createNotification(
                        'like_historia',
                        `${currentUser.nombre} le dio ‚öΩ like a tu historia`,
                        historia.userId,
                        {
                            historiaId: `${historiaActual}_${videoIndex}`,
                            fromUser: currentUser.nombre,
                            fromAvatar: currentUser.avatar
                        }
                    );
                }
                const likesHistoria = JSON.parse(localStorage.getItem(`futpro_historia_likes_${historiaActual}_${videoIndex}`) || '[]');
                likesHistoria.push({
                    userId: currentUser.id,
                    userName: currentUser.nombre,
                    userAvatar: currentUser.avatar,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem(`futpro_historia_likes_${historiaActual}_${videoIndex}`, JSON.stringify(likesHistoria));
                historia.likes = newCount;
                const ballAnimation = document.createElement('div');
                ballAnimation.innerHTML = '‚öΩ';
                ballAnimation.style.cssText = `
                    position: absolute;
                    left: 50%;
                    top: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 80px;
                    pointer-events: none;
                    animation: ballPop 1s ease-out forwards;
                    z-index: 10002;
                `;
                if (!document.getElementById('ballPopStyle')) {
                    const style = document.createElement('style');
                    style.id = 'ballPopStyle';
                    style.textContent = `
                        @keyframes ballPop {
                            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
                            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                            100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
                document.querySelector('.historia-content').appendChild(ballAnimation);
                setTimeout(() => ballAnimation.remove(), 1000);
            } else {
                btn.classList.remove('liked');
                icon.className = 'fas fa-futbol';
                countElement.textContent = newCount;
                historia.likes = newCount;
                const likesHistoria = JSON.parse(localStorage.getItem(`futpro_historia_likes_${historiaActual}_${videoIndex}`) || '[]');
                const nuevosLikes = likesHistoria.filter(like => like.userId !== currentUser.id);
                localStorage.setItem(`futpro_historia_likes_${historiaActual}_${videoIndex}`, JSON.stringify(nuevosLikes));
            }
        }

        function mostrarViewersHistoria() {
            const currentUser = JSON.parse(localStorage.getItem('futpro_user') || '{}');
            const historias = historiasData[historiaActual];
            const historia = historias[videoIndex];
            
            // Solo el due√±o de la historia puede ver los viewers
            if (historia.userId !== currentUser.id) {
                alert('Solo puedes ver qui√©n vio tus propias historias');
                return;
            }

            // Obtener datos de viewers y likes
            const viewersData = JSON.parse(localStorage.getItem(`futpro_historia_views_${historiaActual}_${videoIndex}`) || '[]');
            const likesData = JSON.parse(localStorage.getItem(`futpro_historia_likes_${historiaActual}_${videoIndex}`) || '[]');

            const modal = document.createElement('div');
            modal.id = 'viewersModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10003;
                display: flex;
                justify-content: center;
                align-items: center;
            `;

            modal.innerHTML = `
                <div style="background: #1a1a1a; border-radius: 15px; width: 90%; max-width: 400px; max-height: 80%; overflow: hidden;">
                    <div style="padding: 20px; border-bottom: 1px solid #333;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="color: white; margin: 0;">Tu Historia</h3>
                            <button onclick="document.getElementById('viewersModal').remove()" style="background: none; border: none; color: white; font-size: 24px;">&times;</button>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 15px; border-bottom: 1px solid #333; padding-bottom: 10px;">
                            <button id="viewersTab" onclick="switchViewTab('viewers')" style="background: none; border: none; color: #00ff88; padding: 8px 16px; border-bottom: 2px solid #00ff88;">
                                üëÅÔ∏è Visto (${viewersData.length})
                            </button>
                            <button id="likesTab" onclick="switchViewTab('likes')" style="background: none; border: none; color: #ccc; padding: 8px 16px;">
                                ‚öΩ Likes (${likesData.length})
                            </button>
                        </div>
                    </div>
                    <div id="viewersContent" style="max-height: 400px; overflow-y: auto; padding: 15px;">
                        ${generateViewersList(viewersData, 'viewers')}
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Funci√≥n para cambiar entre tabs
            window.switchViewTab = function(tab) {
                const viewersTab = document.getElementById('viewersTab');
                const likesTab = document.getElementById('likesTab');
                const content = document.getElementById('viewersContent');

                if (tab === 'viewers') {
                    viewersTab.style.color = '#00ff88';
                    viewersTab.style.borderBottom = '2px solid #00ff88';
                    likesTab.style.color = '#ccc';
                    likesTab.style.borderBottom = 'none';
                    content.innerHTML = generateViewersList(viewersData, 'viewers');
                } else {
                    likesTab.style.color = '#00ff88';
                    likesTab.style.borderBottom = '2px solid #00ff88';
                    viewersTab.style.color = '#ccc';
                    viewersTab.style.borderBottom = 'none';
                    content.innerHTML = generateViewersList(likesData, 'likes');
                }
            };
        }

        function generateViewersList(data, type) {
            if (data.length === 0) {
                return `<div style="text-align: center; color: #ccc; padding: 40px;">
                    ${type === 'viewers' ? 'Nadie ha visto tu historia a√∫n' : 'Nadie ha dado like a√∫n'}
                </div>`;
            }

            return data.map(item => {
                const timeAgo = getTimeAgo(new Date(item.timestamp));
                const icon = type === 'likes' ? '‚öΩ' : 'üëÅÔ∏è';
                return `
                    <div style="display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #333;">
                        <img src="${item.userAvatar || '/api/placeholder/40/40'}" 
                             style="width: 40px; height: 40px; border-radius: 50%; margin-right: 12px;" />
                        <div style="flex: 1;">
                            <div style="color: white; font-weight: bold;">${item.userName}</div>
                            <div style="color: #ccc; font-size: 12px;">${timeAgo}</div>
                        </div>
                        <div style="color: #00ff88; font-size: 16px;">${icon}</div>
                    </div>
                `;
            }).join('');
        }

        function abrirComentarios() {
            const currentUser = JSON.parse(localStorage.getItem('futpro_user') || '{}');
            const historias = historiasData[historiaActual];
            const historia = historias[videoIndex];
            // Solo si la historia es p√∫blica o el usuario la sigue
            if (!(historia.publica || (historia.seguidores && historia.seguidores.includes(currentUser.id)))) {
                alert('Solo puedes comentar historias p√∫blicas o de personas que sigues.');
                return;
            }
            if (!currentUser.nombre) {
                alert('Debes completar tu perfil para comentar');
                return;
            }
            const comentarios = JSON.parse(localStorage.getItem(`futpro_historia_comentarios_${historiaActual}_${videoIndex}`) || '[]');
            const modal = document.createElement('div');
            modal.id = 'comentariosModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10003;
                display: flex;
                justify-content: center;
                align-items: flex-end;
            `;
            modal.innerHTML = `
                <div style=\"background: #1a1a1a; border-radius: 15px 15px 0 0; width: 100%; max-width: 500px; height: 70vh; display: flex; flex-direction: column;\">
                    <div style=\"padding: 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center;\">
                        <h3 style=\"color: white; margin: 0;\">üí¨ Comentarios</h3>
                        <button onclick=\"document.getElementById('comentariosModal').remove()\" style=\"background: none; border: none; color: white; font-size: 24px;\">&times;</button>
                    </div>
                    <div id=\"comentariosList\" style=\"flex: 1; overflow-y: auto; padding: 15px;\">
                        ${generarListaComentarios(comentarios)}
                    </div>
                    <div style=\"padding: 15px; border-top: 1px solid #333;\">
                        <div style=\"display: flex; gap: 10px; align-items: center;\">
                            <img src=\"${currentUser.avatar || '/api/placeholder/40/40'}\" style=\"width: 35px; height: 35px; border-radius: 50%;\" />
                            <input type=\"text\" id=\"comentarioInput\" placeholder=\"Escribe un comentario...\" 
                                   style=\"flex: 1; background: #333; border: none; padding: 12px 15px; border-radius: 25px; color: white;\" 
                                   onkeypress=\"if(event.key==='Enter') enviarComentario()\" />
                            <button onclick=\"enviarComentario()\" style=\"background: #00ff88; border: none; color: black; padding: 10px 20px; border-radius: 25px; font-weight: bold;\">
                                Enviar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            window.enviarComentario = function() {
                const input = document.getElementById('comentarioInput');
                const texto = input.value.trim();
                if (!texto) return;
                const nuevoComentario = {
                    id: Date.now(),
                    userId: currentUser.id,
                    userName: currentUser.nombre,
                    userAvatar: currentUser.avatar,
                    texto: texto,
                    timestamp: new Date().toISOString()
                };
                comentarios.push(nuevoComentario);
                localStorage.setItem(`futpro_historia_comentarios_${historiaActual}_${videoIndex}`, JSON.stringify(comentarios));
                autoSave.save('comentarios_hechos', {
                    targetUser: historia.nombre,
                    targetUserId: historia.userId || 'unknown',
                    historiaId: `${historiaActual}_${videoIndex}`,
                    comentario: texto,
                    tipoContenido: 'historia'
                }, 'crear');
                if (historia.userId && historia.userId !== currentUser.id) {
                    autoSave.save('comentarios_recibidos', {
                        fromUser: currentUser.nombre,
                        fromUserId: currentUser.id,
                        historiaId: `${historiaActual}_${videoIndex}`,
                        comentario: texto,
                        tipoContenido: 'historia'
                    }, 'crear');
                    autoSave.createNotification(
                        'comentario_historia',
                        `${currentUser.nombre} coment√≥ tu historia: \"${texto.substring(0, 50)}${texto.length > 50 ? '...' : ''}\"`,
                        historia.userId,
                        {
                            historiaId: `${historiaActual}_${videoIndex}`,
                            fromUser: currentUser.nombre,
                            fromAvatar: currentUser.avatar,
                            comentario: texto
                        }
                    );
                }
                document.getElementById('comentariosList').innerHTML = generarListaComentarios(comentarios);
                input.value = '';
                const lista = document.getElementById('comentariosList');
                lista.scrollTop = lista.scrollHeight;
            };
        }

        function generarListaComentarios(comentarios) {
            if (comentarios.length === 0) {
                return `<div style="text-align: center; color: #ccc; padding: 40px;">
                    No hay comentarios a√∫n. ¬°S√© el primero en comentar!
                </div>`;
            }

            return comentarios.map(comentario => {
                const timeAgo = getTimeAgo(new Date(comentario.timestamp));
                return `
                    <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                        <img src="${comentario.userAvatar || '/api/placeholder/40/40'}" 
                             style="width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0;" />
                        <div style="flex: 1;">
                            <div style="background: #333; padding: 12px 15px; border-radius: 18px;">
                                <div style="color: #00ff88; font-weight: bold; font-size: 14px; margin-bottom: 5px;">
                                    ${comentario.userName}
                                </div>
                                <div style="color: white; line-height: 1.4;">
                                    ${comentario.texto}
                                </div>
                            </div>
                            <div style="color: #999; font-size: 12px; margin-top: 5px; margin-left: 15px;">
                                ${timeAgo}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
            const historias = historiasData[historiaActual];
            const historia = historias[videoIndex];
            const currentUser = JSON.parse(localStorage.getItem('futpro_user') || '{}');
            
            if (!currentUser.nombre) {
                alert('Debes completar tu perfil para comentar');
                return;
            }

            const comentario = prompt(`üí¨ Comenta la historia de ${historia.nombre}:`);
            if (comentario && comentario.trim()) {
                const comentarioData = {
                    id: Date.now(),
                    texto: comentario.trim(),
                    usuario: currentUser.nombre,
                    userId: currentUser.id,
                    avatar: currentUser.avatar || 'https://i.imgur.com/placeholder-user.jpg',
                    timestamp: new Date().toISOString(),
                    historiaId: `${historiaActual}_${videoIndex}`,
                    targetUser: historia.nombre,
                    targetUserId: historia.userId || 'unknown'
                };

                // AUTO-GUARDAR: Comentario hecho
                autoSave.save('comentarios_hechos', comentarioData, 'crear');

                // AUTO-GUARDAR: Comentario recibido (para el due√±o de la historia)
                if (historia.userId && historia.userId !== currentUser.id) {
                    autoSave.save('comentarios_recibidos', {
                        ...comentarioData,
                        fromUser: currentUser.nombre,
                        fromUserId: currentUser.id,
                        comentario: comentario.trim()
                    }, 'crear');

                    // NOTIFICACI√ìN para el due√±o de la historia
                    autoSave.createNotification(
                        'comentario_historia',
                        `${currentUser.nombre} coment√≥ tu historia: "${comentario.substring(0, 50)}${comentario.length > 50 ? '...' : ''}"`,
                        historia.userId,
                        {
                            historiaId: `${historiaActual}_${videoIndex}`,
                            comentario: comentario.trim(),
                            fromUser: currentUser.nombre,
                            fromAvatar: currentUser.avatar
                        }
                    );
                }

                alert(`‚úÖ Comentario enviado a ${historia.nombre}:\n"${comentario}"`);
            }
        }

        function compartirHistoria() {
            const historias = historiasData[historiaActual];
            const historia = historias[videoIndex];
            
            if (navigator.share) {
                navigator.share({
                    title: `Historia de ${historia.nombre}`,
                    text: historia.texto,
                    url: window.location.href
                });
            } else {
                // Fallback para navegadores sin soporte
                const url = window.location.href;
                navigator.clipboard.writeText(url).then(() => {
                    alert('¬°Enlace copiado al portapapeles! üìã');
                });
            }
        }

        function toggleMute() {
            const video = document.getElementById('historiaVideo');
            const icon = document.getElementById('muteIcon');
            
            if (video.muted) {
                video.muted = false;
                icon.className = 'fas fa-volume-up';
            } else {
                video.muted = true;
                icon.className = 'fas fa-volume-mute';
            }
        }

        // Controles t√°ctiles para m√≥vil
        let touchStartX = 0;
        let touchStartY = 0;

        document.getElementById('modalHistorias').addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.getElementById('modalHistorias').addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const diffX = touchStartX - touchEndX;
            const diffY = touchStartY - touchEndY;

            // Swipe horizontal
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                if (diffX > 0) {
                    historiaSiguiente(); // Swipe left
                } else {
                    historiaAnterior(); // Swipe right
                }
            }
            
            // Swipe vertical para cerrar
            if (Math.abs(diffY) > Math.abs(diffX) && Math.abs(diffY) > 100 && diffY < 0) {
                cerrarHistorias(); // Swipe up
            }
        });

        // Teclas de navegaci√≥n
        document.addEventListener('keydown', (e) => {
            const modal = document.getElementById('modalHistorias');
            if (modal.style.display === 'block') {
                switch(e.key) {
                    case 'ArrowLeft':
                        historiaAnterior();
                        break;
                    case 'ArrowRight':
                    case ' ':
                        e.preventDefault();
                        historiaSiguiente();
                        break;
                    case 'Escape':
                        cerrarHistorias();
                        break;
                    case 'm':
                    case 'M':
                        toggleMute();
                        break;
                }
            }
        });
    }
    </script>
</body>
</html>