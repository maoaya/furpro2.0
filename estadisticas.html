<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Estadísticas - FutPro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #0f0f0f;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #FFD700;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #181818;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
            position: relative;
        }
        .stat-card h3 {
            color: #FFD700;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }
        .stat-item:last-child {
            border-bottom: none;
        }
        .stat-value {
            font-weight: bold;
            color: #FFD700;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            transition: width 0.3s ease;
        }
        .fifa-card {
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            border: 2px solid #FFD700;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .fifa-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            opacity: 0.8;
        }
        .card-rating {
            font-size: 48px;
            font-weight: bold;
            color: #FFD700;
            margin: 10px 0;
            position: relative;
            z-index: 1;
        }
        .card-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 16px;
            position: relative;
            z-index: 1;
        }
        .card-stat {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
        }
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
        }
        .tab {
            padding: 12px 16px;
            border: none;
            background: none;
            color: #666;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .tab.active {
            color: #FFD700;
            border-bottom-color: #FFD700;
        }
        .chart-container {
            background: #181818;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 4px;
            transition: all 0.2s;
        }
        .btn-primary { background: #FFD700; color: #181818; }
        .btn-secondary { background: #333; color: #fff; }
        .nivel-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #FFD700;
            color: #181818;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-chart-bar"></i> Mis Estadísticas</h1>
            <p>Tu rendimiento como jugador y creador de equipos</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="cambiarTab('jugador')" id="tab-jugador">
                <i class="fas fa-user"></i> Como Jugador
            </button>
            <button class="tab" onclick="cambiarTab('creador')" id="tab-creador">
                <i class="fas fa-users-cog"></i> Como Creador
            </button>
            <button class="tab" onclick="cambiarTab('comparacion')" id="tab-comparacion">
                <i class="fas fa-balance-scale"></i> Comparación
            </button>
        </div>

        <div id="statsContainer"></div>

        <div style="text-align: center; margin-top: 30px;">
            <button onclick="exportarEstadisticas()" class="btn btn-primary">
                <i class="fas fa-download"></i> Exportar Estadísticas
            </button>
            <button onclick="reiniciarEstadisticas()" class="btn btn-secondary">
                <i class="fas fa-refresh"></i> Reiniciar Stats
            </button>
        </div>

        <br>
        <a href="./homepage-instagram.html" class="btn btn-primary">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
    </div>

    <script>
        let tabActual = 'jugador';

        function getEstadisticas() {
            return JSON.parse(localStorage.getItem('futpro_estadisticas') || '{}');
        }

        function saveEstadisticas(stats) {
            localStorage.setItem('futpro_estadisticas', JSON.stringify(stats));
        }

        function getEquiposCreados() {
            const usuario = JSON.parse(localStorage.getItem('futpro_user') || '{}');
            const equipos = JSON.parse(localStorage.getItem('futpro_equipos') || '[]');
            return equipos.filter(eq => eq.creador === usuario.email);
        }

        function getTorneosParticipados() {
            const usuario = JSON.parse(localStorage.getItem('futpro_user') || '{}');
            const torneos = JSON.parse(localStorage.getItem('futpro_torneos') || '[]');
            return torneos.filter(t => t.equipos && t.equipos.some(eq => {
                const equipos = JSON.parse(localStorage.getItem('futpro_equipos') || '[]');
                const equipo = equipos.find(e => e.nombre === eq);
                return equipo && (equipo.creador === usuario.email || 
                    (equipo.plantilla && equipo.plantilla.some(p => p.email === usuario.email)));
            }));
        }

        function cambiarTab(tab) {
            tabActual = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            renderEstadisticas();
        }

        function renderEstadisticas() {
            const container = document.getElementById('statsContainer');
            
            switch(tabActual) {
                case 'jugador':
                    renderEstadisticasJugador(container);
                    break;
                case 'creador':
                    renderEstadisticasCreador(container);
                    break;
                case 'comparacion':
                    renderComparacion(container);
                    break;
            }
        }

        function renderEstadisticasJugador(container) {
            const stats = getEstadisticas();
            const partidosJugados = stats.partidosJugados || 0;
            const victorias = stats.victorias || 0;
            const empates = stats.empates || 0;
            const derrotas = stats.derrotas || 0;
            const golesAnotados = stats.golesAnotados || 0;
            const golesRecibidos = stats.golesRecibidos || 0;
            const experiencia = stats.experiencia || 0;

            // Calcular rating FIFA
            let rating = 65; // Base
            if (partidosJugados > 0) {
                const winRate = (victorias / partidosJugados) * 100;
                const goalRatio = partidosJugados > 0 ? golesAnotados / partidosJugados : 0;
                rating = Math.min(99, Math.max(40, 
                    65 + (winRate * 0.3) + (goalRatio * 5) + (experiencia * 0.01)
                ));
            }

            const nivel = Math.floor(experiencia / 500) + 1;
            const expProximoNivel = (nivel * 500) - experiencia;

            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="nivel-badge">Nivel ${nivel}</div>
                        <h3><i class="fas fa-id-card"></i> Mi Card FIFA</h3>
                        <div class="fifa-card">
                            <h4 style="margin: 0; color: #FFD700; position: relative; z-index: 1;">
                                ${JSON.parse(localStorage.getItem('futpro_user') || '{}').nombre || 'Jugador'}
                            </h4>
                            <div class="card-rating">${Math.round(rating)}</div>
                            <div style="font-size: 12px; color: #aaa; position: relative; z-index: 1;">
                                ${getRatingType(rating)}
                            </div>
                            <div class="card-stats">
                                <div class="card-stat"><span>SHT</span><span>${Math.round(rating * 0.8)}</span></div>
                                <div class="card-stat"><span>PAS</span><span>${Math.round(rating * 0.9)}</span></div>
                                <div class="card-stat"><span>DEF</span><span>${Math.round(rating * 0.7)}</span></div>
                                <div class="card-stat"><span>SPD</span><span>${Math.round(rating * 0.85)}</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <h3><i class="fas fa-futbol"></i> Estadísticas de Juego</h3>
                        <div class="stat-item">
                            <span>Partidos Jugados</span>
                            <span class="stat-value">${partidosJugados}</span>
                        </div>
                        <div class="stat-item">
                            <span>Victorias</span>
                            <span class="stat-value">${victorias}</span>
                        </div>
                        <div class="stat-item">
                            <span>Empates</span>
                            <span class="stat-value">${empates}</span>
                        </div>
                        <div class="stat-item">
                            <span>Derrotas</span>
                            <span class="stat-value">${derrotas}</span>
                        </div>
                        <div class="stat-item">
                            <span>% de Victorias</span>
                            <span class="stat-value">${partidosJugados > 0 ? Math.round((victorias/partidosJugados)*100) : 0}%</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <h3><i class="fas fa-target"></i> Estadísticas de Goles</h3>
                        <div class="stat-item">
                            <span>Goles Anotados</span>
                            <span class="stat-value">${golesAnotados}</span>
                        </div>
                        <div class="stat-item">
                            <span>Goles Recibidos</span>
                            <span class="stat-value">${golesRecibidos}</span>
                        </div>
                        <div class="stat-item">
                            <span>Diferencia de Goles</span>
                            <span class="stat-value">${golesAnotados - golesRecibidos}</span>
                        </div>
                        <div class="stat-item">
                            <span>Promedio por Partido</span>
                            <span class="stat-value">${partidosJugados > 0 ? (golesAnotados/partidosJugados).toFixed(1) : '0.0'}</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <h3><i class="fas fa-star"></i> Progreso y Experiencia</h3>
                        <div class="stat-item">
                            <span>Experiencia Total</span>
                            <span class="stat-value">${experiencia} XP</span>
                        </div>
                        <div class="stat-item">
                            <span>Nivel Actual</span>
                            <span class="stat-value">${nivel}</span>
                        </div>
                        <div style="margin: 12px 0;">
                            <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px;">
                                <span>Progreso al Nivel ${nivel + 1}</span>
                                <span>${expProximoNivel} XP restante</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${((experiencia % 500) / 500) * 100}%"></div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span>Rating FIFA</span>
                            <span class="stat-value">${Math.round(rating)}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderEstadisticasCreador(container) {
            const equiposCreados = getEquiposCreados();
            const torneosCreados = JSON.parse(localStorage.getItem('futpro_torneos') || '[]').filter(t => {
                const usuario = JSON.parse(localStorage.getItem('futpro_user') || '{}');
                return t.creador === usuario.email;
            });

            let totalJugadores = 0;
            let equiposActivos = 0;
            let torneosGanados = 0;

            equiposCreados.forEach(eq => {
                if (eq.plantilla) totalJugadores += eq.plantilla.length;
                if (eq.estado !== 'inactivo') equiposActivos++;
                if (eq.logros) torneosGanados += eq.logros.length;
            });

            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3><i class="fas fa-users"></i> Gestión de Equipos</h3>
                        <div class="stat-item">
                            <span>Equipos Creados</span>
                            <span class="stat-value">${equiposCreados.length}</span>
                        </div>
                        <div class="stat-item">
                            <span>Equipos Activos</span>
                            <span class="stat-value">${equiposActivos}</span>
                        </div>
                        <div class="stat-item">
                            <span>Total Jugadores Dirigidos</span>
                            <span class="stat-value">${totalJugadores}</span>
                        </div>
                        <div class="stat-item">
                            <span>Promedio Jugadores/Equipo</span>
                            <span class="stat-value">${equiposCreados.length > 0 ? Math.round(totalJugadores/equiposCreados.length) : 0}</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <h3><i class="fas fa-trophy"></i> Torneos y Competencias</h3>
                        <div class="stat-item">
                            <span>Torneos Creados</span>
                            <span class="stat-value">${torneosCreados.length}</span>
                        </div>
                        <div class="stat-item">
                            <span>Torneos Ganados</span>
                            <span class="stat-value">${torneosGanados}</span>
                        </div>
                        <div class="stat-item">
                            <span>Tasa de Éxito</span>
                            <span class="stat-value">${torneosCreados.length > 0 ? Math.round((torneosGanados/torneosCreados.length)*100) : 0}%</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <h3><i class="fas fa-chart-line"></i> Rendimiento como Manager</h3>
                        <div class="stat-item">
                            <span>Rating de Manager</span>
                            <span class="stat-value">${calcularRatingManager()}</span>
                        </div>
                        <div class="stat-item">
                            <span>Experiencia en Gestión</span>
                            <span class="stat-value">${calcularExpManager()} XP</span>
                        </div>
                        <div class="stat-item">
                            <span>Nivel de Manager</span>
                            <span class="stat-value">${Math.floor(calcularExpManager() / 1000) + 1}</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <h3><i class="fas fa-list"></i> Mis Equipos</h3>
                        ${equiposCreados.length > 0 ? 
                            equiposCreados.map(eq => `
                                <div class="stat-item">
                                    <span>${eq.nombre}</span>
                                    <span class="stat-value">${eq.plantilla ? eq.plantilla.length : 0} jugadores</span>
                                </div>
                            `).join('') :
                            '<p style="color: #666; text-align: center;">No has creado equipos aún</p>'
                        }
                    </div>
                </div>
            `;
        }

        function renderComparacion(container) {
            const stats = getEstadisticas();
            const equiposCreados = getEquiposCreados().length;
            
            const promedios = {
                partidosJugados: 15,
                victorias: 8,
                golesAnotados: 12,
                equiposCreados: 2,
                experiencia: 750
            };

            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3><i class="fas fa-balance-scale"></i> Comparación con Promedio</h3>
                        <div class="stat-item">
                            <span>Partidos Jugados</span>
                            <span class="stat-value">
                                ${stats.partidosJugados || 0} / ${promedios.partidosJugados}
                                ${getComparacionIcon((stats.partidosJugados || 0) - promedios.partidosJugados)}
                            </span>
                        </div>
                        <div class="stat-item">
                            <span>Victorias</span>
                            <span class="stat-value">
                                ${stats.victorias || 0} / ${promedios.victorias}
                                ${getComparacionIcon((stats.victorias || 0) - promedios.victorias)}
                            </span>
                        </div>
                        <div class="stat-item">
                            <span>Goles</span>
                            <span class="stat-value">
                                ${stats.golesAnotados || 0} / ${promedios.golesAnotados}
                                ${getComparacionIcon((stats.golesAnotados || 0) - promedios.golesAnotados)}
                            </span>
                        </div>
                        <div class="stat-item">
                            <span>Experiencia</span>
                            <span class="stat-value">
                                ${stats.experiencia || 0} / ${promedios.experiencia}
                                ${getComparacionIcon((stats.experiencia || 0) - promedios.experiencia)}
                            </span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <h3><i class="fas fa-medal"></i> Tu Ranking</h3>
                        <div class="stat-item">
                            <span>Clasificación General</span>
                            <span class="stat-value">#${calcularRanking()}</span>
                        </div>
                        <div class="stat-item">
                            <span>Categoría</span>
                            <span class="stat-value">${getCategoriaJugador()}</span>
                        </div>
                        <div class="stat-item">
                            <span>Percentil</span>
                            <span class="stat-value">${calcularPercentil()}%</span>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div style="text-align: center;">
                            <i class="fas fa-chart-pie" style="font-size: 48px; margin-bottom: 16px;"></i>
                            <h4>Gráficos Avanzados</h4>
                            <p>Función próximamente...</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function getRatingType(rating) {
            if (rating >= 90) return 'LEYENDA';
            if (rating >= 85) return 'ÉLITE';
            if (rating >= 80) return 'PROFESIONAL';
            if (rating >= 75) return 'EXPERTO';
            if (rating >= 70) return 'AVANZADO';
            if (rating >= 65) return 'INTERMEDIO';
            return 'PRINCIPIANTE';
        }

        function calcularRatingManager() {
            const equipos = getEquiposCreados();
            let rating = 50;
            
            equipos.forEach(eq => {
                if (eq.plantilla) rating += eq.plantilla.length * 2;
                if (eq.logros) rating += eq.logros.length * 10;
            });
            
            return Math.min(99, rating);
        }

        function calcularExpManager() {
            const equipos = getEquiposCreados();
            let exp = 0;
            
            equipos.forEach(eq => {
                exp += 200; // Por crear equipo
                if (eq.plantilla) exp += eq.plantilla.length * 25;
                if (eq.logros) exp += eq.logros.length * 100;
            });
            
            return exp;
        }

        function getComparacionIcon(diff) {
            if (diff > 0) return '<i class="fas fa-arrow-up" style="color: #4CAF50;"></i>';
            if (diff < 0) return '<i class="fas fa-arrow-down" style="color: #f44336;"></i>';
            return '<i class="fas fa-minus" style="color: #FFD700;"></i>';
        }

        function calcularRanking() {
            const stats = getEstadisticas();
            const score = (stats.victorias || 0) * 3 + (stats.empates || 0) + (stats.experiencia || 0) * 0.01;
            return Math.max(1, 1000 - Math.floor(score));
        }

        function getCategoriaJugador() {
            const stats = getEstadisticas();
            const nivel = Math.floor((stats.experiencia || 0) / 500) + 1;
            
            if (nivel >= 20) return 'LEYENDA';
            if (nivel >= 15) return 'MAESTRO';
            if (nivel >= 10) return 'EXPERTO';
            if (nivel >= 5) return 'AVANZADO';
            return 'PRINCIPIANTE';
        }

        function calcularPercentil() {
            const ranking = calcularRanking();
            return Math.max(1, Math.min(99, 100 - Math.floor(ranking / 10)));
        }

        function exportarEstadisticas() {
            const stats = getEstadisticas();
            const equipos = getEquiposCreados();
            
            let csv = `Estadísticas FutPro\n`;
            csv += `Fecha: ${new Date().toLocaleDateString()}\n\n`;
            csv += `Estadísticas de Jugador:\n`;
            csv += `Partidos Jugados,${stats.partidosJugados || 0}\n`;
            csv += `Victorias,${stats.victorias || 0}\n`;
            csv += `Empates,${stats.empates || 0}\n`;
            csv += `Derrotas,${stats.derrotas || 0}\n`;
            csv += `Goles Anotados,${stats.golesAnotados || 0}\n`;
            csv += `Goles Recibidos,${stats.golesRecibidos || 0}\n`;
            csv += `Experiencia,${stats.experiencia || 0}\n\n`;
            csv += `Estadísticas de Creador:\n`;
            csv += `Equipos Creados,${equipos.length}\n`;
            csv += `Rating de Manager,${calcularRatingManager()}\n`;
            
            const blob = new Blob([csv], {type: 'text/csv'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `futpro_estadisticas_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        function reiniciarEstadisticas() {
            if (confirm('¿Estás seguro de que quieres reiniciar todas tus estadísticas? Esta acción no se puede deshacer.')) {
                localStorage.removeItem('futpro_estadisticas');
                renderEstadisticas();
                alert('Estadísticas reiniciadas');
            }
        }

        // Inicializar con datos demo si es necesario
        function inicializarDatos() {
            const stats = getEstadisticas();
            if (Object.keys(stats).length === 0) {
                const statsDemo = {
                    partidosJugados: 5,
                    victorias: 3,
                    empates: 1,
                    derrotas: 1,
                    golesAnotados: 8,
                    golesRecibidos: 4,
                    experiencia: 250
                };
                saveEstadisticas(statsDemo);
            }
        }

        // Inicializar
        inicializarDatos();
        renderEstadisticas();
    </script>
</body>
</html>