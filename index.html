<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FutPro 2.0 - Plataforma de Gesti贸n Deportiva</title>
  <meta name="description" content="FutPro 2.0 - La mejor plataforma para gestionar tu carrera deportiva" />

  <!-- Preload critical resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />

  <!-- Meta tags for SEO -->
  <meta property="og:title" content="FutPro 2.0" />
  <meta property="og:description" content="Plataforma de gesti贸n deportiva profesional" />
  <meta property="og:type" content="website" />

  <!-- Security -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' fonts.googleapis.com; font-src 'self' fonts.gstatic.com; img-src 'self' data: blob: https: http:; connect-src 'self' https: http: wss: ws:;">
  
  <!-- Ocultar bot贸n de emergencia IR A REGISTRO -->
  <style>
    #emergency-nav, 
    [aria-label="IR A REGISTRO"] {
      display: none !important;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- Error overlay para capturar errores JS globales y promesas rechazadas -->
  <div id="error-overlay" style="display:none; position:fixed; inset:12px; background:rgba(0,0,0,0.85); color:#fff; padding:20px; z-index:99999; overflow:auto; font-family:monospace; font-size:13px; border-radius:8px;">
    <strong>Error runtime:</strong>
    <pre id="error-content" style="white-space:pre-wrap; color:#ffdddd;"></pre>
    <button onclick="document.getElementById('error-overlay').style.display='none'" style="position:fixed; right:20px; top:20px;">Cerrar</button>
  </div>

  <!--  SCRIPT GLOBAL DE NAVEGACION ULTRA-ROBUSTO -->
  <script>
    (function() {
      'use strict';
      console.log(' Navegaci贸n ultra-robusta inicializada');

      window.navegarCrearUsuario = function() {
        const metodos = [
          () => window.location.href = '/registro-nuevo',
          () => window.location.assign('/registro-nuevo'),
          () => window.location.replace('/registro-nuevo'),
          () => window.open('/registro-nuevo', '_self'),
          () => {
            const form = document.createElement('form');
            form.method = 'GET';
            form.action = '/registro-nuevo';
            document.body.appendChild(form);
            form.submit();
          }
        ];

        for (let i = 0; i < metodos.length; i++) {
          try {
            metodos[i]();
            break;
          } catch (error) {
            if (i === metodos.length - 1) {
              alert('Error: No se pudo navegar. Por favor, ve manualmente a /registro-nuevo');
            }
          }
        }
      };

      function adjuntarEventos() {
        setTimeout(() => {
          const botones = document.querySelectorAll('button');
          let botonCrearUsuarioEncontrado = false;

          botones.forEach(btn => {
            const texto = (btn.textContent || '').toLowerCase();
            if (texto.includes('crear usuario')) {
              botonCrearUsuarioEncontrado = true;
              btn.addEventListener('click', function() {
                setTimeout(() => {
                  if (window.location.pathname === '/' || window.location.pathname === '/login') {
                    window.navegarCrearUsuario();
                  }
                }, 1000);
              }, true);
            }
          });

          if (!botonCrearUsuarioEncontrado && window.location.pathname === '/') {
            const emergencyBtn = document.getElementById('emergency-nav');
            if (emergencyBtn) {
              emergencyBtn.style.display = 'block';
            }
          }
        }, 1000);
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', adjuntarEventos);
      } else {
        adjuntarEventos();
      }

      new MutationObserver(adjuntarEventos).observe(document.body, {
        childList: true,
        subtree: true
      });

    })();
  </script>

  <script type="module" src="/src/main.jsx"></script>
  <script>
    window.addEventListener('error', function (ev) {
      try {
        const overlay = document.getElementById('error-overlay');
        const content = document.getElementById('error-content');
        overlay.style.display = 'block';
        content.textContent = (ev && ev.error && ev.error.stack) ? ev.error.stack : (ev && ev.message) || JSON.stringify(ev);
      } catch (e) { console.error('Error mostrando overlay', e); }
    });
    window.addEventListener('unhandledrejection', function (ev) {
      try {
        const overlay = document.getElementById('error-overlay');
        const content = document.getElementById('error-content');
        overlay.style.display = 'block';
        content.textContent = (ev && ev.reason && ev.reason.stack) ? ev.reason.stack : JSON.stringify(ev.reason || ev);
      } catch (e) { console.error('Error mostrando overlay', e); }
    });
  </script>
</body>
</html>
